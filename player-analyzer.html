<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚öΩ FM Player Analyzer - Analisis & Rekomendasi</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.95;
        }

        .upload-section {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }

        .upload-box {
            border: 3px dashed #667eea;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            background: white;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-box:hover {
            border-color: #764ba2;
            background: #f8f9fa;
        }

        .upload-box.dragover {
            border-color: #28a745;
            background: #d4edda;
        }

        .upload-icon {
            font-size: 4em;
            margin-bottom: 15px;
        }

        .file-input {
            display: none;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .content {
            padding: 30px;
        }

        .player-selector {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .player-selector label {
            display: block;
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 1.1em;
            color: #333;
        }

        .player-selector select {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1em;
            background: white;
            cursor: pointer;
        }

        .player-selector select:focus {
            outline: none;
            border-color: #667eea;
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            border: 1px solid #e9ecef;
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .card-icon {
            font-size: 2em;
            margin-right: 15px;
        }

        .card-title {
            font-size: 1.4em;
            font-weight: 700;
            color: #333;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f1f3f5;
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            font-weight: 600;
            color: #555;
        }

        .stat-value {
            font-size: 1.1em;
            font-weight: 700;
            color: #667eea;
        }

        .rating-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 5px;
        }

        .rating-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s ease;
        }

        .insight-list {
            list-style: none;
        }

        .insight-item {
            padding: 12px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .insight-item.strength {
            border-left-color: #28a745;
            background: #d4edda;
        }

        .insight-item.weakness {
            border-left-color: #dc3545;
            background: #f8d7da;
        }

        .insight-item.neutral {
            border-left-color: #ffc107;
            background: #fff3cd;
        }

        .recommendation-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .recommendation-title {
            font-size: 1.5em;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .training-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .training-item {
            background: rgba(255,255,255,0.15);
            padding: 15px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }

        .training-item h4 {
            font-size: 1.1em;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }

        .training-item p {
            font-size: 0.95em;
            opacity: 0.95;
            line-height: 1.5;
        }

        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            margin-right: 5px;
            margin-bottom: 5px;
        }

        .badge-primary {
            background: #667eea;
            color: white;
        }

        .badge-success {
            background: #28a745;
            color: white;
        }

        .badge-danger {
            background: #dc3545;
            color: white;
        }

        .badge-warning {
            background: #ffc107;
            color: #333;
        }

        .hidden {
            display: none;
        }

        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            font-weight: 500;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .position-badge {
            display: inline-block;
            padding: 8px 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            font-weight: 700;
            font-size: 1.1em;
            margin-bottom: 15px;
        }

        .player-header {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            margin-bottom: 30px;
        }

        .player-name {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .player-info {
            font-size: 1.2em;
            opacity: 0.95;
        }

        .comparison-chart {
            margin-top: 20px;
        }

        .chart-bar {
            margin-bottom: 15px;
        }

        .chart-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        .chart-bar-bg {
            width: 100%;
            height: 25px;
            background: #e9ecef;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        .chart-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.8s ease;
            display: flex;
            align-items: center;
            padding: 0 10px;
            color: white;
            font-weight: 700;
            font-size: 0.9em;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
            color: #667eea;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .role-recommendation {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 5px solid #667eea;
        }

        .role-recommendation h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .role-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin-bottom: 10px;
            background: white;
            border-radius: 8px;
        }

        .role-score {
            font-size: 1.5em;
            font-weight: 700;
            color: #667eea;
            margin-right: 15px;
            min-width: 50px;
        }

        .role-details {
            flex: 1;
        }

        .role-name {
            font-weight: 700;
            font-size: 1.1em;
            margin-bottom: 3px;
        }

        .role-desc {
            color: #666;
            font-size: 0.9em;
        }

        /* Table Styles */
        #playerTable {
            font-size: 0.9em;
        }

        #playerTable thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        #playerTable th {
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
            border-right: 1px solid rgba(255,255,255,0.2);
        }

        #playerTable th:last-child {
            border-right: none;
        }

        #playerTable tbody tr {
            border-bottom: 1px solid #e9ecef;
            transition: background 0.2s ease;
        }

        #playerTable tbody tr:hover {
            background: #f8f9fa;
            cursor: pointer;
        }

        #playerTable td {
            padding: 10px 8px;
            border-right: 1px solid #f1f3f5;
        }

        #playerTable td:last-child {
            border-right: none;
        }

        #playerTable tbody tr:nth-child(even) {
            background: #f8f9fa;
        }

        #playerTable tbody tr:nth-child(even):hover {
            background: #e9ecef;
        }

        #playerTable tbody tr.selected {
            background: #d4edda !important;
            border-left: 4px solid #28a745;
        }

        #playerTable tbody tr.selected:hover {
            background: #c3e6cb !important;
        }

        #playerTable tbody tr td:first-child {
            background: inherit;
        }

        .table-scroll {
            max-height: 400px;
            overflow-y: auto;
        }

        .highlight-cell {
            background: #fff3cd !important;
            font-weight: 600;
        }

        .table-container {
            max-height: 500px;
            overflow: auto;
            border: 1px solid #e9ecef;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚öΩ Football Manager Player Analyzer</h1>
            <p>Analisis Mendalam & Rekomendasi Latihan untuk Pemain Anda</p>
        </div>

        <div class="upload-section">
            <div class="upload-box" id="uploadBox">
                <div class="upload-icon">üìä</div>
                <h2>Upload File Excel Pemain</h2>
                <p style="margin: 15px 0; color: #666;">
                    Drag & drop file Excel atau klik untuk memilih<br>
                    <small>(Format: .xlsx, .xls)</small>
                </p>
                <input type="file" id="fileInput" class="file-input" accept=".xlsx,.xls">
                <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                    Pilih File
                </button>
            </div>
            <div id="fileInfo" class="hidden" style="margin-top: 15px; text-align: center;">
                <div class="alert alert-success">
                    ‚úÖ File berhasil dimuat: <strong id="fileName"></strong>
                    <br>
                    <small id="playerCount"></small>
                    <br>
                    <button class="btn btn-primary" onclick="showDebugInfo()" style="margin-top: 10px; font-size: 0.9em; padding: 8px 20px;">
                        üîç Lihat Kolom Excel
                    </button>
                </div>
            </div>
        </div>

        <div class="content hidden" id="mainContent">
            <!-- Data Table Section -->
            <div class="card" style="margin-bottom: 30px;">
                <div class="card-header">
                    <div class="card-icon">üìã</div>
                    <div class="card-title">Data Pemain (Crosscheck)</div>
                </div>
                <div class="table-container">
                    <table id="playerTable" style="width: 100%; border-collapse: collapse;">
                        <thead id="tableHead"></thead>
                        <tbody id="tableBody"></tbody>
                    </table>
                </div>
                <div style="padding: 15px; background: #f8f9fa; border-top: 1px solid #e9ecef; text-align: center;">
                    <small style="color: #666;">üí° Klik pada baris untuk memilih pemain dan melihat analisis detail</small>
                </div>
            </div>

            <div class="player-selector">
                <label for="playerSelect">üéØ Pilih Pemain untuk Dianalisis:</label>
                <select id="playerSelect" onchange="analyzePlayer()">
                    <option value="">-- Pilih Pemain --</option>
                </select>
            </div>

            <div id="analysisResult" class="hidden">
                <!-- Player Header -->
                <div class="player-header" id="playerHeader"></div>

                <!-- Analysis Grid -->
                <div class="analysis-grid">
                    <!-- Performance Summary Card -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">‚ö°</div>
                            <div class="card-title">Performa Pertandingan</div>
                        </div>
                        <div id="performanceStats"></div>
                    </div>

                    <!-- Player Stats Card -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">üìä</div>
                            <div class="card-title">Statistik Utama</div>
                        </div>
                        <div id="mainStats"></div>
                    </div>

                    <!-- Technical Skills Card -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">‚öΩ</div>
                            <div class="card-title">Kemampuan Teknis</div>
                        </div>
                        <div id="technicalSkills"></div>
                    </div>

                    <!-- Mental Skills Card -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">üß†</div>
                            <div class="card-title">Kemampuan Mental</div>
                        </div>
                        <div id="mentalSkills"></div>
                    </div>

                    <!-- Physical Skills Card -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">üí™</div>
                            <div class="card-title">Kemampuan Fisik</div>
                        </div>
                        <div id="physicalSkills"></div>
                    </div>
                </div>

                <!-- Insights Section -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üí°</div>
                        <div class="card-title">Insight & Analisis</div>
                    </div>
                    <ul class="insight-list" id="insightsList"></ul>
                </div>

                <!-- Role Recommendations -->
                <div class="role-recommendation">
                    <h3>üéØ Rekomendasi Posisi & Role</h3>
                    <div id="roleRecommendations"></div>
                </div>

                <!-- Training Recommendations -->
                <div class="recommendation-card">
                    <div class="recommendation-title">üèãÔ∏è Rekomendasi Program Latihan</div>
                    <p style="margin-bottom: 20px; opacity: 0.95;">
                        Program latihan yang disesuaikan berdasarkan kekuatan dan kelemahan pemain
                    </p>
                    <div class="training-grid" id="trainingRecommendations"></div>
                </div>

                <!-- Attribute Comparison -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üìà</div>
                        <div class="card-title">Perbandingan Atribut</div>
                    </div>
                    <div class="comparison-chart" id="comparisonChart"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let playersData = [];
        let currentPlayer = null;

        // File Upload Handlers
        const uploadBox = document.getElementById('uploadBox');
        const fileInput = document.getElementById('fileInput');

        uploadBox.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadBox.classList.add('dragover');
        });

        uploadBox.addEventListener('dragleave', () => {
            uploadBox.classList.remove('dragover');
        });

        uploadBox.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadBox.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file) {
                handleFile(file);
            }
        });

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                handleFile(file);
            }
        });

        function handleFile(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                    
                    playersData = jsonData;
                    
                    // Debug: Log kolom yang tersedia
                    if (playersData.length > 0) {
                        console.log('Kolom yang ditemukan:', Object.keys(playersData[0]));
                        console.log('Data pemain pertama:', playersData[0]);
                    }
                    
                    populatePlayerList();
                    displayDataTable();
                    
                    document.getElementById('fileName').textContent = file.name;
                    document.getElementById('playerCount').textContent = 
                        `Total ${playersData.length} pemain berhasil dimuat`;
                    document.getElementById('fileInfo').classList.remove('hidden');
                    document.getElementById('mainContent').classList.remove('hidden');
                } catch (error) {
                    alert('Error membaca file: ' + error.message);
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function populatePlayerList() {
            const select = document.getElementById('playerSelect');
            select.innerHTML = '<option value="">-- Pilih Pemain --</option>';
            
            playersData.forEach((player, index) => {
                const option = document.createElement('option');
                option.value = index;
                
                // Cari nama dengan berbagai kemungkinan kolom
                const name = findPlayerAttribute(player, [
                    'Name', 'Nama', 'name', 'Player', 'Pemain', 
                    'Player Name', 'Full Name', 'Fullname',
                    'INF', 'Inf'  // Football Manager sering pakai 'Inf' untuk information/name
                ]) || 'Unknown Player';
                
                const position = findPlayerAttribute(player, [
                    'Position', 'Posisi', 'Pos', 'pos', 'P',
                    'Positions', 'Position(s)'
                ]) || '';
                
                const age = findPlayerAttribute(player, [
                    'Age', 'Umur', 'age', 'A', 'Usia'
                ]) || '';
                
                option.textContent = `${name} ${position ? '(' + position + ')' : ''} ${age ? '- ' + age + ' tahun' : ''}`;
                select.appendChild(option);
            });
        }

        // Helper function untuk mencari atribut dengan berbagai nama kolom
        function findPlayerAttribute(player, possibleKeys) {
            for (let key of possibleKeys) {
                if (player.hasOwnProperty(key) && player[key] !== undefined && player[key] !== null && player[key] !== '') {
                    return player[key];
                }
            }
            // Jika tidak ditemukan, coba cari yang mirip (case insensitive)
            const playerKeys = Object.keys(player);
            for (let key of possibleKeys) {
                const found = playerKeys.find(pk => pk.toLowerCase() === key.toLowerCase());
                if (found && player[found] !== undefined && player[found] !== null && player[found] !== '') {
                    return player[found];
                }
            }
            return null;
        }

        function displayDataTable() {
            if (playersData.length === 0) return;

            const columns = Object.keys(playersData[0]);
            const tableHead = document.getElementById('tableHead');
            const tableBody = document.getElementById('tableBody');

            // Create table header
            let headerHTML = '<tr>';
            headerHTML += '<th style="position: sticky; left: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); z-index: 11; min-width: 50px;">#</th>';
            columns.forEach(col => {
                // Highlight common columns
                const isImportant = ['Name', 'Nama', 'INF', 'Inf', 'Position', 'Posisi', 'Age', 'CA', 'PA'].some(
                    key => col.toLowerCase().includes(key.toLowerCase())
                );
                const style = isImportant ? 'min-width: 120px;' : 'min-width: 80px;';
                headerHTML += `<th title="${col}" style="${style}">${col}</th>`;
            });
            headerHTML += '</tr>';
            tableHead.innerHTML = headerHTML;

            // Create table body
            let bodyHTML = '';
            playersData.forEach((player, index) => {
                bodyHTML += `<tr onclick="selectPlayerFromTable(${index})" id="tableRow${index}">`;
                bodyHTML += `<td style="position: sticky; left: 0; background: inherit; font-weight: 600; z-index: 5; border-right: 2px solid #dee2e6;">${index + 1}</td>`;
                columns.forEach(col => {
                    let value = player[col];
                    // Format value
                    if (value === null || value === undefined || value === '') {
                        value = '-';
                    } else if (typeof value === 'number') {
                        // Check if it's a stat (0-20)
                        if (value >= 0 && value <= 20 && Number.isInteger(value)) {
                            value = `<span style="display: inline-block; padding: 2px 8px; background: linear-gradient(90deg, #667eea ${value * 5}%, #f0f0f0 ${value * 5}%); border-radius: 4px; font-weight: 600;">${value}</span>`;
                        } else {
                            value = value.toLocaleString();
                        }
                    } else {
                        value = String(value);
                        // Truncate long text
                        if (value.length > 50) {
                            value = `<span title="${value}">${value.substring(0, 50)}...</span>`;
                        }
                    }
                    
                    bodyHTML += `<td>${value}</td>`;
                });
                bodyHTML += '</tr>';
            });
            tableBody.innerHTML = bodyHTML;
        }

        function selectPlayerFromTable(index) {
            document.getElementById('playerSelect').value = index;
            
            // Remove previous selection
            const rows = document.querySelectorAll('#playerTable tbody tr');
            rows.forEach(row => row.classList.remove('selected'));
            
            // Add selection to clicked row
            const selectedRow = document.getElementById(`tableRow${index}`);
            if (selectedRow) {
                selectedRow.classList.add('selected');
                // Scroll to analysis
                setTimeout(() => {
                    document.getElementById('analysisResult').scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'start' 
                    });
                }, 100);
            }
            
            analyzePlayer();
        }

        function analyzePlayer() {
            const selectedIndex = document.getElementById('playerSelect').value;
            if (selectedIndex === '') {
                document.getElementById('analysisResult').classList.add('hidden');
                return;
            }

            currentPlayer = playersData[selectedIndex];
            displayPlayerAnalysis(currentPlayer);
            document.getElementById('analysisResult').classList.remove('hidden');
            
            // Smooth scroll to analysis
            document.getElementById('analysisResult').scrollIntoView({ behavior: 'smooth' });
        }

        function displayPlayerAnalysis(player) {
            // Extract player info dengan helper function
            const name = findPlayerAttribute(player, [
                'Name', 'Nama', 'name', 'Player', 'Pemain', 
                'Player Name', 'Full Name', 'Fullname', 'INF', 'Inf'
            ]) || 'Unknown Player';
            
            const position = findPlayerAttribute(player, [
                'Position', 'Posisi', 'Pos', 'pos', 'P',
                'Positions', 'Position(s)'
            ]) || 'N/A';
            
            const age = findPlayerAttribute(player, [
                'Age', 'Umur', 'age', 'A', 'Usia'
            ]) || 'N/A';
            
            const nationality = findPlayerAttribute(player, [
                'Nationality', 'Kebangsaan', 'Nat', 'Nation', 'Country'
            ]) || 'N/A';
            
            // Display player header
            document.getElementById('playerHeader').innerHTML = `
                <div class="player-name">${name}</div>
                <div class="player-info">
                    <span class="position-badge">${position}</span><br>
                    ${age} tahun ‚Ä¢ ${nationality}
                </div>
            `;

            // Analyze and display stats
            displayPerformanceStats(player);
            displayMainStats(player);
            displayTechnicalSkills(player);
            displayMentalSkills(player);
            displayPhysicalSkills(player);
            displayInsights(player);
            displayTrainingRecommendations(player);
            displayRoleRecommendations(player);
            displayComparison(player);
        }

        function getStatValue(player, possibleKeys) {
            for (let key of possibleKeys) {
                if (player[key] !== undefined && player[key] !== null && player[key] !== '') {
                    const value = parseInt(player[key]) || 0;
                    // Return value jika valid (0-20 untuk FM attributes)
                    if (value >= 0 && value <= 20) {
                        return value;
                    }
                }
            }
            
            // Jika tidak ditemukan, coba cari yang mirip (case insensitive dan partial match)
            const playerKeys = Object.keys(player);
            for (let key of possibleKeys) {
                const found = playerKeys.find(pk => 
                    pk.toLowerCase().includes(key.toLowerCase()) || 
                    key.toLowerCase().includes(pk.toLowerCase())
                );
                if (found && player[found] !== undefined && player[found] !== null && player[found] !== '') {
                    const value = parseInt(player[found]) || 0;
                    if (value >= 0 && value <= 20) {
                        return value;
                    }
                }
            }
            return 0;
        }

        function displayPerformanceStats(player) {
            const perfStats = {
                'Apps': findPlayerAttribute(player, ['Apps', 'Aps', 'Appearances']) || '0',
                'Goals': findPlayerAttribute(player, ['Gls', 'Goals']) || '0',
                'Assists': findPlayerAttribute(player, ['Asts', 'Assists']) || '0',
                'Avg Rating': findPlayerAttribute(player, ['Avg Rat', 'AvRat', 'Average Rating']) || 'N/A',
                'Man of Match': findPlayerAttribute(player, ['MoM', 'MotM']) || '0',
                'Yellow Cards': findPlayerAttribute(player, ['Yel', 'Yellow']) || '0',
                'Red Cards': findPlayerAttribute(player, ['Red']) || '0'
            };

            let html = '';
            for (let [label, value] of Object.entries(perfStats)) {
                const numValue = parseFloat(value);
                const isNumber = !isNaN(numValue) && value !== 'N/A';
                
                let displayClass = 'stat-value';
                
                // Color coding
                if (label === 'Avg Rating' && isNumber) {
                    if (numValue >= 7.5) displayClass += ' style="color: #28a745;"';
                    else if (numValue >= 7.0) displayClass += ' style="color: #17a2b8;"';
                    else if (numValue < 6.5) displayClass += ' style="color: #dc3545;"';
                } else if (label === 'Red Cards' && numValue > 0) {
                    displayClass += ' style="color: #dc3545;"';
                } else if (label === 'Yellow Cards' && numValue > 5) {
                    displayClass += ' style="color: #ffc107;"';
                } else if ((label === 'Goals' || label === 'Assists') && numValue >= 10) {
                    displayClass += ' style="color: #28a745;"';
                } else if (label === 'Man of Match' && numValue > 0) {
                    displayClass += ' style="color: #ffd700;"';
                }
                
                if (!isNumber || label === 'Red Cards' || label === 'Yellow Cards') {
                    html += `
                        <div class="stat-row">
                            <span class="stat-label">${label}</span>
                            <span class="${displayClass}">${value}</span>
                        </div>
                    `;
                } else {
                    let percentage;
                    if (label === 'Avg Rating') {
                        percentage = (numValue / 10) * 100;
                    } else if (label === 'Apps') {
                        percentage = Math.min((numValue / 50) * 100, 100);
                    } else {
                        percentage = Math.min((numValue / 20) * 100, 100);
                    }
                    
                    html += `
                        <div class="stat-row">
                            <div style="flex: 1;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span class="stat-label">${label}</span>
                                    <span class="${displayClass}">${value}</span>
                                </div>
                                <div class="rating-bar">
                                    <div class="rating-fill" style="width: ${percentage}%"></div>
                                </div>
                            </div>
                        </div>
                    `;
                }
            }
            document.getElementById('performanceStats').innerHTML = html;
        }

        function displayMainStats(player) {
            // Check if we have performance data or attribute data
            const avgRating = findPlayerAttribute(player, ['Avg Rat', 'AvRat', 'Average Rating', 'Rating']);
            const apps = findPlayerAttribute(player, ['Apps', 'Aps', 'Appearances']);
            
            let stats = {};
            
            // If we have performance data, show it
            if (avgRating || apps) {
                stats = {
                    'Avg Rating': avgRating || 'N/A',
                    'Appearances': apps || '0',
                    'Goals': findPlayerAttribute(player, ['Gls', 'Goals', 'Goal']) || '0',
                    'Assists': findPlayerAttribute(player, ['Asts', 'Assists', 'Ast']) || '0',
                    'Man of Match': findPlayerAttribute(player, ['MoM', 'MotM']) || '0'
                };
            } else {
                // Fallback to attribute data
                stats = {
                    'Current Ability': getStatValue(player, ['CA', 'Current Ability', 'Cur']),
                    'Potential Ability': getStatValue(player, ['PA', 'Potential Ability', 'Pot']),
                    'Age': getStatValue(player, ['Age', 'Umur', 'age']),
                    'Value': findPlayerAttribute(player, ['Value', 'Nilai']) || 'N/A',
                    'Wage': findPlayerAttribute(player, ['Wage', 'Gaji']) || 'N/A'
                };
            }

            let html = '';
            for (let [label, value] of Object.entries(stats)) {
                const numValue = parseFloat(value);
                const isNumber = !isNaN(numValue) && value !== 'N/A';
                
                if (label === 'Value' || label === 'Wage' || !isNumber) {
                    html += `
                        <div class="stat-row">
                            <span class="stat-label">${label}</span>
                            <span class="stat-value">${value}</span>
                        </div>
                    `;
                } else {
                    // For Avg Rating, use different scale
                    let percentage;
                    if (label === 'Avg Rating') {
                        percentage = (numValue / 10) * 100; // Scale 0-10
                    } else if (numValue <= 20) {
                        percentage = numValue * 5; // Scale 0-20
                    } else {
                        percentage = Math.min((numValue / 50) * 100, 100); // For larger numbers
                    }
                    
                    html += `
                        <div class="stat-row">
                            <div style="flex: 1;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span class="stat-label">${label}</span>
                                    <span class="stat-value">${value}</span>
                                </div>
                                <div class="rating-bar">
                                    <div class="rating-fill" style="width: ${percentage}%"></div>
                                </div>
                            </div>
                        </div>
                    `;
                }
            }
            document.getElementById('mainStats').innerHTML = html;
        }

        function displayTechnicalSkills(player) {
            const skills = {
                'Corners': getStatValue(player, ['Corners', 'Cor', 'Corner']),
                'Crossing': getStatValue(player, ['Crossing', 'Cro', 'Cross']),
                'Dribbling': getStatValue(player, ['Dribbling', 'Dri', 'Drib']),
                'Finishing': getStatValue(player, ['Finishing', 'Fin', 'Finish']),
                'First Touch': getStatValue(player, ['First Touch', 'Fir', 'First']),
                'Free Kicks': getStatValue(player, ['Free Kick Taking', 'Fre', 'FK']),
                'Heading': getStatValue(player, ['Heading', 'Hea', 'Head']),
                'Long Shots': getStatValue(player, ['Long Shots', 'Lon', 'LS']),
                'Long Throws': getStatValue(player, ['Long Throws', 'L Th', 'LT']),
                'Marking': getStatValue(player, ['Marking', 'Mar', 'Mark']),
                'Passing': getStatValue(player, ['Passing', 'Pas', 'Pass']),
                'Penalty Taking': getStatValue(player, ['Penalty Taking', 'Pen', 'PT']),
                'Tackling': getStatValue(player, ['Tackling', 'Tck', 'Tac']),
                'Technique': getStatValue(player, ['Technique', 'Tec', 'Tech'])
            };

            displaySkillBars('technicalSkills', skills);
        }

        function displayMentalSkills(player) {
            const skills = {
                'Aggression': getStatValue(player, ['Aggression', 'Agg', 'Agr']),
                'Anticipation': getStatValue(player, ['Anticipation', 'Ant', 'Anti']),
                'Bravery': getStatValue(player, ['Bravery', 'Bra', 'Brv']),
                'Composure': getStatValue(player, ['Composure', 'Cmp', 'Com']),
                'Concentration': getStatValue(player, ['Concentration', 'Cnt', 'Con']),
                'Decisions': getStatValue(player, ['Decisions', 'Dec', 'Decs']),
                'Determination': getStatValue(player, ['Determination', 'Det', 'Deter']),
                'Flair': getStatValue(player, ['Flair', 'Fla', 'Flr']),
                'Leadership': getStatValue(player, ['Leadership', 'Ldr', 'Lead']),
                'Off The Ball': getStatValue(player, ['Off The Ball', 'OtB', 'OTB']),
                'Positioning': getStatValue(player, ['Positioning', 'Pos', 'Position']),
                'Teamwork': getStatValue(player, ['Teamwork', 'Tea', 'Team']),
                'Vision': getStatValue(player, ['Vision', 'Vis', 'Visi']),
                'Work Rate': getStatValue(player, ['Work Rate', 'Wor', 'WR'])
            };

            displaySkillBars('mentalSkills', skills);
        }

        function displayPhysicalSkills(player) {
            const skills = {
                'Acceleration': getStatValue(player, ['Acceleration', 'Acc', 'Accel']),
                'Agility': getStatValue(player, ['Agility', 'Agi', 'Agil']),
                'Balance': getStatValue(player, ['Balance', 'Bal', 'Balan']),
                'Jumping': getStatValue(player, ['Jumping Reach', 'Jum', 'Jump']),
                'Natural Fitness': getStatValue(player, ['Natural Fitness', 'Nat', 'NF']),
                'Pace': getStatValue(player, ['Pace', 'Pac', 'Speed']),
                'Stamina': getStatValue(player, ['Stamina', 'Sta', 'Stam']),
                'Strength': getStatValue(player, ['Strength', 'Str', 'Stren'])
            };

            displaySkillBars('physicalSkills', skills);
        }

        function displaySkillBars(elementId, skills) {
            let html = '';
            for (let [label, value] of Object.entries(skills)) {
                html += `
                    <div class="stat-row">
                        <div style="flex: 1;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span class="stat-label">${label}</span>
                                <span class="stat-value">${value}</span>
                            </div>
                            <div class="rating-bar">
                                <div class="rating-fill" style="width: ${value * 5}%"></div>
                            </div>
                        </div>
                    </div>
                `;
            }
            document.getElementById(elementId).innerHTML = html;
        }

        function displayInsights(player) {
            const insights = generateInsights(player);
            let html = '';
            
            insights.forEach(insight => {
                html += `<li class="insight-item ${insight.type}">${insight.icon} ${insight.text}</li>`;
            });
            
            document.getElementById('insightsList').innerHTML = html;
        }

        function generateInsights(player) {
            const insights = [];
            
            // Get performance metrics dari Excel
            const avgRating = parseFloat(findPlayerAttribute(player, ['Avg Rat', 'AvRat', 'Average Rating', 'Rating'])) || 0;
            const apps = parseInt(findPlayerAttribute(player, ['Apps', 'Aps', 'Appearances', 'Match'])) || 0;
            const goals = parseInt(findPlayerAttribute(player, ['Gls', 'Goals', 'Goal'])) || 0;
            const assists = parseInt(findPlayerAttribute(player, ['Asts', 'Assists', 'Ast', 'Assist'])) || 0;
            const mom = parseInt(findPlayerAttribute(player, ['MoM', 'MotM', 'Man of Match'])) || 0;
            const yellowCards = parseInt(findPlayerAttribute(player, ['Yel', 'Yellow', 'Y'])) || 0;
            const redCards = parseInt(findPlayerAttribute(player, ['Red', 'R'])) || 0;
            
            // Cek posisi untuk konteks yang tepat
            const position = findPlayerAttribute(player, ['Position', 'Posisi', 'Pos', 'pos', 'P', 'Positions']) || '';
            const isDefender = position.includes('D') && !position.includes('DM') && !position.includes('WD');
            const isMidfielder = position.includes('M') || position.includes('MC') || position.includes('DM');
            const isAttacker = position.includes('ST') || position.includes('AM') || position.includes('F');
            const isWinger = position.includes('W') && !position.includes('WB');
            
            // Overall Performance Analysis
            if (apps === 0) {
                insights.push({
                    type: 'neutral',
                    icon: '‚è∏Ô∏è',
                    text: 'Belum ada data pertandingan. Pemain perlu mendapat kesempatan bermain.'
                });
                return insights;
            }
            
            // Rating Analysis
            if (avgRating >= 7.5) {
                insights.push({
                    type: 'strength',
                    icon: '‚≠ê',
                    text: `Performa konsisten EXCELLENT dengan rating rata-rata ${avgRating.toFixed(2)}. Pemain kunci tim!`
                });
            } else if (avgRating >= 7.0) {
                insights.push({
                    type: 'strength',
                    icon: 'üëç',
                    text: `Performa SOLID dengan rating ${avgRating.toFixed(2)}. Kontributor yang dapat diandalkan.`
                });
            } else if (avgRating >= 6.5) {
                insights.push({
                    type: 'neutral',
                    icon: 'üìä',
                    text: `Performa CUKUP dengan rating ${avgRating.toFixed(2)}. Ada ruang untuk improvement.`
                });
            } else if (avgRating > 0) {
                insights.push({
                    type: 'weakness',
                    icon: 'üìâ',
                    text: `Performa di bawah standar (${avgRating.toFixed(2)}). Perlu evaluasi role dan taktik.`
                });
            }
            
            // Man of the Match Analysis
            if (mom > 0 && apps > 0) {
                const momPercent = (mom / apps * 100).toFixed(1);
                if (momPercent >= 20) {
                    insights.push({
                        type: 'strength',
                        icon: 'ÔøΩ',
                        text: `${mom} MoM dari ${apps} pertandingan (${momPercent}%). Sering jadi game changer!`
                    });
                } else if (momPercent >= 10) {
                    insights.push({
                        type: 'strength',
                        icon: 'üåü',
                        text: `${mom} kali Man of the Match. Mampu tampil gemilang di momen penting.`
                    });
                }
            }
            
            // Goal Contribution Analysis (untuk attacker/midfielder)
            const goalContribution = goals + assists;
            if (isAttacker || isWinger) {
                if (apps > 5) {
                    const gPerGame = (goals / apps).toFixed(2);
                    const gcPerGame = (goalContribution / apps).toFixed(2);
                    
                    if (gPerGame >= 0.7) {
                        insights.push({
                            type: 'strength',
                            icon: '‚öΩ',
                            text: `Produktivitas gol LUAR BIASA: ${goals} gol (${gPerGame}/match). Striker yang mematikan!`
                        });
                    } else if (gPerGame >= 0.4) {
                        insights.push({
                            type: 'strength',
                            icon: 'üéØ',
                            text: `${goals} gol dalam ${apps} pertandingan. Ancaman gol yang konsisten.`
                        });
                    } else if (goals === 0 && apps > 10) {
                        insights.push({
                            type: 'weakness',
                            icon: 'üö´',
                            text: `Belum mencetak gol dari ${apps} pertandingan. Perlu latihan finishing dan positioning.`
                        });
                    }
                    
                    if (gcPerGame >= 1.0) {
                        insights.push({
                            type: 'strength',
                            icon: 'üé≠',
                            text: `${goalContribution} goal contributions (G+A) - pemain paling produktif! (${gcPerGame}/match)`
                        });
                    }
                }
            } else if (isMidfielder) {
                if (goalContribution > 0 && apps > 5) {
                    const gcPerGame = (goalContribution / apps).toFixed(2);
                    insights.push({
                        type: 'strength',
                        icon: 'üìà',
                        text: `${goals}G + ${assists}A = ${goalContribution} kontribusi dari gelandang. Excellent box-to-box!`
                    });
                }
            } else if (isDefender && goals > 0) {
                insights.push({
                    type: 'strength',
                    icon: 'üí™',
                    text: `${goals} gol dari defender! Ancaman bola mati atau late runs yang bagus.`
                });
            }
            
            // Assist Analysis
            if (assists > 0 && apps > 5) {
                const aPerGame = (assists / apps).toFixed(2);
                if (aPerGame >= 0.5) {
                    insights.push({
                        type: 'strength',
                        icon: 'üé®',
                        text: `Playmaker sejati dengan ${assists} assists (${aPerGame}/match). Excellent vision dan passing!`
                    });
                } else if (assists >= 5) {
                    insights.push({
                        type: 'strength',
                        icon: 'ÔøΩ',
                        text: `${assists} assists - kontribusi penting dalam menciptakan peluang.`
                    });
                }
            }
            
            // Disciplinary Analysis
            if (redCards > 0) {
                insights.push({
                    type: 'weakness',
                    icon: 'ÔøΩ',
                    text: `${redCards} kartu merah! Disiplin perlu diperbaiki. Bisa merugikan tim di momen penting.`
                });
            } else if (yellowCards > 5 && apps > 0) {
                const yellowRate = (yellowCards / apps * 100).toFixed(1);
                if (yellowRate >= 30) {
                    insights.push({
                        type: 'weakness',
                        icon: 'üü®',
                        text: `${yellowCards} kartu kuning dari ${apps} match (${yellowRate}%). Aggression perlu dikontrol.`
                    });
                } else {
                    insights.push({
                        type: 'neutral',
                        icon: '‚ö†Ô∏è',
                        text: `${yellowCards} kartu kuning. Disiplin cukup baik tapi tetap perlu waspada.`
                    });
                }
            } else if (apps > 10 && yellowCards === 0) {
                insights.push({
                    type: 'strength',
                    icon: '‚úÖ',
                    text: `Disiplin sempurna! Tidak ada kartu dalam ${apps} pertandingan. Fair play excellent.`
                });
            }
            
            // Playing Time Analysis
            if (apps >= 30) {
                insights.push({
                    type: 'strength',
                    icon: 'üéÆ',
                    text: `Pemain utama dengan ${apps} penampilan. First choice dan trusted by manager.`
                });
            } else if (apps >= 15) {
                insights.push({
                    type: 'neutral',
                    icon: 'üîÑ',
                    text: `${apps} penampilan - rotasi player yang penting untuk squad depth.`
                });
            } else if (apps < 10 && avgRating >= 7.0) {
                insights.push({
                    type: 'neutral',
                    icon: 'üíé',
                    text: `Performa bagus tapi kurang playing time (${apps} apps). Kandidat untuk lebih banyak bermain.`
                });
            }
            
            return insights.length > 0 ? insights : [{
                type: 'neutral',
                icon: '‚ÑπÔ∏è',
                text: 'Belum cukup data untuk analisis mendalam. Perlu lebih banyak playing time.'
            }];
        }

        function displayTrainingRecommendations(player) {
            const recommendations = generateTrainingRecommendations(player);
            let html = '';
            
            recommendations.forEach(rec => {
                html += `
                    <div class="training-item">
                        <h4>${rec.icon} ${rec.title}</h4>
                        <p>${rec.description}</p>
                        <div style="margin-top: 10px;">
                            ${rec.attributes.map(attr => `<span class="badge badge-primary">${attr}</span>`).join('')}
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('trainingRecommendations').innerHTML = html;
        }

        function generateTrainingRecommendations(player) {
            const recommendations = [];
            const position = (findPlayerAttribute(player, ['Position', 'Posisi', 'Pos']) || '').toLowerCase();
            
            // Get performance data
            const avgRating = parseFloat(findPlayerAttribute(player, ['Avg Rat', 'AvRat', 'Average Rating'])) || 0;
            const apps = parseInt(findPlayerAttribute(player, ['Apps', 'Aps', 'Appearances'])) || 0;
            const goals = parseInt(findPlayerAttribute(player, ['Gls', 'Goals'])) || 0;
            const assists = parseInt(findPlayerAttribute(player, ['Asts', 'Assists'])) || 0;
            const yellowCards = parseInt(findPlayerAttribute(player, ['Yel', 'Yellow'])) || 0;
            const redCards = parseInt(findPlayerAttribute(player, ['Red'])) || 0;
            
            const isAttacker = position.includes('st') || position.includes('am') || position.includes('f');
            const isWinger = position.includes('w') && !position.includes('wb');
            const isMidfielder = position.includes('m') || position.includes('mc') || position.includes('dm');
            const isDefender = position.includes('d') && !position.includes('dm');
            
            // Check weak areas based on performance
            const finishing = getStatValue(player, ['Finishing', 'Fin']);
            const passing = getStatValue(player, ['Passing', 'Pas']);
            const dribbling = getStatValue(player, ['Dribbling', 'Dri']);
            const tackling = getStatValue(player, ['Tackling', 'Tck']);
            const pace = getStatValue(player, ['Pace', 'Pac']);
            const stamina = getStatValue(player, ['Stamina', 'Sta']);
            const decisions = getStatValue(player, ['Decisions', 'Dec']);
            const technique = getStatValue(player, ['Technique', 'Tec']);

            // Performance-based recommendations
            if (apps > 0) {
                // Low goal scoring for attackers
                if ((isAttacker || isWinger) && apps > 10 && goals < 5) {
                    recommendations.push({
                        icon: 'üéØ',
                        title: 'Finishing & Shooting Training (URGENT)',
                        description: `Hanya ${goals} gol dari ${apps} pertandingan. Fokus intensif pada shooting accuracy, positioning, dan composure di depan gawang.`,
                        attributes: ['Finishing', 'Composure', 'Off The Ball', 'Long Shots']
                    });
                }
                
                // Low assists for creative players
                if ((isMidfielder || isWinger) && apps > 10 && assists < 3 && passing < 14) {
                    recommendations.push({
                        icon: 'üé®',
                        title: 'Creative & Passing Training',
                        description: `Kurang kreatif dengan hanya ${assists} assists. Tingkatkan vision, passing range, dan decision making.`,
                        attributes: ['Passing', 'Vision', 'Creativity', 'Technique']
                    });
                }
                
                // Discipline issues
                if (yellowCards > 8 || redCards > 0) {
                    recommendations.push({
                        icon: 'üßò',
                        title: 'Discipline & Composure Training (PRIORITY)',
                        description: `${yellowCards} kartu kuning${redCards > 0 ? ' dan ' + redCards + ' kartu merah' : ''}. Perlu control aggression dan improve tactical discipline.`,
                        attributes: ['Composure', 'Decisions', 'Concentration', 'Teamwork']
                    });
                }
                
                // Low average rating
                if (avgRating > 0 && avgRating < 6.5) {
                    recommendations.push({
                        icon: 'üìä',
                        title: 'Overall Performance Enhancement',
                        description: `Rating rendah (${avgRating.toFixed(2)}). Review role suitability dan intensive all-round training diperlukan.`,
                        attributes: ['Match Practice', 'Position Training', 'Role Familiarity']
                    });
                }
                
                // Good performer optimization
                if (avgRating >= 7.3 && apps > 15) {
                    recommendations.push({
                        icon: '‚≠ê',
                        title: 'Elite Development Program',
                        description: `Performa excellent (${avgRating.toFixed(2)}). Maintain peak performance dan develop signature moves.`,
                        attributes: ['Advanced Techniques', 'Leadership', 'Consistency']
                    });
                }
            }

            // Priority training based on weaknesses
            if (finishing < 12 && (position.includes('st') || position.includes('am') || position.includes('w'))) {
                recommendations.push({
                    icon: 'üéØ',
                    title: 'Finishing Training (Prioritas Tinggi)',
                    description: 'Latihan shooting dan positioning di area penalty. Fokus pada composure dan decision making di depan gawang.',
                    attributes: ['Finishing', 'Composure', 'Decisions']
                });
            }

            if (passing < 12) {
                recommendations.push({
                    icon: '‚öΩ',
                    title: 'Passing & Vision',
                    description: 'Meningkatkan akurasi passing dan vision. Latihan short passing, through balls, dan switches.',
                    attributes: ['Passing', 'Vision', 'Technique']
                });
            }

            if (dribbling < 12 && (position.includes('w') || position.includes('am'))) {
                recommendations.push({
                    icon: 'üèÉ',
                    title: 'Dribbling & Ball Control',
                    description: 'Latihan close control, skill moves, dan ball retention dalam situasi pressure.',
                    attributes: ['Dribbling', 'First Touch', 'Balance']
                });
            }

            if (tackling < 12 && (position.includes('d') || position.includes('dm'))) {
                recommendations.push({
                    icon: 'üõ°Ô∏è',
                    title: 'Defensive Training',
                    description: 'Meningkatkan kemampuan tackling dan positioning defensive. Focus pada timing dan anticipation.',
                    attributes: ['Tackling', 'Marking', 'Positioning']
                });
            }

            if (pace < 12 || stamina < 12) {
                recommendations.push({
                    icon: 'üí®',
                    title: 'Physical & Fitness',
                    description: 'Program conditioning untuk meningkatkan pace, acceleration, dan stamina. Sprint training dan endurance work.',
                    attributes: ['Pace', 'Acceleration', 'Stamina', 'Natural Fitness']
                });
            }

            if (decisions < 12) {
                recommendations.push({
                    icon: 'üß†',
                    title: 'Mental & Tactical Training',
                    description: 'Video analysis dan tactical sessions untuk meningkatkan decision making dan game reading.',
                    attributes: ['Decisions', 'Anticipation', 'Concentration']
                });
            }

            if (technique < 12) {
                recommendations.push({
                    icon: '‚≠ê',
                    title: 'Technical Skills',
                    description: 'Fundamental training untuk meningkatkan technique. Ball mastery dan technical drills.',
                    attributes: ['Technique', 'First Touch', 'Agility']
                });
            }

            // Always recommend based on potential
            const ca = getStatValue(player, ['CA', 'Current Ability']);
            const pa = getStatValue(player, ['PA', 'Potential Ability']);
            
            if (pa - ca > 30) {
                recommendations.push({
                    icon: 'üöÄ',
                    title: 'Intensive Development Program',
                    description: 'Pemain punya potensi besar. Berikan playing time regular, mentoring dari senior, dan individual training yang intensif.',
                    attributes: ['Semua Atribut', 'Mentoring', 'Match Experience']
                });
            }

            // Position specific training
            if (position.includes('gk')) {
                recommendations.push({
                    icon: 'ü•ä',
                    title: 'Goalkeeper Specialist Training',
                    description: 'Shot stopping, handling, distribution, dan command of area.',
                    attributes: ['Reflexes', 'Handling', 'Kicking', 'Command']
                });
            }

            return recommendations.length > 0 ? recommendations : [{
                icon: '‚úÖ',
                title: 'Maintenance Training',
                description: 'Pemain sudah well-rounded. Fokus pada match fitness dan consistency.',
                attributes: ['Match Fitness', 'Consistency']
            }];
        }

        function displayRoleRecommendations(player) {
            const recommendations = generateRoleRecommendations(player);
            let html = '';
            
            recommendations.sort((a, b) => b.score - a.score).slice(0, 5).forEach(role => {
                const percentage = ((role.score / 20) * 100).toFixed(0);
                html += `
                    <div class="role-item">
                        <div class="role-score">${percentage}%</div>
                        <div class="role-details">
                            <div class="role-name">${role.name}</div>
                            <div class="role-desc">${role.description}</div>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('roleRecommendations').innerHTML = html;
        }

        function generateRoleRecommendations(player) {
            const roles = [];
            
            // Get key attributes
            const finishing = getStatValue(player, ['Finishing', 'Fin']);
            const passing = getStatValue(player, ['Passing', 'Pas']);
            const dribbling = getStatValue(player, ['Dribbling', 'Dri']);
            const tackling = getStatValue(player, ['Tackling', 'Tck']);
            const pace = getStatValue(player, ['Pace', 'Pac']);
            const heading = getStatValue(player, ['Heading', 'Hea']);
            const strength = getStatValue(player, ['Strength', 'Str']);
            const technique = getStatValue(player, ['Technique', 'Tec']);
            const vision = getStatValue(player, ['Vision', 'Vis']);
            const workRate = getStatValue(player, ['Work Rate', 'Wor']);
            const marking = getStatValue(player, ['Marking', 'Mar']);
            const positioning = getStatValue(player, ['Positioning', 'Pos']);
            const composure = getStatValue(player, ['Composure', 'Cmp']);
            const offTheBall = getStatValue(player, ['Off The Ball', 'OtB']);

            // Striker roles
            roles.push({
                name: 'Advanced Forward',
                description: 'Striker murni yang fokus pada finishing dan positioning di kotak penalty',
                score: (finishing * 0.3 + offTheBall * 0.25 + composure * 0.2 + pace * 0.15 + technique * 0.1)
            });

            roles.push({
                name: 'Target Man',
                description: 'Striker fisik yang menjadi target umpan dan hold-up play',
                score: (heading * 0.3 + strength * 0.25 + finishing * 0.2 + positioning * 0.15 + technique * 0.1)
            });

            roles.push({
                name: 'False Nine',
                description: 'Striker yang drop deep untuk link-up play dan kreativitas',
                score: (passing * 0.25 + vision * 0.25 + technique * 0.2 + dribbling * 0.15 + finishing * 0.15)
            });

            // Attacking Midfielder roles
            roles.push({
                name: 'Advanced Playmaker',
                description: 'Playmaker yang beroperasi di area penyerangan',
                score: (passing * 0.3 + vision * 0.25 + technique * 0.2 + dribbling * 0.15 + composure * 0.1)
            });

            roles.push({
                name: 'Attacking Midfielder (Attack)',
                description: 'Gelandang serang yang fokus pada goal contribution',
                score: (finishing * 0.25 + passing * 0.2 + dribbling * 0.2 + offTheBall * 0.2 + technique * 0.15)
            });

            // Winger roles
            roles.push({
                name: 'Inverted Winger',
                description: 'Winger yang cut inside untuk shooting atau through balls',
                score: (dribbling * 0.25 + pace * 0.25 + finishing * 0.2 + technique * 0.15 + passing * 0.15)
            });

            roles.push({
                name: 'Winger (Support)',
                description: 'Winger tradisional dengan crossing dan width',
                score: (pace * 0.25 + dribbling * 0.25 + passing * 0.2 + technique * 0.15 + workRate * 0.15)
            });

            // Midfielder roles
            roles.push({
                name: 'Deep Lying Playmaker',
                description: 'Playmaker dari posisi deep yang dictate tempo',
                score: (passing * 0.3 + vision * 0.25 + technique * 0.2 + composure * 0.15 + positioning * 0.1)
            });

            roles.push({
                name: 'Box to Box Midfielder',
                description: 'Gelandang serba bisa yang contribute di kedua area',
                score: (workRate * 0.25 + passing * 0.2 + tackling * 0.2 + pace * 0.15 + technique * 0.2)
            });

            roles.push({
                name: 'Mezzala',
                description: 'Gelandang yang drifts wide dan membuat late runs',
                score: (passing * 0.25 + technique * 0.2 + dribbling * 0.2 + offTheBall * 0.2 + vision * 0.15)
            });

            // Defensive roles
            roles.push({
                name: 'Ball Winning Midfielder',
                description: 'Gelandang defensif yang fokus pada recovering possession',
                score: (tackling * 0.3 + workRate * 0.25 + marking * 0.2 + positioning * 0.15 + pace * 0.1)
            });

            roles.push({
                name: 'Defensive Midfielder (Defend)',
                description: 'Anchor yang protect back four',
                score: (tackling * 0.25 + marking * 0.25 + positioning * 0.25 + composure * 0.15 + passing * 0.1)
            });

            // Defender roles
            roles.push({
                name: 'Ball Playing Defender',
                description: 'Defender yang comfortable dengan bola dan passing',
                score: (passing * 0.25 + technique * 0.2 + tackling * 0.2 + composure * 0.2 + positioning * 0.15)
            });

            roles.push({
                name: 'Central Defender (Defend)',
                description: 'Defender tradisional yang fokus pada defending',
                score: (tackling * 0.25 + marking * 0.25 + positioning * 0.2 + heading * 0.15 + strength * 0.15)
            });

            roles.push({
                name: 'Full Back (Support)',
                description: 'Full back yang balance antara defense dan attack',
                score: (tackling * 0.2 + marking * 0.2 + pace * 0.2 + passing * 0.2 + workRate * 0.2)
            });

            roles.push({
                name: 'Wing Back (Attack)',
                description: 'Full back yang sangat attacking dan provide width',
                score: (pace * 0.25 + workRate * 0.25 + passing * 0.2 + dribbling * 0.15 + tackling * 0.15)
            });

            return roles;
        }

        function displayComparison(player) {
            const categories = [
                {
                    name: 'Technical',
                    attrs: ['Dribbling', 'Passing', 'First Touch', 'Technique', 'Finishing']
                },
                {
                    name: 'Mental',
                    attrs: ['Decisions', 'Composure', 'Vision', 'Anticipation', 'Work Rate']
                },
                {
                    name: 'Physical',
                    attrs: ['Pace', 'Acceleration', 'Stamina', 'Strength', 'Agility']
                }
            ];

            let html = '';
            categories.forEach(cat => {
                let total = 0;
                let count = 0;
                
                cat.attrs.forEach(attr => {
                    const value = getStatValue(player, [attr, attr.substring(0, 3)]);
                    total += value;
                    count++;
                });
                
                const average = Math.round(total / count);
                const percentage = (average / 20) * 100;
                
                html += `
                    <div class="chart-bar">
                        <div class="chart-label">
                            <span>${cat.name}</span>
                            <span>${average}/20</span>
                        </div>
                        <div class="chart-bar-bg">
                            <div class="chart-bar-fill" style="width: ${percentage}%">
                                ${percentage.toFixed(0)}%
                            </div>
                        </div>
                    </div>
                `;
            });

            document.getElementById('comparisonChart').innerHTML = html;
        }

        function showDebugInfo() {
            if (playersData.length === 0) {
                alert('Tidak ada data pemain yang dimuat.');
                return;
            }
            
            const columns = Object.keys(playersData[0]);
            const sampleData = playersData[0];
            
            let message = 'üìä KOLOM YANG DITEMUKAN DI EXCEL:\n\n';
            message += 'Total Kolom: ' + columns.length + '\n\n';
            
            columns.forEach((col, idx) => {
                const value = sampleData[col];
                const displayValue = value !== null && value !== undefined ? 
                    (String(value).length > 30 ? String(value).substring(0, 30) + '...' : value) : 
                    'kosong';
                message += `${idx + 1}. "${col}" = ${displayValue}\n`;
            });
            
            message += '\nüí° Salin nama kolom yang benar dan laporkan jika ada masalah!';
            
            alert(message);
            console.log('Semua kolom:', columns);
            console.log('Data pemain pertama:', sampleData);
        }
    </script>
</body>
</html>
