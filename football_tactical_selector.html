<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¯ Football Tactical Selector</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #0f3460 0%, #16213e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .selector-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 5px solid #1f4e79;
        }

        .selector-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .dropdown-group {
            display: flex;
            flex-direction: column;
        }

        .dropdown-group label {
            font-weight: bold;
            margin-bottom: 8px;
            color: #1f4e79;
            font-size: 1.1em;
        }

        select {
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            background: white;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        select:focus {
            border-color: #1f4e79;
            outline: none;
            box-shadow: 0 0 0 3px rgba(31, 78, 121, 0.1);
        }

        select:hover {
            border-color: #2d5aa0;
        }

        .recommendations {
            background: linear-gradient(135deg, #1a472a 0%, #2d5016 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .recommendations h2 {
            text-align: center;
            margin-bottom: 25px;
            font-size: 1.8em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .recommendations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
        }

        .recommendation-item {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }

        .recommendation-item h3 {
            font-size: 1.2em;
            margin-bottom: 10px;
            color: #fff;
        }

        .recommendation-item p {
            font-size: 1.1em;
            line-height: 1.4;
            color: #f0f0f0;
        }

        .instructions {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 20px;
            margin-top: 30px;
        }

        .instructions h3 {
            color: #856404;
            margin-bottom: 15px;
        }

        .instructions ul {
            list-style-type: none;
            padding-left: 0;
        }

        .instructions li {
            margin-bottom: 8px;
            padding-left: 25px;
            position: relative;
            color: #856404;
        }

        .instructions li:before {
            content: "âœ“";
            position: absolute;
            left: 0;
            color: #28a745;
            font-weight: bold;
        }

        .refresh-section {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
        }

        .refresh-button {
            background: linear-gradient(45deg, #c23616, #b33939);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 25px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(194, 54, 22, 0.3);
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .refresh-button:hover {
            background: linear-gradient(45deg, #b33939, #c23616);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(194, 54, 22, 0.4);
        }

        .refresh-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 10px rgba(238, 90, 36, 0.3);
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .content {
                padding: 20px;
            }
            
            .selector-grid {
                grid-template-columns: 1fr;
            }
            
            .recommendations-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>âš½ Football Tactical Selector</h1>
            <p>Pilih Strategi Terbaik Berdasarkan Kondisi Pertandingan</p>
        </div>

        <div class="content">
            <div class="selector-section">
                <h2>ğŸ¯ Pilih Kondisi Pertandingan</h2>
                <div class="selector-grid">
                    <div class="dropdown-group">
                        <label for="jenisLawan">Jenis Lawan:</label>
                        <select id="jenisLawan" onchange="updateRecommendations()">
                            <option value="">-- Pilih Jenis Lawan --</option>
                            <option value="Tim Kuat (Top 6)">Tim Kuat (Top 6)</option>
                            <option value="Tim Seimbang (Mid Table)">Tim Seimbang (Mid Table)</option>
                            <option value="Tim Lemah (Bottom Table)">Tim Lemah (Bottom Table)</option>
                            <option value="Tim Promosi">Tim Promosi</option>
                            <option value="Tim Rival">Tim Rival</option>
                        </select>
                    </div>

                    <div class="dropdown-group">
                        <label for="formasiLawan">Formasi Lawan:</label>
                        <select id="formasiLawan" onchange="updateRecommendations()">
                            <option value="">-- Pilih Formasi Lawan --</option>
                            <option value="4-3-3">4-3-3</option>
                            <option value="4-2-3-1">4-2-3-1</option>
                            <option value="4-4-2">4-4-2</option>
                            <option value="3-5-2">3-5-2</option>
                            <option value="3-4-3">3-4-3</option>
                            <option value="5-3-2">5-3-2</option>
                            <option value="4-5-1">4-5-1</option>
                            <option value="4-1-4-1">4-1-4-1</option>
                            <option value="3-4-2-1">3-4-2-1</option>
                            <option value="4-3-2-1">4-3-2-1</option>
                        </select>
                    </div>

                    <div class="dropdown-group">
                        <label for="gayaLawan">Gaya Bermain Lawan:</label>
                        <select id="gayaLawan" onchange="updateRecommendations()">
                            <option value="">-- Pilih Gaya Lawan --</option>
                            <option value="Possession">Possession</option>
                            <option value="Pressing">Pressing</option>
                            <option value="Counter Attack">Counter Attack</option>
                            <option value="Long Ball">Long Ball</option>
                            <option value="Wing Play">Wing Play</option>
                            <option value="Defensive">Defensive</option>
                        </select>
                    </div>

                    <div class="dropdown-group">
                        <label for="kondisiLawan">Kondisi Tim Lawan:</label>
                        <select id="kondisiLawan" onchange="updateRecommendations()">
                            <option value="">-- Pilih Kondisi Lawan --</option>
                            <option value="Lawan Segar">Lawan Segar</option>
                            <option value="Lawan Lelah">Lawan Lelah</option>
                        </select>
                    </div>

                    <div class="dropdown-group">
                        <label for="situasiGame">Situasi Game:</label>
                        <select id="situasiGame" onchange="updateRecommendations()">
                            <option value="">-- Pilih Situasi Game --</option>
                            <option value="Mengejar Skor">Mengejar Skor</option>
                            <option value="Mempertahankan Keunggulan">Mempertahankan Keunggulan</option>
                            <option value="Skor Imbang">Skor Imbang</option>
                        </select>
                    </div>

                    <div class="dropdown-group">
                        <label for="kondisiKita">Kondisi Tim Kita:</label>
                        <select id="kondisiKita" onchange="updateRecommendations()">
                            <option value="">-- Pilih Kondisi Kita --</option>
                            <option value="Tim Segar">Tim Segar</option>
                            <option value="Tim Lelah">Tim Lelah</option>
                        </select>
                    </div>

                    <div class="dropdown-group">
                        <label for="waktuPertandingan">Waktu Pertandingan:</label>
                        <select id="waktuPertandingan" onchange="updateRecommendations()">
                            <option value="">-- Pilih Waktu --</option>
                            <option value="Awal Pertandingan">Awal Pertandingan (0-30')</option>
                            <option value="Babak Kedua">Babak Kedua (45-70')</option>
                            <option value="10 Menit Terakhir">Akhir Pertandingan (70-90')</option>
                            <option value="Injury Time">Injury Time (90'+)</option>
                        </select>
                    </div>

                    <div class="dropdown-group">
                        <label for="karakteristikTim">âš½ Karakteristik Tim Kita:</label>
                        <select id="karakteristikTim" onchange="updateRecommendations()">
                            <option value="">-- Pilih Karakteristik Tim --</option>
                            <option value="Tim Balanced">Tim Balanced</option>
                            <option value="Tim dengan Winger Cepat">Tim dengan Winger Cepat</option>
                            <option value="Tim dengan Bek Kuat">Tim dengan Bek Kuat</option>
                            <option value="Tim dengan AMC Kreatif">Tim dengan AMC Kreatif</option>
                            <option value="Tim dengan DMC Solid">Tim dengan DMC Solid</option>
                            <option value="Tim Defensif">Tim Defensif</option>
                            <option value="Tim dengan 3 Striker">Tim dengan 3 Striker</option>
                            <option value="Tim Lemah Menyerang">Tim Lemah Menyerang</option>
                            <option value="Tim Sangat Defensif">Tim Sangat Defensif</option>
                            <option value="Tim Fleksibel">Tim Fleksibel</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="refresh-section">
                <button onclick="refreshAll()" class="refresh-button" title="Reset all dropdowns and recommendations (Ctrl+R)">
                    ğŸ”„ Refresh / Reset All
                </button>
            </div>

            <!-- Analisis Kesesuaian Tim -->
            <div class="recommendations" id="teamSuitabilitySection" style="background: linear-gradient(135deg, #0f5132 0%, #0a3622 100%); display: none;">
                <h2>ğŸ” Analisis Kesesuaian Formasi dengan Tim Anda</h2>
                <div class="recommendations-grid">
                    <div class="recommendation-item">
                        <h3>ğŸ’ª Kekuatan Tim</h3>
                        <p id="teamStrength">-</p>
                    </div>
                    <div class="recommendation-item">
                        <h3>âš ï¸ Kelemahan Tim</h3>
                        <p id="teamWeakness">-</p>
                    </div>
                    <div class="recommendation-item">
                        <h3>âœ… Kesesuaian Formasi</h3>
                        <p id="formationSuitability">-</p>
                    </div>
                </div>
            </div>

            <div class="recommendations" id="recommendationsSection">
                <h2>ğŸ“‹ Rekomendasi Taktik</h2>
                <div class="recommendations-grid">
                    <div class="recommendation-item">
                        <h3>ğŸ”¢ Formasi Utama:</h3>
                        <p id="formasiUtama">Pilih kondisi pertandingan untuk melihat rekomendasi</p>
                    </div>
                    <div class="recommendation-item">
                        <h3>ğŸ”„ Formasi Alternatif:</h3>
                        <p id="formasiAlternatif">-</p>
                    </div>
                    <div class="recommendation-item">
                        <h3>ğŸ“ Instruksi Khusus:</h3>
                        <p id="instruksiKhusus">-</p>
                    </div>
                    <div class="recommendation-item">
                        <h3>âš¡ Tempo Permainan:</h3>
                        <p id="tempoPermainan">-</p>
                    </div>
                    <div class="recommendation-item">
                        <h3>â­ Pemain Kunci:</h3>
                        <p id="pemainKunci">-</p>
                    </div>
                    <div class="recommendation-item">
                        <h3>ğŸ›¡ï¸ Out of Possession:</h3>
                        <p id="outOfPossession">-</p>
                    </div>
                    <div class="recommendation-item">
                        <h3>ğŸ“ Defensive Line:</h3>
                        <p id="defensiveLine">-</p>
                    </div>
                    <div class="recommendation-item">
                        <h3>ğŸ¯ Marking Strategy:</h3>
                        <p id="markingStrategy">-</p>
                    </div>
                    <div class="recommendation-item">
                        <h3>âš¡ Pressing Strategy:</h3>
                        <p id="pressingStrategy">-</p>
                    </div>
                    <div class="recommendation-item">
                        <h3>ğŸŸï¸ Set Pieces:</h3>
                        <p id="setPieces">-</p>
                    </div>
                    <div class="recommendation-item">
                        <h3>ğŸ”„ Substitutions:</h3>
                        <p id="substitutionPlan">-</p>
                    </div>
                    <div class="recommendation-item">
                        <h3>âš ï¸ Risiko/Catatan:</h3>
                        <p id="risikoHint">-</p>
                    </div>
                    <div class="recommendation-item" id="kondisiTimInfo" style="display: none;">
                        <h3>ğŸ’¡ Pengaruh Kondisi Tim:</h3>
                        <p id="kondisiImpact">-</p>
                    </div>
                </div>
            </div>

            <!-- Tambahan: Kesimpulan Gaya Permainan -->
            <div class="recommendations" id="gayaPermainanSection" style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);">
                <h2>ğŸ® Kesimpulan Gaya Permainan</h2>
                <div class="recommendations-grid">
                    <div class="recommendation-item">
                        <h3>ğŸ† Gaya Utama</h3>
                        <p id="gayaUtama">Pilih taktik untuk melihat analisis gaya permainan</p>
                    </div>
                    <div class="recommendation-item">
                        <h3>ğŸ“Š Filosofi Offensive</h3>
                        <p id="filosofiOffensive">-</p>
                    </div>
                    <div class="recommendation-item">
                        <h3>ğŸ›¡ï¸ Filosofi Defensive</h3>
                        <p id="filosofiDefensive">-</p>
                    </div>
                    <div class="recommendation-item">
                        <h3>ğŸ”¥ Intensitas</h3>
                        <p id="intensitasLevel">-</p>
                    </div>
                    <div class="recommendation-item">
                        <h3>âš½ Karakteristik Utama</h3>
                        <p id="karakteristikUtama">-</p>
                    </div>
                    <div class="recommendation-item">
                        <h3>âš½ Strategi Passing</h3>
                        <p id="strategiPassing">-</p>
                    </div>
                    <div class="recommendation-item">
                        <h3>ğŸ¯ Risk vs Reward</h3>
                        <p id="riskReward">-</p>
                    </div>
                </div>
            </div>

            <div class="instructions">
                <h3>ğŸ“ Petunjuk Penggunaan:</h3>
                <ul>
                    <li>Pilih dropdown sesuai kondisi pertandingan Anda</li>
                    <li>Rekomendasi akan muncul otomatis di area hijau</li>
                    <li>Sesuaikan formasi dengan kekuatan tim Anda</li>
                    <li>Perhatikan kondisi pemain dan stamina tim</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Enhanced Database with Modern Tactical Systems
        const tacticalDatabase = {
            // === MODERN TACTICAL SYSTEMS ===
            
            // Vs 4-3-3 (Enhanced)
            "Tim Kuat (Possession-based)|4-3-3|Mengejar Skor": {
                formasi: "4-2-3-1 Gegenpress",
                alternatif: "3-4-3 False 9",
                gaya: "Vertical Tiki-Taka & Gegenpressing",
                instruksi: "High intensity pressing<br>Quick vertical passes<br>Inverted wingers cutting inside",
                tempo: "Very High Tempo - Constant pressure, 6-second rule",
                pemain: "ST (False 9): Drops deep to link play<br>LW/RW (Inverted Wingers): Cut inside for shots/passes<br>CM (Box-to-Box): High stamina, two-way play<br>GK (Sweeper Keeper): High line support",
                outOfPossession: "4-2-3-1 Ultra High Block - Gegenpress immediately",
                defensiveLine: "Much Higher Line (80-90%)",
                marking: "ğŸ¯ CAM man-marks their playmaker: Shadow their creative hub<br>ğŸ¯ FB/WB press their wingers: Step up aggressively<br>ğŸ¯ CDM traps their build-up: Force play to one side",
                pressing: "âš¡ ST initiates press: Win ball back within 6 seconds<br>âš¡ CAM + CM coordinate: 3+ players press simultaneously<br>âš¡ CDM counter-counter press: Re-press if first press fails",
                setpieces: "ğŸŸï¸ Corners: Near post flick-ons<br>ğŸŸï¸ Free kicks: Quick short passes<br>ğŸŸï¸ Throw-ins: Quick release to maintain tempo",
                substitutions: "60' - Fresh legs for pressing<br>75' - Defensive sub if leading<br>85' - All-out attack if trailing",
                risiko: "Extremely vulnerable to counter if press fails"
            },
            
            // Vs 4-2-3-1 (Klopp-style)
            "Tim Kuat (Possession-based)|4-2-3-1|Mengejar Skor": {
                formasi: "4-3-3 Heavy Metal",
                alternatif: "4-2-2-2 Hybrid",
                gaya: "Heavy Metal Football & Transitional Play",
                instruksi: "Neutralize their CAM<br>Exploit half-spaces<br>Quick transitions on turnovers",
                tempo: "Higher Tempo - Direct play, quick switches",
                pemain: "CDM (Regista): Deep-lying playmaker with vision<br>CM (Mezzala): Half-space exploitation<br>LW/RW (Inside Forwards): Width + goal threat<br>FB (Attacking): Provide width in attack",
                outOfPossession: "4-1-4-1 High Block - Press CAM trigger",
                defensiveLine: "Higher Line (70-80%)",
                marking: "ğŸ¯ CDM man-marks their CAM: Follow everywhere<br>ğŸ¯ CM double-press their CDM: Overload their pivot<br>ğŸ¯ CB forces wide: Funnel play to touchlines",
                pressing: "âš¡ ST triggers on their CAM: Press when they receive ball<br>âš¡ CM + CAM squeeze: Midfield line steps up together<br>âš¡ LW/RW wing traps: Force play wide then press aggressively",
                setpieces: "ğŸŸï¸ Corners: Back post headers<br>ğŸŸï¸ Free kicks: Low driven shots<br>ğŸŸï¸ Quick restarts: Catch opponent off-guard",
                substitutions: "65' - Impact winger for tired fullback<br>70' - Fresh midfielder for pressing<br>80' - Target man if struggling to score",
                risiko: "CAM could drop deeper to avoid marking"
            },
            
            // Vs 4-4-2 (Modern Response)
            "Tim Fisik/Tinggi|4-4-2|Mengejar Skor": {
                formasi: "3-5-2 Fluid",
                alternatif: "4-1-2-1-2 Diamond",
                gaya: "Tiki-Taka & Overloads",
                instruksi: "Overload midfield numerically<br>Quick passing combinations<br>Exploit numerical superiority",
                tempo: "Higher Tempo - Quick combinations, constant movement",
                pemain: "Wing-backs: Provide width and pace<br>Trequartista: Creative link between lines<br>Complete Forwards: Mobile, technical strikers<br>Ball Winner: Destroyer in midfield",
                outOfPossession: "5-3-2 Mid Block - Compact and organized",
                defensiveLine: "Standard Line (55-65%)",
                marking: "ğŸ¯ Mark their strikers: Central CBs in close contact<br>ğŸ¯ Press their CMs: Overload with 3v2 midfield<br>ğŸ¯ Cover flanks: Wing-backs track their wide midfield",
                pressing: "âš¡ Midfield overload: Use numerical advantage to win ball<br>âš¡ Quick combinations: Short passes to bypass their block<br>âš¡ Switch play: Use wing-backs to stretch play",
                setpieces: "ğŸŸï¸ Corners: Near post runs from wing-backs<br>ğŸŸï¸ Free kicks: Wall pass combinations<br>ğŸŸï¸ Goal kicks: Short to CBs for build-up",
                substitutions: "60' - Fresh wing-back for pace<br>70' - Additional striker if needed<br>80' - Playmaker for control",
                risiko: "Wing-backs need exceptional stamina for both phases"
            },

            // Vs 3-5-2 (Conte-style Counter)
            "Tim Counter-attack|3-5-2|Skor Imbang": {
                formasi: "4-3-3 Possession+",
                alternatif: "4-2-3-1 Wide",
                gaya: "Positional Play & Width Exploitation",
                instruksi: "Stretch their wing-backs wide<br>Patient build-up from the back<br>Exploit space behind their defense",
                tempo: "Standard Tempo - Controlled rhythm, sudden acceleration",
                pemain: "Wingers: Stay wide to stretch formation<br>Deep-lying Playmaker: Tempo control from deep<br>Box-to-Box: Cover ground, late runs<br>False 9: Drop deep to create overloads",
                outOfPossession: "4-1-4-1 Wide Block - Force play centrally",
                defensiveLine: "Standard Line (50-60%)",
                marking: "ğŸ¯ Mark their wing-backs: Track with wingers when they advance<br>ğŸ¯ Press their midfield: Central overload to win possession<br>ğŸ¯ Cover their strikers: CBs stay disciplined",
                pressing: "âš¡ Central press: Overload midfield when they play inside<br>âš¡ Wing isolation: Force play wide then press with winger + fullback<br>âš¡ Counter-press: Immediate reaction when losing ball",
                setpieces: "ğŸŸï¸ Corners: Inswingers to back post<br>ï¿½ï¸ Free kicks: Driven balls into box<br>ï¿½ï¸ Throw-ins: Long throws to cause problems",
                substitutions: "65' - Impact sub for tired winger<br>75' - Additional midfielder for control<br>85' - Target man for crosses",
                risiko: "Must maintain width discipline to stretch their formation"
            },

            // Modern False 9 System
            "Tim Lemah (Defensive)|5-3-2|Mengejar Skor": {
                formasi: "4-2-3-1 False 9",
                alternatif: "3-4-3 Total Football",
                gaya: "False 9 + Inverted Wingers",
                instruksi: "False 9 drops deep to link play<br>Inverted wingers attack space<br>Patient build-up from back",
                tempo: "Standard Tempo - Build up patiently, quick when opportunity arises",
                pemain: "False 9: Drops to link play, creates space for wingers<br>Inverted Wingers: Cut inside for shots and passes<br>Deep-lying Playmaker: Dictate tempo from deep<br>Advanced Playmaker: Link with False 9",
                outOfPossession: "4-2-3-1 Mid Block - Compact defending",
                defensiveLine: "Higher Line (65-75%)",
                marking: "ğŸ¯ Mark their striker: CBs stay close but watch for False 9 movement<br>ğŸ¯ Track their wing-backs: Fullbacks must be disciplined<br>ğŸ¯ Press their midfield: When they play centrally",
                pressing: "âš¡ Coordinated press: Move as unit when opportunity arises<br>âš¡ False 9 press: Drops back to press their DM<br>âš¡ Wing press: Inverted wingers help press their wing-backs",
                setpieces: "ğŸŸï¸ Corners: Mixed delivery - near and far post<br>ğŸŸï¸ Free kicks: False 9 creates confusion in wall<br>ğŸŸï¸ Penalties: Designated taker with backup",
                substitutions: "60' - True striker for False 9 if not working<br>70' - Fresh winger for pace<br>80' - Target man for crosses",
                risiko: "False 9 must have exceptional technical ability and vision"
            },

            
            // === HYBRID SYSTEMS & MODERN VARIATIONS ===
            
            // Pep's 4-2-2-2 Counter
            "Tim Possession|4-2-2-2|Skor Imbang": {
                formasi: "3-4-1-2 Fluid",
                alternatif: "4-1-2-1-2 Diamond",
                gaya: "Positional Play & Triangulation",
                instruksi: "Create triangles, overload central areas, patient build-up",
                tempo: "Standard Tempo - Controlled build-up, accelerate in final third",
                pemain: "Libero: Ball-playing defender to start attacks<br>Attacking Midfielders: Technical players for tight spaces<br>False 9/10: Interchange positions frequently<br>Wing-backs: Provide sole width in system",
                outOfPossession: "5-2-1-2 Compact Block - Ultra compact defending",
                defensiveLine: "Higher Line (70-80%)",
                marking: "ğŸ¯ Man-mark their AMs: Defensive midfielders follow<br>ğŸ¯ Press their DMs: Advanced midfielder disrupts build-up<br>ğŸ¯ Compress space: Make playing area as small as possible",
                pressing: "âš¡ Coordinated press: All 5 outfield players press simultaneously<br>âš¡ Triangle press: Surround ball carrier with 3 players<br>âš¡ Recover shape: Immediately drop back if press fails",
                setpieces: "ğŸŸï¸ Corners: Near post pullbacks to edge of box<br>ğŸŸï¸ Free kicks: Complex routines with multiple movers<br>ğŸŸï¸ Goal kicks: Always short to build from back",
                substitutions: "60' - Technical midfielder for control<br>70' - Pace injection on wings<br>80' - Target man for directness",
                risiko: "Extremely difficult system requiring world-class technical players"
            },

            // Anti-Tiki-Taka (Athletic Bilbao style)
            "Tim Teknis/Possession|Any|Mempertahankan Keunggulan": {
                formasi: "4-4-2 Athletic",
                alternatif: "4-2-3-1 Press",
                gaya: "Rugged Pressing & Physicality",
                instruksi: "Disrupt their rhythm, physical challenges, win second balls",
                tempo: "Variable Tempo - Slow their tempo, fast when we have ball",
                pemain: "Ball Winner Midfielder: Destroyer type to break play<br>Box-to-Box: High stamina for constant running<br>Target Man: Physical presence up front<br>Stopper CB: Aggressive defending, stop attacks early",
                outOfPossession: "4-4-2 Aggressive Mid Block - Press triggers everywhere",
                defensiveLine: "Standard Line (50-60%)",
                marking: "ğŸ¯ Mark their playmaker: Man-marking their creative hub<br>ğŸ¯ Double-team: Two players press ball carrier<br>ğŸ¯ Cut passing lanes: Block their preferred passing routes",
                pressing: "âš¡ Aggressive press: Physical, legal challenges<br>âš¡ Force long balls: Make them play direct football<br>âš¡ Win second balls: Compete for every loose ball",
                setpieces: "ğŸŸï¸ Corners: Physical challenges in box<br>ğŸŸï¸ Free kicks: Disrupt their routines<br>ğŸŸï¸ Throw-ins: Long throws for chaos",
                substitutions: "65' - Fresh legs for pressing<br>75' - Defensive midfielder for control<br>85' - Time-wasting substitution",
                risiko: "Risk of bookings with aggressive approach"
            },

            // Liverpool's 4-3-3 vs Low Block
            "Tim Lemah (Defensive)|5-4-1|Mengejar Skor": {
                formasi: "4-3-3 Klopp",
                alternatif: "4-2-3-1 Creative",
                gaya: "Heavy Metal + Patience",
                instruksi: "Patient build-up, quick switches, cross and cutback combinations",
                tempo: "Variable Tempo - Patient until opening appears",
                pemain: "Creative 8s: Mezzala-type midfielders<br>Inverted Full-backs: Tuck in to create overloads<br>Inside Forwards: Cut inside from wide positions<br>False 9: Drops deep to create space",
                outOfPossession: "4-3-3 High Recovery - Win ball back quickly",
                defensiveLine: "Much Higher Line (80-90%)",
                marking: "ğŸ¯ Compress play: Make field as small as possible<br>ğŸ¯ Force errors: High line forces long balls<br>ğŸ¯ Trap offside: Coordinate defensive line movement",
                pressing: "âš¡ 6-second rule: Win ball back within 6 seconds<br>âš¡ Coordinated squeeze: All lines move up together<br>âš¡ Counter-counter press: Re-press immediately if first fails",
                setpieces: "ğŸŸï¸ Corners: Variety - inswingers, outswingers, short<br>ğŸŸï¸ Free kicks: Driven low balls across goal<br>ğŸŸï¸ Quick restarts: Catch defense disorganized",
                substitutions: "60' - Creative midfielder for control<br>70' - Pace on bench for tired defender<br>80' - Target man for crosses",
                risiko: "High line vulnerable to pacey forwards"
            },

            // City's False 9 vs Pressing Teams
            "Tim Pressing Tinggi|Any|Skor Imbang": {
                formasi: "4-3-3 Possession Plus",
                alternatif: "3-2-4-1 Fluid",
                gaya: "Tiki-Taka + False 9",
                instruksi: "Short passing under pressure, false 9 drops deep, create overloads",
                tempo: "Lower Tempo - Control game rhythm, speed up suddenly",
                pemain: "False 9: Excellent first touch and vision<br>Attacking Midfielders: Press-resistant, quick passing<br>Inverted Full-backs: Tuck in to create central overloads<br>Deep-lying Playmaker: Tempo control from deep",
                outOfPossession: "4-1-4-1 Compact - Absorb pressure then counter",
                defensiveLine: "Higher Line (65-75%)",
                marking: "ğŸ¯ Bait the press: Draw opponents out of position<br>ğŸ¯ Escape routes: Always have 2+ passing options<br>ğŸ¯ Overload zones: Create numerical advantages",
                pressing: "âš¡ Selective press: Only press when certain to win<br>âš¡ False 9 press: Drops back to press their DM<br>âš¡ Patience: Wait for right moment to attack",
                setpieces: "ğŸŸï¸ Corners: Short corners to maintain possession<br>ğŸŸï¸ Free kicks: Complex routines to confuse<br>ğŸŸï¸ Goal kicks: Always short build-up",
                substitutions: "60' - Fresh midfielder for tired presser<br>70' - Pace injection if chasing game<br>80' - Control midfielder to see out game",
                risiko: "Requires exceptional technical ability under pressure"
            },
            "Tim Kuat (Possession-based)|Mengejar Skor (Trailing)": {
                formasi: "4-2-3-1 Attacking",
                alternatif: "3-5-2",
                gaya: "High Press & Quick Transition",
                instruksi: "Pressing tinggi, overlapping fullbacks, false 9",
                pemain: "CAM kreatif, Wing-back cepat, Striker mobile",
                outOfPossession: "4-4-2 High Block, Gegenpress",
                defensiveLine: "Higher Line (70-80%)",
                risiko: "Rentan counter-attack, butuh stamina tinggi"
            },
            "Tim Kuat (Possession-based)|Mempertahankan Keunggulan (Leading)": {
                formasi: "4-3-3 Possession",
                alternatif: "4-5-1",
                gaya: "Controlled Possession",
                instruksi: "Maintain possession, compact defending",
                pemain: "DM anchor, CB ball-playing, Winger tracking back",
                outOfPossession: "4-5-1 Mid Block, Maintain shape",
                defensiveLine: "Standard Line (50-60%)",
                risiko: "Jangan terlalu pasif, tetap ancam balik"
            },
            "Tim Lemah (Defensive)|Mengejar Skor (Trailing)": {
                formasi: "4-4-2 Direct",
                alternatif: "3-4-3",
                gaya: "Direct & Aggressive",
                instruksi: "Long balls, set pieces, pressure tinggi",
                pemain: "Target man, Winger cepat, Strong midfield",
                outOfPossession: "4-4-2 Mid Block, Quick press",
                defensiveLine: "Standard Line (55-65%)",
                risiko: "Bisa kehabisan tenaga, rentan counter"
            },
            "Tim Counter-attack|10 Menit Terakhir": {
                formasi: "3-4-3 All-Out Attack",
                alternatif: "4-2-4",
                gaya: "Ultra Attacking",
                instruksi: "All-out attack, high line, gegenpressing",
                pemain: "Fast wingers, Creative CAM, Clinical finishers",
                outOfPossession: "3-4-3 High Block, Immediate press",
                defensiveLine: "Much Higher Line (80-90%)",
                risiko: "Sangat rentan counter, all-or-nothing"
            },
            "Tim Counter-attack|Skor Imbang (Drawing)": {
                formasi: "4-3-3 Balanced",
                alternatif: "4-2-3-1",
                gaya: "Patient Build-up & Quick Counter",
                instruksi: "Compact defending, quick transition, width",
                pemain: "Fast wingers, Strong DM, Creative midfielder",
                outOfPossession: "4-1-4-1 Mid Block, Counter-press",
                defensiveLine: "Standard Line (50-60%)",
                risiko: "Butuh timing tepat, jangan terburu-buru"
            },
            "Tim Pressing Tinggi|Mempertahankan Keunggulan (Leading)": {
                formasi: "5-4-1 Defensive",
                alternatif: "4-5-1",
                gaya: "Ultra Defensive & Counter",
                instruksi: "Deep block, counter-attack only, time wasting",
                pemain: "Strong defenders, Fast striker, Defensive midfield",
                outOfPossession: "5-4-1 Low Block, Absorb pressure",
                defensiveLine: "Much Lower Line (30-40%)",
                risiko: "Sulit mencetak gol, pressure mental tinggi"
            },
            "Tim Fisik/Tinggi|Mengejar Skor (Trailing)": {
                formasi: "4-4-2 Direct",
                alternatif: "3-5-2",
                gaya: "Physical & Direct",
                instruksi: "Long balls, crosses, set pieces, aerial duels",
                pemain: "Tall strikers, Strong midfield, Crossing specialists",
                outOfPossession: "4-4-2 Mid Block, Win aerial duels",
                defensiveLine: "Standard Line (50-60%)",
                risiko: "Tergantung kemampuan aerial, bisa mudah dibaca"
            },
            "Tim Seimbang (Balanced)|Awal Pertandingan": {
                formasi: "4-3-3 Standard",
                alternatif: "4-2-3-1",
                gaya: "Balanced Approach",
                instruksi: "Feel the game, adaptasi sesuai kondisi",
                pemain: "Versatile players, Good team chemistry",
                outOfPossession: "4-3-3 Mid Block, Balanced press",
                defensiveLine: "Standard Line (50-60%)",
                risiko: "Bisa kurang decisif, butuh adaptasi cepat"
            },

            // Menambah entries untuk jenis lawan baru
            "Tim Sedang (Balanced)|Skor Imbang (Drawing)": {
                formasi: "4-3-3 Standard",
                alternatif: "4-2-3-1",
                gaya: "Balanced Approach",
                instruksi: "Maintain shape, patient build-up, exploit opportunities",
                pemain: "Well-rounded players, Versatile midfield",
                outOfPossession: "4-3-3 Mid Block, Structured defending",
                defensiveLine: "Standard Line (50-60%)",
                risiko: "Pertahankan disiplin, jangan overcommit"
            },
            "Tim Pressing Tinggi|Mempertahankan Keunggulan (Leading)": {
                formasi: "4-5-1 Defensive",
                alternatif: "5-4-1",
                gaya: "Compact & Counter",
                instruksi: "Compact defending, quick counter, waste time",
                pemain: "DM anchor, Pacey wingers, Target man",
                outOfPossession: "4-5-1 Low Block, Absorb pressure",
                defensiveLine: "Lower Line (40-50%)",
                risiko: "Jangan terlalu defensif, tetap ancam counter"
            },
            "Tim Fisik/Tinggi|Away": {
                formasi: "4-4-2 Compact",
                alternatif: "5-3-2",
                gaya: "Physical & Direct",
                instruksi: "Win duels, long balls, set pieces",
                pemain: "Strong midfield, Aerial threat, Physical defenders",
                outOfPossession: "4-4-2 Low Block, Win headers",
                defensiveLine: "Lower Line (40-50%)",
                risiko: "Waspadai space behind, quick passing lawan"
            },
            "Tim Teknis/Pendek|Home": {
                formasi: "4-3-3 Possession",
                alternatif: "3-4-3",
                gaya: "High Tempo Passing",
                instruksi: "Quick passing, high press, technical football",
                pemain: "Technical midfield, Pacey wingers, Mobile striker",
                outOfPossession: "4-3-3 High Block, Immediate press",
                defensiveLine: "Higher Line (65-75%)",
                risiko: "Manfaatkan home advantage, waspada long balls"
            },
            
            // === TIME-BASED & SITUATIONAL TACTICS ===
            
            // Early Game Balanced Approach
            "Tim Seimbang|Any|Awal Pertandingan": {
                formasi: "4-3-3 Balanced",
                alternatif: "4-2-3-1 Adaptive",
                gaya: "Study & Adapt",
                instruksi: "Conservative start, analyze opponent patterns, find weaknesses",
                tempo: "Standard Tempo - Gauge their rhythm first",
                pemain: "Versatile midfield: Can switch roles<br>Experienced defenders: Read the game<br>Pacey wingers: Test their fullbacks early",
                outOfPossession: "4-3-3 Mid Block - Learn their patterns",
                defensiveLine: "Standard Line (50-60%)",
                marking: "ğŸ¯ Study movement: Learn their attacking patterns<br>ğŸ¯ Test their press: See reaction to our build-up",
                pressing: "âš¡ Probe press: Test where they struggle<br>âš¡ Map triggers: Learn when they like to press",
                setpieces: "ğŸŸï¸ Test routines: Try different delivery styles<br>ğŸŸï¸ Study their setup: Analyze defensive marking",
                substitutions: "30' - Early tactical change if struggling<br>HT - Major adjustments based on findings",
                risiko: "Too cautious against aggressive opponents"
            },
            
            // === SPECIFIC OPPONENT TYPES FROM DROPDOWN ===
            
            // Tim Kuat (Top 6) - Need defensive solidity and counter opportunities
            "Tim Kuat (Top 6)|Mengejar Skor": {
                formasi: "4-2-3-1 Counter-Attack",
                alternatif: "3-5-2 Compact",
                gaya: "Compact Counter & Set Pieces | RECOMMENDED STYLE: Counter-Press/Defensive",
                instruksi: "Absorb pressure patiently<br>Quick transitions on turnovers<br>Exploit set pieces opportunities",
                tempo: "Lower Tempo - Patient build-up, wait for opportunities",
                pemain: "CDM (Ball Winner): Strong tacklers and ball winners<br>ST/LW/RW (Pacey): Quick transitions and counter-attacks<br>CAM (Set Piece Specialist): Corners and free kicks crucial",
                outOfPossession: "4-2-3-1 Deep Block - Absorb their possession",
                defensiveLine: "Lower Line (40-50%)",
                marking: "ğŸ›¡ï¸ CB + CDM compact: Stay tight, deny space between lines<br>ğŸ›¡ï¸ CAM presses their playmaker: Don't let their best player dictate<br>ğŸ›¡ï¸ FB cover wide: Prevent overlapping fullbacks",
                pressing: "ğŸ›¡ï¸ CDM selective press: Press when certain to win ball<br>ğŸ›¡ï¸ ST/LW/RW transition: Fast counter-attacks when winning ball<br>ğŸ›¡ï¸ CB + CDM protect center: Force them wide where less dangerous",
                setpieces: "âš¡ Set piece focus: Best chance against top teams<br>âš¡ Target their weak headers: Find aerial mismatches<br>âš¡ Quick corners: Catch them organizing",
                substitutions: "60' - Fresh legs for pressing<br>70' - Pace for counter-attacks<br>80' - Defensive stability",
                risiko: "Limited possession, need clinical finishing"
            },
            
            "Tim Kuat (Top 6)|Skor Imbang": {
                formasi: "4-3-3 Compact",
                alternatif: "5-3-2 Defensive",
                gaya: "Disciplined Structure | RECOMMENDED STYLE: Balanced/Cautious",
                instruksi: "Stay compact defensively<br>Deny space between lines<br>Exploit their mistakes",
                tempo: "Standard Tempo - Match their rhythm, stay organized",
                pemain: "Disciplined midfielders: Maintain shape and work rate<br>Clinical finishers: Take limited chances<br>Solid defenders: No silly mistakes",
                outOfPossession: "4-3-3 Mid Block - Structured defending",
                defensiveLine: "Standard Line (50-60%)",
                marking: "ğŸ¯ ZONAL COVERAGE: Maintain shape, cover spaces<br>ğŸ¯ Track their runners: Don't let them find space<br>ğŸ¯ Limit their time: Press without losing shape",
                pressing: "âš¡ COORDINATED PRESS: Press as a unit<br>âš¡ Prevent switches: Block wide switches of play<br>âš¡ Force decisions: Pressure but stay compact",
                setpieces: "ğŸŸï¸ Defensive priority: Prevent their set pieces<br>ğŸŸï¸ Quick breaks: Counter from their corners<br>ğŸŸï¸ Aerial duels: Win headers in both boxes",
                substitutions: "65' - Fresh midfielder<br>75' - Pace for counter<br>85' - Defensive solidity",
                risiko: "Need perfect execution, small margin for error"
            },
            
            "Tim Kuat (Top 6)|Mempertahankan Keunggulan": {
                formasi: "5-4-1 Ultra Defensive",
                alternatif: "4-5-1 Deep",
                gaya: "Ultra Compact Defense | RECOMMENDED STYLE: Catenaccio/Park The Bus",
                instruksi: "Everyone behind the ball<br>Waste time legally<br>Defend lead at all costs",
                tempo: "Much Lower Tempo - Slow everything down",
                pemain: "CB + WB (Defensive Anchors): Strong tacklers and headers<br>CDM + CM (Time-wasting): Experienced game management<br>ST (Counter-threat): One fast forward for breaks",
                outOfPossession: "5-4-1 Ultra Deep - Maximum protection",
                defensiveLine: "Much Lower Line (25-35%)",
                marking: "ğŸ›¡ï¸ CB + WB ultra compact: Everyone defends, no space given<br>ğŸ›¡ï¸ CDM + CM double mark: Two on their best player<br>ğŸ›¡ï¸ CB + WB block everything: Bodies on the line",
                pressing: "ğŸ›¡ï¸ ST + CDM no pressing: Stay compact, don't chase<br>ğŸ›¡ï¸ CB + WB force wide: Let them have wide areas only<br>ğŸ›¡ï¸ CDM + CM time management: Legal delays and game management",
                setpieces: "ğŸ›¡ï¸ Mass defense: 10 players defend every set piece<br>ğŸ›¡ï¸ Time wasting: Slow everything legally<br>ğŸ›¡ï¸ Keeper delays: Maximum legal time",
                substitutions: "70' - Defensive specialist<br>80' - Time-wasting veteran<br>90' - Final defensive body",
                risiko: "Under siege, need mental strength"
            },
            
            // Tim Seimbang (Mid Table) - Balanced approach
            "Tim Seimbang (Mid Table)|Mengejar Skor": {
                formasi: "4-3-3 Attacking",
                alternatif: "4-2-3-1 Attack",
                gaya: "Balanced Pressure | RECOMMENDED STYLE: Balanced/Attacking",
                instruksi: "Push forward with numbers<br>Increase intensity gradually<br>Take calculated risks",
                tempo: "Higher Tempo - More urgency in attack",
                pemain: "Box-to-box midfielders: Energy for both phases<br>Wide threats: Wingers with pace and crossing<br>Clinical striker: Take chances when they come",
                outOfPossession: "4-3-3 Medium Block - Balanced approach",
                defensiveLine: "Higher Line (60-70%)",
                marking: "ğŸ¯ PRESS THEIR MIDFIELD: Win ball in middle third<br>ğŸ¯ Track their fullbacks: Prevent width in attack<br>ğŸ¯ Force mistakes: Intensity to create chances",
                pressing: "âš¡ MEDIUM INTENSITY: Sustainable pressure<br>âš¡ Win midfield: Focus on central areas<br>âš¡ Quick transitions: Fast when winning ball",
                setpieces: "ğŸŸï¸ Attacking focus: More bodies in attack<br>ğŸŸï¸ Cross variations: Different delivery types<br>ğŸŸï¸ Quick play: Catch them disorganized",
                substitutions: "60' - Attacking midfielder<br>70' - Pace on wings<br>80' - Fresh attacking threat",
                risiko: "Balanced team, need quality in final third"
            },
            
            "Tim Seimbang (Mid Table)|Skor Imbang": {
                formasi: "4-3-3 Balanced",
                alternatif: "4-2-3-1 Standard",
                gaya: "Flexible Approach | RECOMMENDED STYLE: Balanced",
                instruksi: "Maintain shape, look for openings, stay alert",
                tempo: "Standard Tempo - Adapt to game flow",
                pemain: "Versatile players: Adapt to game situations<br>Solid backbone: Reliable core performance<br>Game changers: Subs who can make difference",
                outOfPossession: "4-3-3 Standard Block - Organized structure",
                defensiveLine: "Standard Line (50-60%)",
                marking: "ğŸ¯ STRUCTURED MARKING: Maintain organization<br>ğŸ¯ Close down space: Don't give easy passes<br>ğŸ¯ Read the game: Adapt to their approach",
                pressing: "âš¡ MODERATE PRESS: Sustainable pressure<br>âš¡ Stay compact: Maintain team shape<br>âš¡ Counter opportunities: Quick when ball won",
                setpieces: "ğŸŸï¸ Balanced approach: Solid defending, some attack<br>ğŸŸï¸ Study patterns: Learn their weaknesses<br>ğŸŸï¸ Stay alert: Be ready for opportunities",
                substitutions: "60' - Tactical adjustment<br>70' - Fresh quality<br>80' - Game situation dependent",
                risiko: "Even contest, details matter"
            },
            
            // Tim Lemah (Bottom Table) - Exploit their weaknesses
            "Tim Lemah (Bottom Table)|Mengejar Skor": {
                formasi: "4-2-3-1 Dominant",
                alternatif: "3-4-3 Overload",
                gaya: "Overwhelming Attack | RECOMMENDED STYLE: Tiki-Taka/Total Football",
                instruksi: "Dominate possession completely<br>Create numerical overloads<br>Constant attacking pressure",
                tempo: "Higher Tempo - Tire them out with movement",
                pemain: "CM + CAM (Technical): Control possession completely<br>FB/WB (Overlapping): Create width and crosses<br>ST + LW/RW (Creative): Find space in final third",
                outOfPossession: "4-2-3-1 High Block - Win ball high",
                defensiveLine: "Much Higher Line (75-85%)",
                marking: "ğŸ¯ ST + CAM high press: Don't let them settle<br>ğŸ¯ CM + CDM force long balls: Press their CB<br>ğŸ¯ All outfield win ball high: Create chances from pressing",
                pressing: "âš¡ ST + CAM + LW/RW intense press: Constant pressure<br>âš¡ CM + CDM force errors: They will make mistakes<br>âš¡ CAM + CM quick combinations: Overload before they organize",
                setpieces: "ğŸŸï¸ Crowd the box: Multiple attacking threats<br>ğŸŸï¸ Short corners: Keep possession and create<br>ğŸŸï¸ Free kick shots: Test their goalkeeper",
                substitutions: "60' - Fresh creativity<br>70' - More pace wide<br>80' - Final attacking push",
                risiko: "Should dominate, must be clinical"
            },
            
            "Tim Lemah (Bottom Table)|Skor Imbang": {
                formasi: "4-3-3 Possession",
                alternatif: "4-2-3-1 Control",
                gaya: "Patient Domination | RECOMMENDED STYLE: Possession/Patient",
                instruksi: "Control tempo, tire them out, wait for openings",
                tempo: "Standard Tempo - Patient build-up",
                pemain: "Ball players: Technical ability to keep possession<br>Movement creators: Find space between lines<br>Clinical finishers: Take chances when created",
                outOfPossession: "4-3-3 Medium Block - Control territory",
                defensiveLine: "Higher Line (65-75%)",
                marking: "ğŸ¯ PATIENT PRESSING: Force them deep<br>ğŸ¯ Control spaces: Don't let them out easily<br>ğŸ¯ Tire them out: Make them chase the ball",
                pressing: "âš¡ POSSESSION PRESS: Press to win ball back<br>âš¡ High recovery: Win ball in good areas<br>âš¡ Patient approach: Don't force it",
                setpieces: "ğŸŸï¸ Variety important: Try different approaches<br>ğŸŸï¸ Technical delivery: Quality over power<br>ğŸŸï¸ Short options: Keep possession when possible",
                substitutions: "60' - More creativity<br>70' - Fresh legs<br>80' - Clinical finisher",
                risiko: "Don't be complacent, stay focused"
            },
            
            // Tim Promosi - May be motivated but limited quality
            "Tim Promosi|Mengejar Skor": {
                formasi: "4-3-3 Intense",
                alternatif: "4-2-3-1 Press",
                gaya: "High Energy Press | RECOMMENDED STYLE: Gegenpress/High Intensity",
                instruksi: "Match their intensity level<br>Press high up the pitch<br>Win physical duels",
                tempo: "High Tempo - Don't let them settle",
                pemain: "High work rate players: Match their running<br>Duel winners: Strong in physical battles<br>Set piece threats: Aerial advantage important",
                outOfPossession: "4-3-3 High Block - Match their energy",
                defensiveLine: "Higher Line (65-75%)",
                marking: "âš¡ MATCH INTENSITY: Don't be out-worked<br>âš¡ Win physical duels: Show strength<br>âš¡ Press their supply: Cut off their service",
                pressing: "âš¡ HIGH WORK RATE: Match their running<br>âš¡ Win ball quickly: Don't let them build<br>âš¡ Show authority: Dominate the duels",
                setpieces: "ğŸŸï¸ Physical advantage: Use height and strength<br>ğŸŸï¸ Attack corners: Should have aerial superiority<br>ğŸŸï¸ Crowd keeper: Pressure their distribution",
                substitutions: "60' - Fresh legs crucial<br>70' - Maintain intensity<br>80' - Final energy boost",
                risiko: "May be highly motivated, don't underestimate"
            },
            
            // Tim Rival - High stakes emotional game
            "Tim Rival|Mengejar Skor": {
                formasi: "4-2-3-1 Aggressive",
                alternatif: "3-4-3 Attacking",
                gaya: "Win-At-All-Costs | RECOMMENDED STYLE: Direct/Aggressive",
                instruksi: "Maximum commitment from all players<br>Take all necessary risks<br>Fight for every ball",
                tempo: "Very High Tempo - Maximum urgency",
                pemain: "All Positions (Warriors): Players who thrive in big games<br>CB + CDM (Leaders): Experienced heads for pressure<br>ST + CAM (Match Winners): Players who can decide derbies",
                outOfPossession: "4-2-3-1 Aggressive Block - Win every duel",
                defensiveLine: "Higher Line (70-80%)",
                marking: "ğŸ”¥ All players win everything: Every ball is crucial<br>ğŸ”¥ CAM/CDM marks their star: Stop their best player<br>ğŸ”¥ CB + FB show aggression: Let them know you're there",
                pressing: "ğŸ”¥ ST + CAM + LW/RW maximum intensity: Leave everything on pitch<br>ğŸ”¥ All outfield press everywhere: No safe passes allowed<br>ğŸ”¥ CDM + CM create chaos: High tempo, high pressure",
                setpieces: "ğŸ”¥ Crucial moments: Every set piece matters<br>ğŸ”¥ Target areas: Exploit their weaknesses<br>ğŸ”¥ Maximum bodies: Everyone in attack",
                substitutions: "60' - Game changers<br>70' - Derby specialists<br>80' - Win-at-all-costs",
                risiko: "Emotion runs high, stay disciplined"
            },

            // Late Game Desperation
            "Any|Any|Injury Time": {
                formasi: "2-3-5 All-Out",
                alternatif: "1-4-5 Total Attack",
                gaya: "Total Desperation",
                instruksi: "Everyone forward, goalkeeper joins corners, maximum chaos",
                tempo: "Maximum Tempo - Every touch counts",
                pemain: "All attackers: Every player in attack<br>Target men: Physical presence in box<br>Set piece takers: Corners and free kicks crucial",
                outOfPossession: "Minimal defense - Accept counter risk",
                defensiveLine: "Much Higher Line (95%) - Compress space",
                marking: "ğŸ¯ Minimum cover: Only prevent obvious counters<br>ğŸ¯ Box crowding: Maximum bodies forward",
                pressing: "âš¡ Desperate press: Force errors for set pieces<br>âš¡ Crowd keeper: Pressure their distribution",
                setpieces: "ğŸŸï¸ Keeper forward: Goalkeeper joins attack<br>ğŸŸï¸ Total chaos: All 11 players in their half",
                substitutions: "All used - Fresh legs for final push",
                risiko: "One counter-attack could seal defeat"
            }
        };

        // Mapping formasi berdasarkan karakteristik tim (dari tabel referensi)
        const formasiCharacteristics = {
            "4-4-2": {
                tipePermainan: "Seimbang",
                kekuatanMenyerang: 7,
                kekuatanBertahan: 7,
                kontrolTengah: 8,
                lebarSayap: 8,
                fleksibilitas: 9,
                kesulitanEksekusi: 3,
                cocokUntukPemain: "Tim Balanced",
                kelemahanUtama: "Kurang Spesialis",
                formasiDefensif: "4-4-1-1",
                perubahanPosisi: "ST mundur jadi AMC",
                tugasKhususOOP: "CM tutup ruang tengah"
            },
            "4-3-3": {
                tipePermainan: "Menyerang",
                kekuatanMenyerang: 9,
                kekuatanBertahan: 5,
                kontrolTengah: 7,
                lebarSayap: 9,
                fleksibilitas: 7,
                kesulitanEksekusi: 5,
                cocokUntukPemain: "Tim dengan Winger Cepat",
                kelemahanUtama: "Lemah Tengah",
                formasiDefensif: "4-5-1",
                perubahanPosisi: "Winger mundur jadi LM/RM",
                tugasKhususOOP: "Winger tracking back"
            },
            "3-5-2": {
                tipePermainan: "Defensive Counter",
                kekuatanMenyerang: 5,
                kekuatanBertahan: 9,
                kontrolTengah: 6,
                lebarSayap: 7,
                fleksibilitas: 6,
                kesulitanEksekusi: 6,
                cocokUntukPemain: "Tim dengan Bek Kuat",
                kelemahanUtama: "Kurang Sayap",
                formasiDefensif: "5-4-1",
                perubahanPosisi: "WB mundur jadi LM/RM",
                tugasKhususOOP: "WB jadi LB/RB"
            },
            "4-2-3-1": {
                tipePermainan: "Kreatif",
                kekuatanMenyerang: 8,
                kekuatanBertahan: 6,
                kontrolTengah: 9,
                lebarSayap: 6,
                fleksibilitas: 8,
                kesulitanEksekusi: 7,
                cocokUntukPemain: "Tim dengan AMC Kreatif",
                kelemahanUtama: "Butuh Pemain Kreatif",
                formasiDefensif: "4-4-1-1",
                perubahanPosisi: "AMC mundur jadi CM",
                tugasKhususOOP: "AMC pressing ke DMC lawan"
            },
            "4-1-4-1": {
                tipePermainan: "Control",
                kekuatanMenyerang: 6,
                kekuatanBertahan: 8,
                kontrolTengah: 9,
                lebarSayap: 5,
                fleksibilitas: 7,
                kesulitanEksekusi: 6,
                cocokUntukPemain: "Tim dengan DMC Solid",
                kelemahanUtama: "Kurang Variasi",
                formasiDefensif: "4-5-1",
                perubahanPosisi: "MC mundur jadi DMC",
                tugasKhususOOP: "DMC sweeping"
            },
            "5-3-2": {
                tipePermainan: "Defensive",
                kekuatanMenyerang: 4,
                kekuatanBertahan: 10,
                kontrolTengah: 5,
                lebarSayap: 6,
                fleksibilitas: 5,
                kesulitanEksekusi: 4,
                cocokUntukPemain: "Tim Defensif",
                kelemahanUtama: "Kurang Menyerang",
                formasiDefensif: "5-4-1",
                perubahanPosisi: "Tetap sama",
                tugasKhususOOP: "CB man marking"
            },
            "3-4-3": {
                tipePermainan: "Ultra Attacking",
                kekuatanMenyerang: 10,
                kekuatanBertahan: 4,
                kontrolTengah: 6,
                lebarSayap: 9,
                fleksibilitas: 8,
                kesulitanEksekusi: 8,
                cocokUntukPemain: "Tim dengan 3 Striker",
                kelemahanUtama: "Lemah Bertahan",
                formasiDefensif: "5-4-1",
                perubahanPosisi: "ST mundur jadi LM/RM",
                tugasKhususOOP: "Winger jadi LB/RB"
            },
            "4-5-1": {
                tipePermainan: "Parking Bus",
                kekuatanMenyerang: 3,
                kekuatanBertahan: 9,
                kontrolTengah: 7,
                lebarSayap: 4,
                fleksibilitas: 4,
                kesulitanEksekusi: 2,
                cocokUntukPemain: "Tim Lemah Menyerang",
                kelemahanUtama: "Tidak Bisa Menyerang",
                formasiDefensif: "5-4-1",
                perubahanPosisi: "Tetap sama",
                tugasKhususOOP: "MC tutup passing lane"
            },
            "5-4-1": {
                tipePermainan: "Ultra Defensive",
                kekuatanMenyerang: 2,
                kekuatanBertahan: 10,
                kontrolTengah: 6,
                lebarSayap: 4,
                fleksibilitas: 3,
                kesulitanEksekusi: 3,
                cocokUntukPemain: "Tim Sangat Defensif",
                kelemahanUtama: "Sangat Pasif",
                formasiDefensif: "5-4-1",
                perubahanPosisi: "Tetap sama",
                tugasKhususOOP: "WB stay back"
            },
            "3-1-4-2": {
                tipePermainan: "Flexible",
                kekuatanMenyerang: 7,
                kekuatanBertahan: 6,
                kontrolTengah: 8,
                lebarSayap: 7,
                fleksibilitas: 9,
                kesulitanEksekusi: 7,
                cocokUntukPemain: "Tim Fleksibel",
                kelemahanUtama: "Butuh Pemain Pintar",
                formasiDefensif: "5-3-2",
                perubahanPosisi: "ST mundur jadi MC",
                tugasKhususOOP: "MC pressing ke CM lawan"
            }
        };

        // DATABASE COUNTER FORMASI LAWAN dengan penjelasan
        const formationCounters = {
            "4-2-3-1": { 
                primary: "4-1-4-1", 
                alternative: "4-3-3", 
                explanation: "DM menutup ruang antar lini; alternatif 4-3-3 untuk winger cepat menyerang sayap.",
                bonus: 20 
            },
            "4-3-3": { 
                primary: "4-2-3-1", 
                alternative: "4-4-2 Diamond", 
                explanation: "4-2-3-1 menekan DM tunggal; Diamond untuk dominasi tengah bila punya pemain teknik tinggi.",
                bonus: 20 
            },
            "4-4-2": { 
                primary: "4-3-3", 
                alternative: "4-1-2-3", 
                explanation: "4-3-3 unggul di tengah (3v2); 4-1-2-3 untuk build-up dari belakang.",
                bonus: 20 
            },
            "4-4-2 Diamond": { 
                primary: "4-3-3", 
                alternative: "4-2-3-1", 
                explanation: "Menyerang lewat sayap kosong; 4-3-3 lebih solid, 4-2-3-1 lebih fleksibel.",
                bonus: 20 
            },
            "3-5-2": { 
                primary: "4-2-3-1", 
                alternative: "4-3-3", 
                explanation: "Manfaatkan lebar lapangan, winger menyeret keluar bek tengah lebar.",
                bonus: 20 
            },
            "5-3-2": { 
                primary: "4-2-3-1", 
                alternative: "4-4-2", 
                explanation: "Gunakan overlap fullback dan crossing; 4-4-2 menekan dua CB luar.",
                bonus: 20 
            },
            "5-2-1-2": { 
                primary: "4-3-3", 
                alternative: "3-4-3", 
                explanation: "Eksploitasi sayap kosong; 3-4-3 cocok jika punya wingback cepat.",
                bonus: 20 
            },
            "4-1-4-1": { 
                primary: "4-2-3-1", 
                alternative: "4-4-2", 
                explanation: "Dua striker/AM menekan DM tunggal; 4-4-2 memberi pressing lebih tinggi.",
                bonus: 20 
            },
            "3-4-3": { 
                primary: "4-2-3-1", 
                alternative: "4-3-3", 
                explanation: "AM mengacaukan shape lawan; fullback menyerang ruang belakang winger.",
                bonus: 20 
            },
            "4-5-1": { 
                primary: "4-2-3-1", 
                alternative: "4-1-2-3", 
                explanation: "Umpan cepat di half-space; 4-1-2-3 menjaga keseimbangan serangan.",
                bonus: 20 
            },
            "4-2-4": { 
                primary: "4-1-4-1", 
                alternative: "5-3-2", 
                explanation: "Tambahan DM/CB melindungi dari serangan balik cepat.",
                bonus: 20 
            },
            "3-4-1-2": { 
                primary: "4-3-3", 
                alternative: "4-2-3-1", 
                explanation: "Tekan tiga CB dengan tiga penyerang; 4-2-3-1 memberi AM ekstra.",
                bonus: 20 
            },
            "4-3-1-2": { 
                primary: "4-2-3-1", 
                alternative: "4-3-3", 
                explanation: "Serang dari sayap, gunakan overlapping fullback untuk membongkar blok tengah.",
                bonus: 20 
            },
            "5-4-1": { 
                primary: "4-2-3-1", 
                alternative: "4-3-3", 
                explanation: "Serang sabar lewat umpan pendek dan lebar lapangan.",
                bonus: 20 
            },
            "3-2-2-3": { 
                primary: "4-2-3-1", 
                alternative: "4-3-3", 
                explanation: "Manfaatkan area antar lini dan kombinasi 1-2 di half-space.",
                bonus: 20 
            },
            "4-1-2-3": { 
                primary: "4-3-3", 
                alternative: "3-4-3", 
                explanation: "Winger menekan sisi sayap kosong; 3-4-3 untuk overload sayap.",
                bonus: 20 
            },
            "3-1-4-2": { 
                primary: "4-2-3-1", 
                alternative: "4-3-3", 
                explanation: "Formasi lebar efektif untuk menyerang sisi luar.",
                bonus: 20 
            }
        };

        // SISTEM SCORING CERDAS - Menghitung skor formasi berdasarkan semua parameter
        function findBestFormationByScore(params) {
            console.log('ğŸ” Evaluating formations for:', params.karakteristikTim);
            console.log('ğŸ¯ Formasi Lawan:', params.formasiLawan);
            
            let currentBase = params.currentFormation.split(' ')[0];
            
            // STEP 1: Cari formasi yang cocok dengan karakteristik tim
            let characteristicMatch = null;
            for (let formation in formasiCharacteristics) {
                if (formasiCharacteristics[formation].cocokUntukPemain === params.karakteristikTim) {
                    characteristicMatch = formation;
                    console.log(`âœ… Formasi cocok karakteristik: ${formation}`);
                    break;
                }
            }
            
            // STEP 2: Cari counter alami formasi lawan
            let counterFormations = [];
            if (params.formasiLawan) {
                let opponentBase = params.formasiLawan.split(' ')[0];
                let counterData = formationCounters[opponentBase];
                
                if (counterData) {
                    counterFormations.push({ formation: counterData.primary, priority: 'primary' });
                    counterFormations.push({ formation: counterData.alternative, priority: 'alternative' });
                    console.log(`ğŸ¯ Counter alami vs ${opponentBase}: ${counterData.primary} (primary), ${counterData.alternative} (alt)`);
                }
            }
            
            // STEP 3: CEK APAKAH FORMASI KARAKTERISTIK = COUNTER ALAMI (PRIMARY atau ALTERNATIVE)?
            console.log(`ğŸ” Checking if ${characteristicMatch} is in counters:`, counterFormations.map(c => c.formation));
            let characteristicCounterMatch = counterFormations.find(c => c.formation === characteristicMatch);
            console.log(`ğŸ” Match found:`, characteristicCounterMatch);
            
            let finalFormation;
            let reasoning = "";
            
            if (characteristicCounterMatch) {
                // PERFECT! Formasi karakteristik = counter alami (primary atau alternative)
                finalFormation = characteristicMatch;
                let priorityText = characteristicCounterMatch.priority === 'primary' ? 'counter utama' : 'counter alternatif';
                reasoning = `âœ… PERFECT! ${finalFormation} cocok untuk ${params.karakteristikTim} DAN ${priorityText} vs ${params.formasiLawan}`;
                console.log(reasoning);
            } else if (counterFormations.length > 0) {
                // Formasi karakteristik BUKAN counter alami
                // Pilih counter yang PALING COCOK dengan karakteristik tim
                console.log(`âš ï¸ ${characteristicMatch} BUKAN counter alami. Mencari counter yang paling cocok...`);
                
                let bestCounter = selectBestCounterForCharacteristic(counterFormations, params.karakteristikTim);
                finalFormation = bestCounter.formation;
                reasoning = `ğŸ¯ ${finalFormation} dipilih: Counter alami (${bestCounter.priority}) yang paling cocok dengan ${params.karakteristikTim}`;
                console.log(reasoning);
            } else {
                // Tidak ada counter data, gunakan formasi karakteristik
                finalFormation = characteristicMatch || currentBase;
                reasoning = `âœ… ${finalFormation} cocok untuk ${params.karakteristikTim}`;
                console.log(reasoning);
            }
            
            // Calculate score untuk display
            let score = calculateFormationScore(finalFormation, params);
            
            // Tentukan alternative 1 & 2
            let alternative1 = null;
            let alternative2 = null;
            let explanation = "";
            
            // Ambil data counter untuk explanation
            if (params.formasiLawan) {
                let opponentBase = params.formasiLawan.split(' ')[0];
                let counterData = formationCounters[opponentBase];
                if (counterData) {
                    explanation = counterData.explanation;
                }
            }
            
            if (characteristicCounterMatch) {
                // Jika formasi karakteristik = counter (primary atau alternative)
                // Tampilkan counter yang lain sebagai alternative
                if (characteristicCounterMatch.priority === 'primary') {
                    // Karakteristik = primary counter, tampilkan alternative counter
                    alternative1 = counterFormations.length > 1 ? counterFormations[1].formation : null;
                    alternative2 = null;
                } else {
                    // Karakteristik = alternative counter, tampilkan primary counter
                    alternative1 = counterFormations.length > 0 ? counterFormations[0].formation : null;
                    alternative2 = null;
                }
            } else {
                // Jika counter â‰  karakteristik
                // Alternative 1 = counter alternative
                // Alternative 2 = formasi karakteristik
                if (counterFormations.length > 1) {
                    alternative1 = counterFormations[1].formation;
                }
                alternative2 = characteristicMatch;
            }
            
            return {
                recommended: finalFormation,
                alternative1: alternative1,
                alternative2: alternative2,
                characteristicFormation: characteristicMatch,
                original: currentBase,
                score: score,
                shouldChange: finalFormation !== currentBase,
                instruksi: generateSmartInstructions(finalFormation, params),
                reasoning: reasoning,
                explanation: explanation
            };
        }
        
        // Fungsi untuk memilih counter terbaik berdasarkan karakteristik tim
        function selectBestCounterForCharacteristic(counterFormations, karakteristikTim) {
            console.log(`  ğŸ“Š Membandingkan counter berdasarkan karakteristik: ${karakteristikTim}`);
            
            let counterScores = counterFormations.map(counter => {
                let data = formasiCharacteristics[counter.formation];
                
                // Validasi: skip jika formasi tidak ada di database
                if (!data) {
                    console.log(`    âš ï¸ ${counter.formation}: Formasi tidak ditemukan di database`);
                    return {
                        formation: counter.formation,
                        priority: counter.priority,
                        score: 0,
                        data: null
                    };
                }
                
                let score = 0;
                
                // Skor berdasarkan kesesuaian dengan karakteristik
                if (karakteristikTim.includes("Bek Kuat") || karakteristikTim.includes("Defensif")) {
                    score = data.kekuatanBertahan * 3 + data.kontrolTengah * 2;
                    console.log(`    ${counter.formation}: Defense=${data.kekuatanBertahan}, Kontrol=${data.kontrolTengah}, Score=${score}`);
                } else if (karakteristikTim.includes("Winger Cepat") || karakteristikTim.includes("Striker")) {
                    score = data.kekuatanMenyerang * 3 + data.lebarSayap * 2;
                    console.log(`    ${counter.formation}: Attack=${data.kekuatanMenyerang}, Sayap=${data.lebarSayap}, Score=${score}`);
                } else if (karakteristikTim.includes("AMC Kreatif") || karakteristikTim.includes("DMC Solid")) {
                    score = data.kontrolTengah * 3 + data.fleksibilitas * 2;
                    console.log(`    ${counter.formation}: Kontrol=${data.kontrolTengah}, Flex=${data.fleksibilitas}, Score=${score}`);
                } else if (karakteristikTim.includes("Balanced") || karakteristikTim.includes("Fleksibel")) {
                    score = data.fleksibilitas * 3 + (data.kekuatanMenyerang + data.kekuatanBertahan) * 1;
                    console.log(`    ${counter.formation}: Flex=${data.fleksibilitas}, Balance=${data.kekuatanMenyerang + data.kekuatanBertahan}, Score=${score}`);
                } else {
                    // Default: balance
                    score = (data.kekuatanMenyerang + data.kekuatanBertahan + data.kontrolTengah) * 1.5;
                }
                
                // Bonus untuk primary counter
                if (counter.priority === 'primary') {
                    score += 5;
                    console.log(`    ${counter.formation}: +5 bonus (primary counter), Total=${score}`);
                }
                
                return {
                    formation: counter.formation,
                    priority: counter.priority,
                    score: score,
                    data: data
                };
            });
            
            // Sort by score descending
            counterScores.sort((a, b) => b.score - a.score);
            console.log(`  âœ… Winner: ${counterScores[0].formation} (score: ${counterScores[0].score})`);
            
            return counterScores[0];
        }
        
        // Fungsi untuk menghitung skor formasi (0-100)
        function calculateFormationScore(formation, params) {
            let data = formasiCharacteristics[formation];
            let score = 0; // Start from 0
            
            // 1. KARAKTERISTIK TIM (Weight: 50 points) - PALING PENTING & DOMINAN
            if (data.cocokUntukPemain === params.karakteristikTim) {
                score += 50; // Perfect match - HUGE bonus
                console.log(`  âœ… ${formation}: MATCH! ${data.cocokUntukPemain} = ${params.karakteristikTim} (+50)`);
            } else {
                score += 0; // No bonus if mismatch
                console.log(`  âŒ ${formation}: No match. ${data.cocokUntukPemain} â‰  ${params.karakteristikTim} (+0)`);
            }
            
            // 2. SITUASI GAME (Weight: 20 points max)
            if (params.situasiGame === "Mengejar Skor") {
                score += data.kekuatanMenyerang * 2; // Max 20 points
            } else if (params.situasiGame === "Mempertahankan Keunggulan") {
                score += data.kekuatanBertahan * 2; // Max 20 points
            } else { // Skor Imbang
                score += (data.kekuatanMenyerang + data.kekuatanBertahan) * 1; // Max 20 points
            }
            
            // 3. JENIS LAWAN (Weight: 15 points max)
            if (params.jenisLawan.includes("Tim Kuat")) {
                score += data.kekuatanBertahan * 1.5; // Max 15 points
            } else if (params.jenisLawan.includes("Tim Lemah")) {
                score += data.kekuatanMenyerang * 1.5; // Max 15 points
            } else {
                score += (data.kekuatanMenyerang + data.kekuatanBertahan) * 0.75; // Max 15 points
            }
            
            // 4. GAYA LAWAN (Weight: 10 points max)
            if (params.gayaLawan === "Possession") {
                score += data.kontrolTengah; // Max 10 points
            } else if (params.gayaLawan === "Pressing") {
                score += data.fleksibilitas; // Max 10 points
            } else if (params.gayaLawan === "Counter Attack") {
                score += data.kekuatanBertahan; // Max 10 points
            } else if (params.gayaLawan === "Wing Play") {
                score += data.lebarSayap; // Max 10 points
            }
            
            // 5. COUNTER FORMASI LAWAN (Weight: 20 points max) - PENTING!
            if (params.formasiLawan) {
                let opponentBase = params.formasiLawan.split(' ')[0]; // Ambil base formation
                let counterData = formationCounters[opponentBase];
                
                if (counterData) {
                    // Cek apakah formasi ini adalah counter primary atau alternative
                    if (formation === counterData.primary) {
                        score += counterData.bonus; // Full bonus untuk primary counter
                        console.log(`  ğŸ¯ ${formation} is PRIMARY COUNTER vs ${opponentBase} (+${counterData.bonus})`);
                    } else if (formation === counterData.alternative) {
                        score += counterData.bonus * 0.7; // 70% bonus untuk alternative counter
                        console.log(`  ğŸ¯ ${formation} is ALTERNATIVE COUNTER vs ${opponentBase} (+${counterData.bonus * 0.7})`);
                    } else {
                        score += 2; // Small bonus jika bukan counter tapi tetap viable
                    }
                } else {
                    score += 2; // Formasi lawan tidak ada di database counter
                }
            }
            
            // 6. KONDISI TIM (Weight: minor)
            if (params.kondisiKita === "Tim Segar") {
                score += (data.kesulitanEksekusi <= 5 ? 3 : 1);
            } else if (params.kondisiKita === "Tim Lelah") {
                score += (data.kesulitanEksekusi <= 5 ? 3 : 1);
            }
            
            // 7. WAKTU PERTANDINGAN (Weight: minor)
            if (params.waktuPertandingan === "10 Menit Terakhir") {
                score += 2;
            }
            
            // Normalize score to 0-100 range (sudah max ~105, jadi normalize)
            score = Math.max(0, Math.min(100, score));
            
            return score;
        }
        
        // Generate instruksi cerdas berdasarkan formasi terpilih
        function generateSmartInstructions(formation, params) {
            let data = formasiCharacteristics[formation];
            let instructions = [];
            
            instructions.push("ğŸ¯ <strong>Formasi " + formation + " dipilih karena:</strong>");
            instructions.push("â€¢ Cocok untuk " + data.cocokUntukPemain);
            instructions.push("â€¢ Tipe: " + data.tipePermainan);
            
            if (params.situasiGame === "Mengejar Skor") {
                instructions.push("â€¢ Kekuatan Menyerang: " + data.kekuatanMenyerang + "/10 - Bagus untuk mengejar skor");
            } else if (params.situasiGame === "Mempertahankan Keunggulan") {
                instructions.push("â€¢ Kekuatan Bertahan: " + data.kekuatanBertahan + "/10 - Solid untuk bertahan");
            }
            
            instructions.push("â€¢ Kesulitan Eksekusi: " + data.kesulitanEksekusi + "/10");
            
            return instructions.join("<br>");
        }

        // Fungsi untuk validasi dan menyesuaikan formasi berdasarkan karakteristik tim
        function adjustFormationBasedOnTeamCharacteristics(recommendedFormation, karakteristikTim) {
            // Extract base formation from recommended (remove modifiers like "Gegenpress", "Attacking", etc)
            let baseFormation = recommendedFormation.split(' ')[0];
            
            // If no team characteristics specified, return original
            if (!karakteristikTim) {
                return {
                    original: recommendedFormation,
                    adjusted: baseFormation,
                    message: recommendedFormation,
                    shouldChange: false
                };
            }

            const formationData = formasiCharacteristics[baseFormation];
            
            if (!formationData) {
                // Formation data not found
                return {
                    original: recommendedFormation,
                    adjusted: baseFormation,
                    message: recommendedFormation + "<br><i>Data formasi tidak ditemukan</i>",
                    shouldChange: false
                };
            }

            // Check if formation matches team characteristics
            if (formationData.cocokUntukPemain === karakteristikTim) {
                // Perfect match!
                let message = recommendedFormation + "<br><span style='color: #51cf66;'>âœ… SEMPURNA! Cocok dengan karakteristik tim: " + karakteristikTim + "</span>";
                return {
                    original: recommendedFormation,
                    adjusted: baseFormation,
                    message: message,
                    shouldChange: false
                };
            }
            
            // Not a perfect match - find better alternative
            let alternativeFormation = null;
            for (let formation in formasiCharacteristics) {
                if (formasiCharacteristics[formation].cocokUntukPemain === karakteristikTim) {
                    alternativeFormation = formation;
                    break;
                }
            }

            // Build recommendation message
            let message = recommendedFormation;
            message += "<br><span style='color: #ff6b6b;'>";
            message += "âš ï¸ Formasi " + baseFormation + " cocok untuk: <strong>" + formationData.cocokUntukPemain + "</strong><br>";
            message += "âŒ Tim Anda: <strong>" + karakteristikTim + "</strong>";
            message += "</span>";
            
            if (alternativeFormation) {
                message += "<br><span style='color: #51cf66;'><strong>âœ… SARAN: Gunakan " + alternativeFormation + "</strong> (cocok untuk " + karakteristikTim + ")</span>";
            }

            return {
                original: recommendedFormation,
                adjusted: alternativeFormation || baseFormation,
                message: message,
                shouldChange: alternativeFormation !== null
            };
        }

        // FUNGSI HELPER UNTUK GENERATE INSTRUKSI DINAMIS
        function generateInstructionsForFormation(formasi, situasiGame, gayaLawan, kondisiKita, kondisiLawan, formasiLawan) {
            let instruksi = [];
            let data = formasiCharacteristics[formasi];
            
            if (!data) return "Instruksi standar untuk formasi ini";
            
            // Instruksi dasar formasi
            instruksi.push(`<strong>ğŸ¯ ${formasi} - ${data.tipePermainan}</strong>`);
            
            // Berdasarkan situasi game
            if (situasiGame === "Mengejar Skor") {
                instruksi.push("âš¡ <strong>Mode Menyerang:</strong> Push forward, take risks");
                if (data.kekuatanMenyerang >= 7) {
                    instruksi.push("â€¢ Maksimalkan kekuatan menyerang formasi ini");
                    instruksi.push("â€¢ Overlapping runs dari fullback/wingback");
                }
            } else if (situasiGame === "Mempertahankan Keunggulan") {
                instruksi.push("ğŸ›¡ï¸ <strong>Mode Bertahan:</strong> Protect lead, stay compact");
                if (data.kekuatanBertahan >= 7) {
                    instruksi.push("â€¢ Manfaatkan kekuatan bertahan formasi");
                    instruksi.push("â€¢ Jaga shape defensif, absorb pressure");
                }
            } else {
                instruksi.push("âš–ï¸ <strong>Mode Seimbang:</strong> Control game rhythm");
            }
            
            // Berdasarkan gaya lawan
            if (gayaLawan === "Possession") {
                instruksi.push("ğŸ¯ <strong>Vs Possession:</strong> Press tinggi, tutup passing lanes");
                if (data.kontrolTengah >= 7) {
                    instruksi.push("â€¢ Dominasi tengah untuk disrupt build-up mereka");
                }
            } else if (gayaLawan === "Counter Attack") {
                instruksi.push("ğŸ¯ <strong>Vs Counter:</strong> Patient build-up, jaga shape");
                instruksi.push("â€¢ Waspadai space behind, jangan overcommit");
            } else if (gayaLawan === "Pressing") {
                instruksi.push("ğŸ¯ <strong>Vs High Press:</strong> Quick passing, exploit space");
                if (data.fleksibilitas >= 7) {
                    instruksi.push("â€¢ Gunakan fleksibilitas untuk escape pressing");
                }
            } else if (gayaLawan === "Wing Play") {
                instruksi.push("ğŸ¯ <strong>Vs Wing Play:</strong> Tutup sayap, force ke tengah");
                if (data.lebarSayap >= 7) {
                    instruksi.push("â€¢ Counter dengan serangan sayap kita sendiri");
                }
            }
            
            // Berdasarkan kondisi tim
            if (kondisiKita === "Tim Segar") {
                instruksi.push("ğŸ”¥ <strong>Kondisi Prima:</strong> High intensity, maksimal pressing");
            } else if (kondisiKita === "Tim Lelah") {
                instruksi.push("âš ï¸ <strong>Kondisi Lelah:</strong> Conserve energy, compact defending");
                instruksi.push("â€¢ Kurangi pressing, fokus organisasi");
            }
            
            // Kelemahan yang harus diwaspadai
            if (data.kelemahanUtama) {
                instruksi.push(`<br>âš ï¸ <strong>Waspadai:</strong> ${data.kelemahanUtama}`);
            }
            
            return instruksi.join("<br>");
        }

        function generateTempo(situasiGame, kondisiKita, jenisLawan, gayaLawan, formasiKita) {
            let output = "<div style='line-height: 1.6;'>";
            output += "<strong style='color: #c3e88d;'>ğŸ“Š Pilih Tempo Berdasarkan Faktor:</strong><br><br>";
            
            // === KATEGORI 1: BERDASARKAN MENTALITY (Situasi Game) ===
            output += "<div style='margin-bottom: 12px; padding: 10px; background: rgba(130, 170, 255, 0.1); border-left: 3px solid #82aaff; border-radius: 4px;'>";
            output += "<strong style='color: #82aaff;'>1ï¸âƒ£ Berdasarkan Mentality/Situasi (" + (situasiGame || "Tidak dipilih") + "):</strong><br>";
            
            if (situasiGame === "Mengejar Skor") {
                output += "â€¢ <span style='color: #ff6b6b;'><strong>Very High Tempo</strong></span> - Maksimalkan waktu, serangan sangat agresif<br>";
                output += "â€¢ <span style='color: #ffa94d;'><strong>High Tempo</strong></span> - Serangan cepat, tekan terus-menerus<br>";
                output += "â€¢ <span style='color: #c8d3dc;'>Medium Tempo</span> - Seimbang antara kontrol dan urgensi<br>";
            } else if (situasiGame === "Mempertahankan Keunggulan") {
                output += "â€¢ <span style='color: #51cf66;'><strong>Low Tempo</strong></span> - Kontrol possession, buang waktu cerdas<br>";
                output += "â€¢ <span style='color: #c8d3dc;'>Medium Tempo</span> - Kontrol + ancaman counter-attack<br>";
                output += "â€¢ <span style='color: #a8b5c1;'>High Tempo</span> - Tekan terus jika ingin tambah gol<br>";
            } else {
                // Mengejar Menang / situasi seimbang
                output += "â€¢ <span style='color: #ffa94d;'><strong>High Tempo</strong></span> - Ambil inisiatif, tekan sejak awal<br>";
                output += "â€¢ <span style='color: #c8d3dc;'>Medium Tempo</span> - Fleksibel, adaptif sesuai flow<br>";
                output += "â€¢ <span style='color: #a8b5c1;'>Low Tempo</span> - Sabar, tunggu momentum<br>";
            }
            output += "</div>";
            
            // === KATEGORI 2: BERDASARKAN GAYA BERMAIN (Gaya Lawan) ===
            output += "<div style='margin-bottom: 12px; padding: 10px; background: rgba(255, 169, 77, 0.1); border-left: 3px solid #ffa94d; border-radius: 4px;'>";
            output += "<strong style='color: #ffa94d;'>2ï¸âƒ£ Berdasarkan Gaya Bermain Lawan (" + (gayaLawan || "Tidak dipilih") + "):</strong><br>";
            
            if (gayaLawan) {
                if (gayaLawan.includes("Possession")) {
                    output += "â€¢ <span style='color: #ffa94d;'><strong>High Tempo</strong></span> - Press tinggi ganggu build-up mereka<br>";
                    output += "â€¢ <span style='color: #c8d3dc;'>Medium Tempo</span> - Counter dengan build-up terukur<br>";
                    output += "â€¢ <span style='color: #82aaff;'>Low Tempo</span> - Mirror tactic, possession vs possession<br>";
                } else if (gayaLawan.includes("Counter")) {
                    output += "â€¢ <span style='color: #51cf66;'><strong>Low Tempo</strong></span> - Sabar, jaga shape, hindari space<br>";
                    output += "â€¢ <span style='color: #c8d3dc;'>Medium Tempo</span> - Kontrol tanpa buru-buru<br>";
                    output += "â€¢ <span style='color: #a8b5c1;'>High Tempo</span> - Berisiko, tapi bisa overload mereka<br>";
                } else if (gayaLawan.includes("Pressing") || gayaLawan.includes("Gegenpress")) {
                    output += "â€¢ <span style='color: #51cf66;'><strong>Low Tempo</strong></span> - Umpan pendek, tunggu ruang terbuka<br>";
                    output += "â€¢ <span style='color: #ffa94d;'>High Tempo</span> - Vertical play, bypass press dengan cepat<br>";
                    output += "â€¢ <span style='color: #c8d3dc;'>Medium Tempo</span> - Mix short passing + quick transitions<br>";
                } else if (gayaLawan.includes("Wing Play")) {
                    output += "â€¢ <span style='color: #c8d3dc;'><strong>Medium Tempo</strong></span> - Kontrol tengah, tutup sayap<br>";
                    output += "â€¢ <span style='color: #ffa94d;'>High Tempo</span> - Press wide area cepat<br>";
                    output += "â€¢ <span style='color: #82aaff;'>Low Tempo</span> - Dominasi possession di tengah<br>";
                } else if (gayaLawan.includes("Long Ball")) {
                    output += "â€¢ <span style='color: #c8d3dc;'><strong>Medium Tempo</strong></span> - Dominasi possession<br>";
                    output += "â€¢ <span style='color: #ffa94d;'>High Tempo</span> - Press tinggi cegah umpan panjang<br>";
                    output += "â€¢ <span style='color: #82aaff;'>Low Tempo</span> - Build-up sabar dari belakang<br>";
                } else if (gayaLawan.includes("Defensive") || gayaLawan.includes("Low Block")) {
                    output += "â€¢ <span style='color: #51cf66;'><strong>Low Tempo</strong></span> - Sabar cari celah, tunggu error<br>";
                    output += "â€¢ <span style='color: #c8d3dc;'>Medium Tempo</span> - Kombinasi build-up + switching play<br>";
                    output += "â€¢ <span style='color: #ffa94d;'>High Tempo</span> - Overload cepat, tapi risiko counter<br>";
                }
            } else {
                output += "<span style='color: #a8b5c1;'><em>Pilih gaya lawan untuk rekomendasi spesifik</em></span><br>";
            }
            output += "</div>";
            
            // === KATEGORI 3: BERDASARKAN JENIS TIM LAWAN (Kuat/Lemah/Sedang) ===
            output += "<div style='margin-bottom: 12px; padding: 10px; background: rgba(81, 207, 102, 0.1); border-left: 3px solid #51cf66; border-radius: 4px;'>";
            output += "<strong style='color: #51cf66;'>3ï¸âƒ£ Berdasarkan Jenis Tim Lawan (" + (jenisLawan || "Tidak dipilih") + "):</strong><br>";
            
            // Cek apakah Tim Kuat/Rival
            if (jenisLawan && (jenisLawan.includes("Kuat") || jenisLawan.includes("Rival"))) {
                output += "â€¢ <span style='color: #82aaff;'><strong>Low-Medium Tempo</strong></span> - Sabar, jaga possession, hindari blunder<br>";
                output += "â€¢ Hindari tempo tinggi yang bisa eksploitasi oleh tim kuat<br>";
                output += "â€¢ <span style='color: #c8d3dc;'>Medium Tempo</span> - Kontrol permainan, tunggu momentum<br>";
                output += "â€¢ <span style='color: #a8b5c1;'>High Tempo</span> - Hanya jika berani ambil risiko tinggi<br>";
            } 
            // Cek apakah Tim Lemah
            else if (jenisLawan && jenisLawan.includes("Lemah")) {
                output += "â€¢ <span style='color: #ffa94d;'><strong>High Tempo</strong></span> - Tekan terus, paksa error mereka<br>";
                output += "â€¢ Eksploitasi kelemahan mereka dengan intensitas tinggi<br>";
                output += "â€¢ <span style='color: #ff6b6b;'>Very High Tempo</span> - Dominasi total, maksimalkan tekanan<br>";
                output += "â€¢ <span style='color: #c8d3dc;'>Medium Tempo</span> - Jika ingin main aman & kontrol<br>";
            }
            // Tim Seimbang/Promosi
            else if (jenisLawan && (jenisLawan.includes("Seimbang") || jenisLawan.includes("Promosi"))) {
                output += "â€¢ <span style='color: #c8d3dc;'><strong>Medium Tempo</strong></span> - Seimbang, fleksibel sesuai flow<br>";
                output += "â€¢ Pertandingan head-to-head yang imbang<br>";
                output += "â€¢ <span style='color: #ffa94d;'>High Tempo</span> - Ambil inisiatif, tekan lebih dulu<br>";
                output += "â€¢ <span style='color: #82aaff;'>Low Tempo</span> - Kontrol permainan dengan sabar<br>";
            }
            // Default jika tidak ada jenis lawan dipilih
            else {
                output += "â€¢ <span style='color: #c8d3dc;'>Medium Tempo</span> - Default seimbang<br>";
                output += "â€¢ <span style='color: #ffa94d;'>High Tempo</span> - Tekan lawan lebih dulu<br>";
                output += "â€¢ <span style='color: #82aaff;'>Low Tempo</span> - Build-up sabar & terkontrol<br>";
            }
            output += "</div>";
            
            // === KATEGORI 4: BERDASARKAN FORMASI KITA ===
            output += "<div style='padding: 10px; background: rgba(255, 107, 107, 0.1); border-left: 3px solid #ff6b6b; border-radius: 4px;'>";
            output += "<strong style='color: #ff6b6b;'>4ï¸âƒ£ Berdasarkan Formasi Yang Dipakai (" + (formasiKita || "Tidak dipilih") + "):</strong><br>";
            
            if (formasiKita) {
                if (formasiKita.includes("4-3-3") || formasiKita.includes("4-2-3-1")) {
                    output += "â€¢ <span style='color: #c8d3dc;'><strong>Medium-High Tempo</strong></span> - Formasi fleksibel, banyak opsi<br>";
                    output += "â€¢ Cocok untuk: Tempo cepat dengan banyak variasi serangan<br>";
                } else if (formasiKita.includes("3-5-2") || formasiKita.includes("5-3-2")) {
                    output += "â€¢ <span style='color: #82aaff;'><strong>Low-Medium Tempo</strong></span> - Stabilitas lebih penting<br>";
                    output += "â€¢ Cocok untuk: Build-up sabar dari pertahanan 3/5 bek<br>";
                } else if (formasiKita.includes("4-4-2")) {
                    output += "â€¢ <span style='color: #ffa94d;'><strong>High Tempo</strong></span> - Direct play, banyak crossing<br>";
                    output += "â€¢ Cocok untuk: Serangan langsung ke 2 striker<br>";
                } else if (formasiKita.includes("4-1-4-1") || formasiKita.includes("4-3-1-2")) {
                    output += "â€¢ <span style='color: #82aaff;'><strong>Low-Medium Tempo</strong></span> - Build-up sabar & terkontrol<br>";
                    output += "â€¢ Cocok untuk: Kontrol tengah dengan passing<br>";
                } else if (formasiKita.includes("4-2-2-2")) {
                    output += "â€¢ <span style='color: #c8d3dc;'><strong>Medium Tempo</strong></span> - Balance antara kontrol & serangan<br>";
                    output += "â€¢ Cocok untuk: Fleksibel adaptif<br>";
                } else {
                    output += "â€¢ <span style='color: #c8d3dc;'>Medium Tempo</span> - Fleksibel untuk formasi ini<br>";
                }
            } else {
                output += "<span style='color: #a8b5c1;'><em>Formasi akan menentukan tempo ideal</em></span><br>";
            }
            output += "</div>";
            
            // === KONDISI KHUSUS: TIM KITA LELAH ===
            if (kondisiKita === "Tim Lelah") {
                output += "<br><div style='padding: 10px; background: rgba(255, 107, 107, 0.2); border: 2px solid #ff6b6b; border-radius: 4px;'>";
                output += "âš ï¸ <strong style='color: #ff6b6b;'>PERHATIAN: Tim Anda Lelah!</strong><br>";
                output += "<span style='color: #ffa94d;'>Sangat disarankan: <strong>Low Tempo</strong> untuk hemat energi & hindari cedera</span>";
                output += "</div>";
            }
            
            output += "</div>";
            
            return output;
        }

        function generateKeyPlayers(formasi, situasiGame) {
            let data = formasiCharacteristics[formasi];
            if (!data) return "Versatile players needed";
            
            let players = [];
            
            // Berdasarkan tipe formasi
            if (data.tipePermainan.includes("Menyerang")) {
                players.push("ğŸ¯ <strong>Forwards:</strong> Clinical finishers, high work rate");
                players.push("âš¡ <strong>Wingers/AMs:</strong> Pace, creativity, goal threat");
            } else if (data.tipePermainan.includes("Bertahan")) {
                players.push("ğŸ›¡ï¸ <strong>Defenders:</strong> Strong, disciplined, good positioning");
                players.push("ğŸ’ª <strong>DM:</strong> Ball winner, break up play");
            }
            
            if (data.kontrolTengah >= 7) {
                players.push("ğŸ¨ <strong>Midfield:</strong> Technical players, passing vision");
            }
            
            if (data.lebarSayap >= 7) {
                players.push("ğŸƒ <strong>Wide Players:</strong> Pace, stamina, crossing ability");
            }
            
            return players.join("<br>");
        }

        function generateDefensiveLine(situasiGame, kondisiKita, gayaLawan, jenisLawan) {
            // Matriks Scoring: Gaya Lawan Ã— Tingkat Lawan
            // 3 = Sangat disarankan, 2 = Situasional, 1 = Tidak disarankan
            
            let lineStrategy = "";
            
            // Default jika parameter tidak lengkap
            if (!gayaLawan || !jenisLawan) {
                if (situasiGame === "Mengejar Skor" && kondisiKita !== "Tim Lelah") {
                    return "Higher Line (70-80%) - Compress space, high recovery";
                } else if (situasiGame === "Mempertahankan Keunggulan") {
                    return "Lower Line (40-50%) - Protect space behind, absorb pressure";
                }
                return "Standard Line (50-60%) - Balanced positioning";
            }
            
            // Possession / Build-up
            if (gayaLawan === "Possession") {
                if (jenisLawan.includes("Kuat") || jenisLawan.includes("Rival")) {
                    lineStrategy = "<strong>Mid Line (55-65%) [Skor: 3âƒ£]</strong> - Blok kompak, jebak di tengah, hindari pressing terlalu tinggi<br>";
                    lineStrategy += "<small style='color: #ffa94d;'>â€¢ Alternatif: Low Line (40-50%) [2âƒ£] - Lebih aman tapi pasif</small><br>";
                    lineStrategy += "<small style='color: #ff6b6b;'>â€¢ Tidak disarankan: High Line (70-80%) [1âƒ£] - Terlalu berisiko</small>";
                } else if (jenisLawan.includes("Seimbang") || jenisLawan.includes("Promosi")) {
                    lineStrategy = "<strong>Mid Line (55-65%) [Skor: 3âƒ£]</strong> - Balance pressure dan safety<br>";
                    lineStrategy += "<small style='color: #ffa94d;'>â€¢ Alternatif: High Line (70-80%) [2âƒ£] - Lebih agresif, berisiko sedang</small>";
                } else { // Lawan Lemah
                    lineStrategy = "<strong>High Line (70-80%) [Skor: 3âƒ£]</strong> - Tekan build-up mereka agresif";
                }
            }
            // Counter Attack
            else if (gayaLawan === "Counter Attack") {
                if (jenisLawan.includes("Kuat") || jenisLawan.includes("Rival")) {
                    lineStrategy = "<strong>Low Line (40-50%) [Skor: 3âƒ£]</strong> - Hindari ruang di belakang untuk sprint<br>";
                    lineStrategy += "<small style='color: #ffa94d;'>â€¢ Alternatif: Mid Line (55-65%) [2âƒ£] - Risiko sedang</small><br>";
                    lineStrategy += "<small style='color: #ff6b6b;'>â€¢ Tidak disarankan: High Line (70-80%) [1âƒ£] - Bahaya counter!</small>";
                } else if (jenisLawan.includes("Seimbang") || jenisLawan.includes("Promosi")) {
                    lineStrategy = "<strong>Mid Line (55-65%) [Skor: 3âƒ£]</strong> - Kontrol ruang, jaga balance";
                } else { // Lawan Lemah
                    lineStrategy = "<strong>Mid Line (55-65%) [Skor: 3âƒ£]</strong> - Bisa agak tinggi tapi tetap waspada<br>";
                    lineStrategy += "<small style='color: #ffa94d;'>â€¢ Alternatif: High Line (70-80%) [2âƒ£] - Agresif tapi waspada</small>";
                }
            }
            // Wing Play
            else if (gayaLawan === "Wing Play") {
                if (jenisLawan.includes("Kuat") || jenisLawan.includes("Rival")) {
                    lineStrategy = "<strong>Mid Line (55-65%) [Skor: 3âƒ£]</strong> - Bek sayap jangan terlalu tinggi, jaga lebar<br>";
                    lineStrategy += "<small style='color: #ffa94d;'>â€¢ Alternatif: Low Line (40-50%) [2âƒ£] - Lebih aman dari crossing</small><br>";
                    lineStrategy += "<small style='color: #ff6b6b;'>â€¢ Tidak disarankan: High Line (70-80%) [1âƒ£] - Exposed ke cross</small>";
                } else if (jenisLawan.includes("Seimbang") || jenisLawan.includes("Promosi")) {
                    lineStrategy = "<strong>Mid Line (55-65%) [Skor: 3âƒ£]</strong> - Tutup crossing angle";
                } else { // Lawan Lemah
                    lineStrategy = "<strong>High Line (70-80%) [Skor: 2âƒ£]</strong> - Tekan di sayap<br>";
                    lineStrategy += "<strong>Mid Line (55-65%) [Skor: 3âƒ£]</strong> - Bisa sedikit tinggi untuk tutup sayap";
                }
            }
            // Pressing / Gegenpress
            else if (gayaLawan === "Pressing") {
                if (jenisLawan.includes("Kuat") || jenisLawan.includes("Rival")) {
                    lineStrategy = "<strong>Mid Line (55-65%) [Skor: 3âƒ£]</strong> - Jaga jarak aman antar lini, hindari terperangkap<br>";
                    lineStrategy += "<small style='color: #ffa94d;'>â€¢ Alternatif: Low Line (40-50%) [2âƒ£] - Lebih aman tapi kurang press</small>";
                } else if (jenisLawan.includes("Seimbang") || jenisLawan.includes("Promosi")) {
                    lineStrategy = "<strong>Mid Line (55-65%) [Skor: 3âƒ£]</strong> - Maintain structure vs their press";
                } else { // Lawan Lemah
                    lineStrategy = "<strong>Mid Line (55-65%) [Skor: 3âƒ£]</strong> - Keluar dari pressing dengan build-up cepat<br>";
                    lineStrategy += "<small style='color: #ffa94d;'>â€¢ Alternatif: High Line (70-80%) [2âƒ£] - Counter their press</small>";
                }
            }
            // Long Ball / Direct
            else if (gayaLawan === "Long Ball") {
                if (jenisLawan.includes("Kuat") || jenisLawan.includes("Rival")) {
                    lineStrategy = "<strong>Low Line (40-50%) [Skor: 3âƒ£]</strong> - Fokus jaga ruang belakang dan duel udara<br>";
                    lineStrategy += "<small style='color: #ffa94d;'>â€¢ Alternatif: Mid Line (55-65%) [2âƒ£] - Risiko sedang</small>";
                } else if (jenisLawan.includes("Seimbang") || jenisLawan.includes("Promosi")) {
                    lineStrategy = "<strong>Mid Line (55-65%) [Skor: 3âƒ£]</strong> - Balance antara jaga ruang dan tekan<br>";
                    lineStrategy += "<small style='color: #ffa94d;'>â€¢ Alternatif: Low Line (40-50%) [2âƒ£] - Lebih aman</small>";
                } else { // Lawan Lemah
                    lineStrategy = "<strong>Mid Line (55-65%) [Skor: 3âƒ£]</strong> - Bisa agak tinggi, siap duel udara";
                }
            }
            // Defensive / Low Block / Parkir Bus
            else if (gayaLawan === "Defensive") {
                if (jenisLawan.includes("Kuat") || jenisLawan.includes("Rival")) {
                    lineStrategy = "<strong>High Line (70-80%) [Skor: 3âƒ£]</strong> - Naikkan line untuk menekan blok rendah mereka<br>";
                    lineStrategy += "<small style='color: #ffa94d;'>â€¢ Alternatif: Mid Line (55-65%) [2âƒ£] - Lebih aman tapi kurang pressure</small>";
                } else if (jenisLawan.includes("Seimbang") || jenisLawan.includes("Promosi")) {
                    lineStrategy = "<strong>High Line (70-80%) [Skor: 3âƒ£]</strong> - Tekan tinggi, jangan beri ruang bernafas";
                } else { // Lawan Lemah
                    lineStrategy = "<strong>High Line (70-80%) [Skor: 3âƒ£]</strong> - Dominasi dengan line tinggi";
                }
            }
            // Default fallback
            else {
                lineStrategy = "Mid Line (55-65%) - Standard defensive positioning";
            }
            
            return lineStrategy;
        }

        function generateMarkingStrategy(formasiKita, formasiLawan, gayaLawan) {
            let marking = [];
            
            if (formasiLawan) {
                let oppBase = formasiLawan.split(' ')[0];
                marking.push(`ğŸ¯ <strong>Vs ${oppBase}:</strong>`);
                
                // Spesifik berdasarkan formasi lawan
                if (oppBase.includes("4-2-3-1")) {
                    marking.push("â€¢ Mark CAM tightly - key playmaker");
                    marking.push("â€¢ Press their double pivot");
                } else if (oppBase.includes("4-3-3")) {
                    marking.push("â€¢ Press their single DM");
                    marking.push("â€¢ Track wingers with fullbacks");
                } else if (oppBase.includes("3-")) {
                    marking.push("â€¢ Exploit wide areas");
                    marking.push("â€¢ Target their wing-backs when forward");
                }
            }
            
            if (gayaLawan === "Possession") {
                marking.push("â€¢ Man-mark their playmaker");
                marking.push("â€¢ Cut passing lanes to key players");
            }
            
            return marking.length > 0 ? marking.join("<br>") : "ğŸ¯ Standard marking assignments";
        }

        function generatePressingStrategy(formasiKita, kondisiKita, gayaLawan, jenisLawan) {
            // Matriks Scoring: Gaya Lawan Ã— Tingkat Lawan
            // 3 = Sangat disarankan, 2 = Situasional, 1 = Tidak disarankan
            
            let pressing = [];
            
            // Kondisi lelah override semua
            if (kondisiKita === "Tim Lelah") {
                pressing.push("âš¡ <strong>Low Intensity:</strong> Conserve energy");
                pressing.push("â€¢ Press only when certain to win ball");
                pressing.push("â€¢ Focus on maintaining defensive shape");
                return pressing.join("<br>");
            }
            
            // Default jika parameter tidak lengkap
            if (!gayaLawan || !jenisLawan) {
                if (kondisiKita === "Tim Segar") {
                    pressing.push("âš¡ <strong>High Intensity:</strong> Aggressive pressing");
                    pressing.push("â€¢ 6-second rule - win ball back quickly");
                }
                return pressing.length > 0 ? pressing.join("<br>") : "âš¡ Press when opportunity arises";
            }
            
            // Possession / Build-up
            if (gayaLawan === "Possession") {
                if (jenisLawan.includes("Kuat") || jenisLawan.includes("Rival")) {
                    pressing.push("âš¡ <strong>Mid Press [Skor: 3âƒ£]</strong>");
                    pressing.push("â€¢ Hati-hati, mereka jago keluar dari tekanan");
                    pressing.push("â€¢ Press selektif di zona berbahaya");
                    pressing.push("â€¢ Jangan overcommit");
                    pressing.push("<small style='color: #ffa94d;'>â€¢ Alternatif: Low Press [2âƒ£] - Lebih aman, absorb pressure</small>");
                    pressing.push("<small style='color: #ff6b6b;'>â€¢ Tidak disarankan: High Press [1âƒ£] - Mudah di-bypass</small>");
                } else if (jenisLawan.includes("Seimbang") || jenisLawan.includes("Promosi")) {
                    pressing.push("âš¡ <strong>High Press [Skor: 3âƒ£]</strong>");
                    pressing.push("â€¢ Tekan build-up dari belakang");
                    pressing.push("â€¢ Force errors in tight spaces");
                    pressing.push("â€¢ Coordinate team press");
                    pressing.push("<small style='color: #ffa94d;'>â€¢ Alternatif: Mid Press [2âƒ£] - Lebih konservatif</small>");
                } else { // Lawan Lemah
                    pressing.push("âš¡ <strong>High Press [Skor: 3âƒ£]</strong>");
                    pressing.push("â€¢ Tekan agresif sejak mereka mulai build-up");
                    pressing.push("â€¢ Manfaatkan kesalahan passing mereka");
                    pressing.push("â€¢ Win ball in attacking third");
                }
            }
            // Counter Attack
            else if (gayaLawan === "Counter Attack") {
                if (jenisLawan.includes("Kuat") || jenisLawan.includes("Rival")) {
                    pressing.push("âš¡ <strong>Low Press [Skor: 3âƒ£]</strong>");
                    pressing.push("â€¢ Jangan overcommit - bahaya counter");
                    pressing.push("â€¢ Kontrol transisi dengan hati-hati");
                    pressing.push("â€¢ Stay compact and organized");
                    pressing.push("<small style='color: #ffa94d;'>â€¢ Alternatif: Mid Press [2âƒ£] - Risiko sedang</small>");
                } else if (jenisLawan.includes("Seimbang") || jenisLawan.includes("Promosi")) {
                    pressing.push("âš¡ <strong>Mid Press [Skor: 3âƒ£]</strong>");
                    pressing.push("â€¢ Controlled pressing");
                    pressing.push("â€¢ Balance between pressure dan safety");
                    pressing.push("â€¢ Quick transition defense");
                } else { // Lawan Lemah
                    pressing.push("âš¡ <strong>High Press [Skor: 2âƒ£]</strong> atau <strong>Mid Press [Skor: 3âƒ£]</strong>");
                    pressing.push("â€¢ Bisa agak agresif tapi tetap terorganisir");
                    pressing.push("â€¢ Cut their counter attack routes");
                    pressing.push("â€¢ Win ball before they transition");
                }
            }
            // Wing Play
            else if (gayaLawan === "Wing Play") {
                if (jenisLawan.includes("Kuat") || jenisLawan.includes("Rival")) {
                    pressing.push("âš¡ <strong>Mid Press [Skor: 3âƒ£]</strong>");
                    pressing.push("â€¢ Tutup sisi sayap dan lintasan crossing");
                    pressing.push("â€¢ Press wide players sebelum cross");
                    pressing.push("â€¢ Fullbacks stay disciplined");
                } else if (jenisLawan.includes("Seimbang") || jenisLawan.includes("Promosi")) {
                    pressing.push("âš¡ <strong>Mid Press [Skor: 3âƒ£]</strong> atau <strong>High Press [Skor: 2âƒ£]</strong>");
                    pressing.push("â€¢ Tekan winger saat terima bola");
                    pressing.push("â€¢ Force them inside to congested areas");
                    pressing.push("â€¢ Block crossing lanes");
                } else { // Lawan Lemah
                    pressing.push("âš¡ <strong>High Press [Skor: 3âƒ£]</strong>");
                    pressing.push("â€¢ Press aggressively on the flanks");
                    pressing.push("â€¢ Don't let them get time to cross");
                    pressing.push("â€¢ Win ball wide and counter");
                }
            }
            // Pressing / Gegenpress
            else if (gayaLawan === "Pressing") {
                if (jenisLawan.includes("Kuat") || jenisLawan.includes("Rival")) {
                    pressing.push("âš¡ <strong>Mid Press [Skor: 3âƒ£]</strong>");
                    pressing.push("â€¢ Gunakan build-up cepat untuk hindari tekanan");
                    pressing.push("â€¢ Jangan terjebak pressing mereka");
                    pressing.push("â€¢ Quick, direct passing under pressure");
                    pressing.push("<small style='color: #ffa94d;'>â€¢ Alternatif: Low Press [2âƒ£] - Lebih aman, counter style</small>");
                } else if (jenisLawan.includes("Seimbang") || jenisLawan.includes("Promosi")) {
                    pressing.push("âš¡ <strong>Mid Press [Skor: 3âƒ£]</strong>");
                    pressing.push("â€¢ Match their intensity carefully");
                    pressing.push("â€¢ Build-up cepat keluar dari zona press");
                    pressing.push("â€¢ Stay composed under pressure");
                } else { // Lawan Lemah
                    pressing.push("âš¡ <strong>Mid Press [Skor: 3âƒ£]</strong>");
                    pressing.push("â€¢ Play through their press dengan teknik");
                    pressing.push("â€¢ Exploit spaces they leave");
                    pressing.push("â€¢ Counter-press saat mereka kehilangan bola");
                }
            }
            // Long Ball / Direct
            else if (gayaLawan === "Long Ball") {
                if (jenisLawan.includes("Kuat") || jenisLawan.includes("Rival")) {
                    pressing.push("âš¡ <strong>Mid Press [Skor: 3âƒ£]</strong>");
                    pressing.push("â€¢ Pressing jangan terlalu tinggi agar tidak dilewati bola panjang");
                    pressing.push("â€¢ Posisi defensif siap antisipasi");
                    pressing.push("â€¢ Win aerial duels di lini belakang");
                    pressing.push("<small style='color: #ffa94d;'>â€¢ Alternatif: Low Press [2âƒ£] - Lebih deep, siap second ball</small>");
                } else if (jenisLawan.includes("Seimbang") || jenisLawan.includes("Promosi")) {
                    pressing.push("âš¡ <strong>Mid Press [Skor: 3âƒ£]</strong>");
                    pressing.push("â€¢ Press moderat, siap duel udara");
                    pressing.push("â€¢ Jangan biarkan target man dapat bola nyaman");
                    pressing.push("â€¢ Second ball battles penting");
                } else { // Lawan Lemah
                    pressing.push("âš¡ <strong>Mid Press [Skor: 3âƒ£]</strong>");
                    pressing.push("â€¢ Bisa sedikit agresif tapi tetap compact");
                    pressing.push("â€¢ Press saat mereka mau mainkan long ball");
                    pressing.push("â€¢ Win duels dan counter");
                }
            }
            // Defensive / Low Block / Parkir Bus
            else if (gayaLawan === "Defensive") {
                if (jenisLawan.includes("Kuat") || jenisLawan.includes("Rival")) {
                    pressing.push("âš¡ <strong>High Press [Skor: 3âƒ£]</strong>");
                    pressing.push("â€¢ Tekan terus agar mereka tidak bisa keluar dari area sendiri");
                    pressing.push("â€¢ Force errors di zona mereka");
                    pressing.push("â€¢ High intensity to break down their block");
                } else if (jenisLawan.includes("Seimbang") || jenisLawan.includes("Promosi")) {
                    pressing.push("âš¡ <strong>High Press [Skor: 3âƒ£]</strong>");
                    pressing.push("â€¢ Maintain high pressure");
                    pressing.push("â€¢ Don't let them settle in defensive shape");
                    pressing.push("â€¢ Create chances from pressing");
                } else { // Lawan Lemah
                    pressing.push("âš¡ <strong>High Press [Skor: 3âƒ£]</strong>");
                    pressing.push("â€¢ Dominasi total dengan pressing agresif");
                    pressing.push("â€¢ Tekan sampai mereka breakdown");
                    pressing.push("â€¢ Win ball high and score");
                }
            }
            // Default fallback
            else {
                pressing.push("âš¡ <strong>Standard Press</strong>");
                pressing.push("â€¢ Press when opportunity arises");
                pressing.push("â€¢ Maintain defensive organization");
            }
            
            return pressing.join("<br>");
        }

        function updateRecommendations() {
            const jenisLawan = document.getElementById('jenisLawan').value;
            const formasiLawan = document.getElementById('formasiLawan').value;
            const gayaLawan = document.getElementById('gayaLawan').value;
            const kondisiLawan = document.getElementById('kondisiLawan').value;
            const situasiGame = document.getElementById('situasiGame').value;
            const kondisiKita = document.getElementById('kondisiKita').value;
            const waktuPertandingan = document.getElementById('waktuPertandingan').value;
            const karakteristikTim = document.getElementById('karakteristikTim').value;

            // Debug info
            console.log('='.repeat(60));
            console.log('ğŸ“‹ DROPDOWN VALUES:');
            console.log('  Jenis Lawan:', jenisLawan);
            console.log('  Formasi Lawan:', formasiLawan);
            console.log('  Gaya Lawan:', gayaLawan);
            console.log('  Kondisi Lawan:', kondisiLawan);
            console.log('  Situasi Game:', situasiGame);
            console.log('  Kondisi Kita:', kondisiKita);
            console.log('  Waktu Pertandingan:', waktuPertandingan);
            console.log('  âš½ KARAKTERISTIK TIM:', karakteristikTim);
            console.log('  karakteristikTim empty?', !karakteristikTim);
            console.log('='.repeat(60));

            if (!jenisLawan || !situasiGame) {
                clearRecommendations();
                return;
            }

            // Coba berbagai kombinasi key untuk mencari match di database
            let recommendation = null;
            let matchedKey = null;
            
            // Priority 1: Match dengan waktu pertandingan spesifik
            if (waktuPertandingan) {
                let key = `${jenisLawan}|${formasiLawan || 'Any'}|${waktuPertandingan}`;
                console.log('Trying time-based key:', key);
                recommendation = tacticalDatabase[key];
                if (recommendation) {
                    matchedKey = key;
                    console.log('Found time-based match:', key);
                }
                
                // Jika tidak ketemu, coba dengan situasi game + waktu
                if (!recommendation) {
                    key = `${situasiGame}|${waktuPertandingan}`;
                    recommendation = tacticalDatabase[key];
                    if (recommendation) {
                        matchedKey = key;
                        console.log('Found situation+time match:', key);
                    }
                }
                
                // Coba dengan general time match
                if (!recommendation) {
                    key = `Any|Any|${waktuPertandingan}`;
                    recommendation = tacticalDatabase[key];
                    if (recommendation) {
                        matchedKey = key;
                        console.log('Found general time match:', key);
                    }
                }
            }
            
            // Priority 2: Exact match dengan formasi lawan
            if (!recommendation && formasiLawan) {
                let key = `${jenisLawan}|${formasiLawan}|${situasiGame}`;
                console.log('Trying formation key:', key);
                recommendation = tacticalDatabase[key];
                if (recommendation) {
                    matchedKey = key;
                    console.log('Found formation match:', key);
                }
            }
            
            // Priority 3: Match tanpa formasi lawan tapi dengan situasi
            if (!recommendation) {
                let key = `${jenisLawan}|${situasiGame}`;
                console.log('Trying key without formation:', key);
                recommendation = tacticalDatabase[key];
                if (recommendation) {
                    matchedKey = key;
                    console.log('Found match without formation:', key);
                }
            }
            
            // Priority 3: Cari partial match berdasarkan jenis lawan
            if (!recommendation) {
                console.log('Searching for partial matches...');
                for (let dbKey in tacticalDatabase) {
                    if (dbKey.includes(jenisLawan) && dbKey.includes(situasiGame)) {
                        recommendation = tacticalDatabase[dbKey];
                        matchedKey = dbKey;
                        console.log('Found partial match:', dbKey);
                        break;
                    }
                }
            }
            
            // Fallback: buat rekomendasi smart berdasarkan parameter yang ada
            if (!recommendation) {
                console.log('No match found, creating smart recommendation');
                recommendation = createSmartRecommendation(jenisLawan, situasiGame, formasiLawan, gayaLawan);
                matchedKey = 'Generated Smart Recommendation';
            }

            console.log('Final recommendation from:', matchedKey, recommendation);

            if (recommendation) {
                // Clone recommendation untuk modifikasi
                let modifiedRecommendation = Object.assign({}, recommendation);
                
                // Modifikasi berdasarkan kondisi tim kita
                modifiedRecommendation = applyOurTeamConditions(modifiedRecommendation, kondisiKita);
                
                // Modifikasi berdasarkan kondisi tim lawan
                modifiedRecommendation = applyOpponentConditions(modifiedRecommendation, kondisiLawan, gayaLawan);
                
                // SISTEM SCORING CERDAS: Evaluasi formasi berdasarkan SEMUA parameter
                let bestFormation = null;
                let formasiTerpilih = modifiedRecommendation.formasi.split(' ')[0]; // Default: gunakan dari database
                
                // Jika karakteristik tim tidak dipilih, anggap sebagai "Balance" (tim seimbang)
                let karakteristikTimFinal = karakteristikTim || "Balance";
                
                if (!karakteristikTim) {
                    console.log('â„¹ï¸ Karakteristik Tim tidak dipilih - menggunakan profil BALANCE (tim seimbang)');
                }
                
                // SELALU jalankan scoring system
                console.log('ğŸ¯ SCORING SYSTEM ACTIVE - Karakteristik Tim:', karakteristikTimFinal);
                bestFormation = findBestFormationByScore({
                    karakteristikTim: karakteristikTimFinal,
                    situasiGame: situasiGame,
                    jenisLawan: jenisLawan,
                    gayaLawan: gayaLawan,
                    formasiLawan: formasiLawan,
                    kondisiKita: kondisiKita,
                    kondisiLawan: kondisiLawan,
                    waktuPertandingan: waktuPertandingan,
                    currentFormation: modifiedRecommendation.formasi
                });
                console.log('âœ… Best Formation dari scoring:', bestFormation);
                
                // SELALU gunakan formasi hasil analisis scoring
                formasiTerpilih = bestFormation.recommended.split(' ')[0]; // Update dengan hasil scoring
                
                modifiedRecommendation.formasi = bestFormation.recommended;
                modifiedRecommendation.alternatif = bestFormation.alternative;
                
                // Tampilkan formasi COUNTER di Rekomendasi Taktik dengan explanation
                let counterNote = bestFormation.explanation ? 
                    "<br><small style='color: #ffa94d;'>ğŸ’¡ " + bestFormation.explanation + "</small>" : "";
                
                // Tambahkan karakteristik formasi
                let karakteristikFormasiDisplay = formasiCharacteristics[formasiTerpilih];
                let formationStats = "";
                if (karakteristikFormasiDisplay) {
                    formationStats += "<br><br><div style='font-size: 0.9em; color: #c3e88d; line-height: 1.8; background: rgba(0,0,0,0.3); padding: 12px; border-radius: 6px; margin-top: 10px;'>";
                    formationStats += "ğŸ“Š <strong>Karakteristik " + formasiTerpilih + ":</strong><br>";
                    formationStats += "â€¢ Tipe: " + karakteristikFormasiDisplay.tipePermainan + "<br>";
                    formationStats += "â€¢ Kekuatan Menyerang: " + karakteristikFormasiDisplay.kekuatanMenyerang + "/10<br>";
                    formationStats += "â€¢ Kekuatan Bertahan: " + karakteristikFormasiDisplay.kekuatanBertahan + "/10<br>";
                    formationStats += "â€¢ Kontrol Tengah: " + karakteristikFormasiDisplay.kontrolTengah + "/10<br>";
                    formationStats += "â€¢ Lebar Sayap: " + karakteristikFormasiDisplay.lebarSayap + "/10<br>";
                    formationStats += "â€¢ Fleksibilitas: " + karakteristikFormasiDisplay.fleksibilitas + "/10<br>";
                    formationStats += "â€¢ Kesulitan Eksekusi: " + karakteristikFormasiDisplay.kesulitanEksekusi + "/10";
                    formationStats += "</div>";
                }
                
                document.getElementById('formasiUtama').innerHTML = bestFormation.recommended + counterNote + formationStats;
                
                // Tampilkan Alternative 1 & 2
                let alternativeText = "";
                if (bestFormation.alternative1) {
                    alternativeText += "<strong>Alternatif 1:</strong> " + bestFormation.alternative1;
                }
                if (bestFormation.alternative2) {
                    if (alternativeText) alternativeText += "<br>";
                    alternativeText += "<strong>Alternatif 2:</strong> " + bestFormation.alternative2;
                    if (bestFormation.alternative2 === bestFormation.characteristicFormation) {
                        alternativeText += " <small style='color: #82aaff;'>(cocok karakteristik tim)</small>";
                    }
                }
                document.getElementById('formasiAlternatif').innerHTML = alternativeText || "Tidak ada alternatif";
                
                // SELALU generate konten dinamis berdasarkan parameter (tidak tergantung karakteristik tim)
                // formasiTerpilih sudah di-set di atas (dari scoring atau dari database)
                let karakteristikFormasi = formasiCharacteristics[formasiTerpilih];
                
                // Generate Instruksi Khusus berdasarkan formasi dan situasi
                modifiedRecommendation.instruksi = generateInstructionsForFormation(
                    formasiTerpilih, 
                    situasiGame, 
                    gayaLawan, 
                    kondisiKita, 
                    kondisiLawan,
                    formasiLawan
                );
                
                // Update Out of Possession dengan format baru
                if (karakteristikFormasi && karakteristikFormasi.formasiDefensif) {
                    let oopText = karakteristikFormasi.formasiDefensif + "<br><br>";
                    oopText += "<strong>Perubahan Posisi:</strong><br>" + karakteristikFormasi.perubahanPosisi + "<br><br>";
                    oopText += "<strong>Tugas Utama OOP:</strong><br>" + karakteristikFormasi.tugasKhususOOP;
                    modifiedRecommendation.outOfPossession = oopText;
                }
                
                // Update Tempo berdasarkan kondisi (dengan multiple rekomendasi)
                modifiedRecommendation.tempo = generateTempo(situasiGame, kondisiKita, jenisLawan, gayaLawan, formasiTerpilih);
                
                // Update Pemain Kunci berdasarkan formasi
                modifiedRecommendation.pemain = generateKeyPlayers(formasiTerpilih, situasiGame);
                
                // Update Defensive Line, Marking & Pressing berdasarkan matriks
                modifiedRecommendation.defensiveLine = generateDefensiveLine(situasiGame, kondisiKita, gayaLawan, jenisLawan);
                modifiedRecommendation.marking = generateMarkingStrategy(formasiTerpilih, formasiLawan, gayaLawan);
                modifiedRecommendation.pressing = generatePressingStrategy(formasiTerpilih, kondisiKita, gayaLawan, jenisLawan);
                
                document.getElementById('instruksiKhusus').innerHTML = modifiedRecommendation.instruksi;
                document.getElementById('tempoPermainan').innerHTML = modifiedRecommendation.tempo || "Standard Tempo - Adaptable rhythm";
                document.getElementById('pemainKunci').innerHTML = modifiedRecommendation.pemain;
                document.getElementById('outOfPossession').innerHTML = modifiedRecommendation.outOfPossession;
                document.getElementById('defensiveLine').innerHTML = modifiedRecommendation.defensiveLine;
                document.getElementById('markingStrategy').innerHTML = modifiedRecommendation.marking || "ğŸ¯ Standard marking assignments";
                document.getElementById('pressingStrategy').innerHTML = modifiedRecommendation.pressing || "âš¡ Press when opportunity arises";
                document.getElementById('setPieces').innerHTML = modifiedRecommendation.setpieces || "ğŸŸï¸ Standard set piece routines";
                document.getElementById('substitutionPlan').innerHTML = modifiedRecommendation.substitutions || "ğŸ”„ Tactical substitutions as needed";
                document.getElementById('risikoHint').textContent = modifiedRecommendation.risiko;

                // Tampilkan pengaruh kondisi tim jika ada
                showTeamConditionImpact(kondisiKita, kondisiLawan, gayaLawan);

                // Analisis kesesuaian formasi dengan karakteristik tim (SELALU tampilkan karena bestFormation selalu ada)
                showTeamSuitabilityAnalysis(bestFormation, karakteristikTimFinal, modifiedRecommendation.formasi, formasiLawan);

                // Analisis dan tampilkan gaya permainan
                analyzePlayingStyle(modifiedRecommendation, situasiGame, jenisLawan);
            } else {
                // Default recommendation jika tidak ditemukan kombinasi spesifik
                showDefaultRecommendation(jenisLawan, situasiGame, kondisiKita, formasiLawan, gayaLawan, kondisiLawan);
            }

            // Highlight baris yang sesuai di tabel
            highlightTableRow(jenisLawan, situasiGame);
        }

        function applyOurTeamConditions(recommendation, kondisiKita) {
            if (!kondisiKita) return recommendation;
            
            let modified = Object.assign({}, recommendation);
            
            // Modifikasi berdasarkan kondisi tim kita (simplified)
            switch (kondisiKita) {
                case 'Tim Segar':
                    modified.instruksi += "<br>ğŸ”¥ Tim dalam kondisi prima - maximalkan pressing<br>ğŸ”¥ Tempo tinggi untuk exploit stamina advantage";
                    // Replace RECOMMENDED STYLE jika ada, atau tambah jika tidak ada
                    if (modified.gaya.includes('RECOMMENDED STYLE:')) {
                        modified.gaya = modified.gaya.replace(/RECOMMENDED STYLE: [^|]*/, 'RECOMMENDED STYLE: Gegenpress/High Tempo');
                    } else {
                        modified.gaya += ' | RECOMMENDED STYLE: Gegenpress/High Tempo';
                    }
                    // Update tempo untuk tim segar
                    modified.tempo = modified.tempo ? modified.tempo.replace('Standard Tempo', 'Higher Tempo').replace('Lower Tempo', 'Standard Tempo') + " (Fresh legs advantage)" : "Higher Tempo - Maximize fresh legs, high intensity";
                    // Update pemain untuk kondisi prima - tambahkan stamina requirement
                    if (modified.pemain.includes('<br>')) {
                        modified.pemain += "<br>ğŸ”¥ FRESH ADVANTAGE: All positions require high stamina and work rate";
                    } else {
                        modified.pemain += "<br>High-energy players with aggressive mentality";
                    }
                    // Update out of possession untuk pressing tinggi
                    if (modified.outOfPossession.includes('Mid Block')) {
                        modified.outOfPossession = modified.outOfPossession.replace('Mid Block', 'High Block');
                    }
                    break;
                case 'Tim Lelah':
                    modified.instruksi += "<br>âš ï¸ Tim lelah - kurangi pressing intensity<br>âš ï¸ Fokus organisasi defensif dan conserve energy";
                    // Replace RECOMMENDED STYLE jika ada, atau tambah jika tidak ada
                    if (modified.gaya.includes('RECOMMENDED STYLE:')) {
                        modified.gaya = modified.gaya.replace(/RECOMMENDED STYLE: [^|]*/, 'RECOMMENDED STYLE: Cautious/Counter-Attack');
                    } else {
                        modified.gaya += ' | RECOMMENDED STYLE: Cautious/Counter-Attack';
                    }
                    // Update tempo untuk tim lelah
                    modified.tempo = modified.tempo ? modified.tempo.replace('Higher Tempo', 'Standard Tempo').replace('Standard Tempo', 'Lower Tempo') + " (Conserve energy)" : "Lower Tempo - Conserve energy, controlled rhythm";
                    // Update pemain untuk kondisi lelah - fokus pada substitusi dan experience
                    modified.pemain = "Fresh substitutes: High stamina replacements<br>Experienced veterans: Smart positioning and decision making<br>âš ï¸ TIRED LEGS: Avoid high-intensity pressing roles";
                    // Update out of possession untuk approach yang lebih defensif
                    if (modified.outOfPossession.includes('High Block')) {
                        modified.outOfPossession = modified.outOfPossession.replace('High Block', 'Mid Block');
                    }
                    modified.outOfPossession += " - Energy conservation focus";
                    break;
            }
            
            return modified;
        }

        function applyOpponentConditions(recommendation, kondisiLawan, gayaLawan) {
            if (!kondisiLawan && !gayaLawan) return recommendation;
            
            let modified = Object.assign({}, recommendation);
            
            // Modifikasi berdasarkan kondisi tim lawan (simplified)
            if (kondisiLawan) {
                switch (kondisiLawan) {
                    case 'Lawan Segar':
                        modified.instruksi += "<br>âš ï¸ Lawan dalam kondisi prima<br>âš ï¸ Waspadai pressing intensity mereka";
                        // Defensive approach karena lawan fit
                        modified.pemain += "<br>Disciplined defenders, Strong midfield";
                        break;
                    case 'Lawan Lelah':
                        modified.instruksi += "<br>âœ… Lawan lelah - exploit dengan pressing<br>âœ… Tempo tinggi untuk maximize advantage";
                        modified.pemain += "<br>High energy players, Aggressive pressers";
                        // Update out of possession untuk exploit lelah lawan
                        if (modified.outOfPossession.includes('Low Block')) {
                            modified.outOfPossession = modified.outOfPossession.replace('Low Block', 'Mid Block');
                        }
                        modified.outOfPossession += " - Exploit tired opponents";
                        break;
                }
            }
            
            // Modifikasi berdasarkan gaya bermain lawan (simplified)
            if (gayaLawan && gayaLawan !== 'Unknown') {
                switch (gayaLawan) {
                    case 'Possession':
                        modified.instruksi += "<br>ğŸ¯ Vs Possession: Pressing kompak<br>ğŸ¯ Tutup passing lanes untuk disrupt rhythm";
                        modified.pemain += "<br>High work-rate midfield, Aggressive pressing players";
                        modified.outOfPossession = modified.outOfPossession.replace('Mid Block', 'High Block') + " - Disrupt possession";
                        break;
                    case 'Pressing':
                        modified.instruksi += "<br>ğŸ¯ Vs Pressing: Quick passing untuk bypass<br>ğŸ¯ Hindari kehilangan bola di area berbahaya";
                        modified.pemain += "<br>Technical players, Quick decision makers";
                        modified.outOfPossession += " - Quick release, avoid turnovers";
                        break;
                    case 'Counter Attack':
                        modified.instruksi += "<br>ğŸ¯ Vs Counter: Patient build-up<br>ğŸ¯ Hindari kehilangan bola murah";
                        modified.pemain += "<br>Patient playmakers, Careful passers";
                        modified.outOfPossession += " - Careful possession, avoid risks";
                        break;
                    case 'Long Ball':
                        modified.instruksi += "<br>ğŸ¯ Vs Long Ball: Win aerial duels<br>ğŸ¯ Kompak di kotak penalti";
                        modified.defensiveLine = 'Higher Defensive Line';
                        modified.pemain += "<br>Tall defenders, Strong aerial presence, Sweeper keeper";
                        modified.outOfPossession = modified.formasi + " High Line - Win aerial battles, compress space";
                        break;
                    case 'Wing Play':
                        modified.instruksi += "<br>ğŸ¯ Vs Wing Play: Kompak di sayap<br>ğŸ¯ Tutup crossing lanes";
                        modified.pemain += "<br>Fast fullbacks, Wide midfield cover";
                        modified.outOfPossession += " - Compact wings, prevent crosses";
                        break;
                    case 'Defensive':
                        modified.instruksi += ". Vs Defensive: patient dalam breaking down defense";
                        modified.pemain += ", Creative players, Set piece specialists";
                        modified.outOfPossession += " - Patient build-up focus";
                        break;
                }
            }
            
            return modified;
        }

        function showTeamSuitabilityAnalysis(bestFormationData, karakteristikTim, recommendedFormasi, formasiLawan) {
            const suitabilitySection = document.getElementById('teamSuitabilitySection');
            
            // SELALU tampilkan (jika tidak ada karakteristik, anggap "Balance")
            suitabilitySection.style.display = 'block';
            
            // Cari formasi yang cocok dengan KARAKTERISTIK (bukan counter)
            let characteristicFormation = null;
            for (let formation in formasiCharacteristics) {
                if (formasiCharacteristics[formation].cocokUntukPemain === karakteristikTim) {
                    characteristicFormation = formation;
                    break;
                }
            }
            
            let baseFormation = characteristicFormation || recommendedFormasi.split(' ')[0];
            let formationData = formasiCharacteristics[baseFormation];
            
            // Cek apakah formasi karakteristik adalah counter alami
            let isCounter = false;
            let counterNote = "";
            if (formasiLawan) {
                let opponentBase = formasiLawan.split(' ')[0];
                let counterData = formationCounters[opponentBase];
                if (counterData) {
                    isCounter = (baseFormation === counterData.primary || baseFormation === counterData.alternative);
                    if (!isCounter) {
                        counterNote = `<br><span style='color: #ffa94d;'>âš ï¸ Bukan counter alami vs ${opponentBase}</span>`;
                    } else {
                        counterNote = `<br><span style='color: #51cf66;'>âœ… Counter alami vs ${opponentBase}</span>`;
                    }
                }
            }
            
            // Update team characteristics
            let karakteristikDisplay = karakteristikTim;
            if (karakteristikTim === "Balance") {
                karakteristikDisplay = "Balance <small style='color: #82aaff;'>(profil seimbang - tidak ada karakteristik spesifik dipilih)</small>";
            }
            document.getElementById('teamStrength').innerHTML = "<strong>Karakteristik Tim:</strong><br>" + 
                karakteristikDisplay + "<br><br><strong>Formasi Ideal:</strong><br>" + baseFormation + counterNote;
            
            // Update team weakness based on formation's weakness
            if (formationData) {
                document.getElementById('teamWeakness').innerHTML = "<strong>Kelemahan Formasi " + baseFormation + ":</strong><br>" + formationData.kelemahanUtama;
            } else {
                document.getElementById('teamWeakness').innerHTML = "<i>Data tidak tersedia</i>";
            }
            
            // Formation suitability analysis - Detail karakteristik saja
            let suitabilityHTML = "";
            if (formationData) {
                // Detail karakteristik formasi
                suitabilityHTML += "<strong>ğŸ“Š Karakteristik " + baseFormation + ":</strong><br>";
                suitabilityHTML += "â€¢ Tipe: " + formationData.tipePermainan + "<br>";
                suitabilityHTML += "â€¢ Kekuatan Menyerang: " + formationData.kekuatanMenyerang + "/10<br>";
                suitabilityHTML += "â€¢ Kekuatan Bertahan: " + formationData.kekuatanBertahan + "/10<br>";
                suitabilityHTML += "â€¢ Kontrol Tengah: " + formationData.kontrolTengah + "/10<br>";
                suitabilityHTML += "â€¢ Lebar Sayap: " + formationData.lebarSayap + "/10<br>";
                suitabilityHTML += "â€¢ Fleksibilitas: " + formationData.fleksibilitas + "/10<br>";
                suitabilityHTML += "â€¢ Kesulitan Eksekusi: " + formationData.kesulitanEksekusi + "/10";
            } else {
                suitabilityHTML = "Analisis tidak tersedia untuk formasi ini";
            }
            
            document.getElementById('formationSuitability').innerHTML = suitabilityHTML;
        }

        function showTeamConditionImpact(kondisiKita, kondisiLawan, gayaLawan) {
            const impactDiv = document.getElementById('kondisiTimInfo');
            const impactText = document.getElementById('kondisiImpact');
            
            if (!kondisiKita && !kondisiLawan && !gayaLawan) {
                impactDiv.style.display = 'none';
                return;
            }
            
            let impacts = [];
            
            // Impact dari kondisi tim kita
            if (kondisiKita) {
                suggestionHTML += "ï¿½ <strong>ANALISIS SCORING:</strong><br><br>";
                suggestionHTML += "Score formasi terpilih: <span style='color: #51cf66; font-weight: bold;'>" + 
                                  bestFormationData.score.toFixed(1) + "/100</span><br><br>";
                
                let adjustedData = formasiCharacteristics[baseFormation];
                if (adjustedData) {
                    suggestionHTML += "<strong>Detail " + baseFormation + ":</strong><br>";
                    suggestionHTML += "âœ… Cocok untuk: " + adjustedData.cocokUntukPemain + "<br>";
                    suggestionHTML += "â€¢ Tipe: " + adjustedData.tipePermainan + "<br>";
                    suggestionHTML += "â€¢ Kekuatan Menyerang: " + adjustedData.kekuatanMenyerang + "/10<br>";
                    suggestionHTML += "â€¢ Kekuatan Bertahan: " + adjustedData.kekuatanBertahan + "/10";
                }
            } else {
                suggestionHTML += "âœ… <strong>Formasi dari database</strong><br>";
                suggestionHTML += "Menggunakan rekomendasi standar berdasarkan database taktik.<br><br>";
                suggestionHTML += "<i>ğŸ’¡ Tips: Pilih Karakteristik Tim untuk analisis yang lebih detail</i>";
            }
        }

        function showTeamConditionImpact(kondisiKita, kondisiLawan, gayaLawan) {
            const impactDiv = document.getElementById('kondisiTimInfo');
            const impactText = document.getElementById('kondisiImpact');
            
            if (!kondisiKita && !kondisiLawan && !gayaLawan) {
                impactDiv.style.display = 'none';
                return;
            }
            
            let impacts = [];
            
            // Impact dari kondisi tim kita
            if (kondisiKita) {
                switch (kondisiKita) {
                    case 'Kondisi Sangat Baik':
                        impacts.push('âœ… Tim Prima: Maksimalkan intensitas dan pressing');
                        impacts.push('ğŸ¯ Style Direkomendasikan: Gegenpress/High Tempo');
                        break;
                    case 'Kondisi Baik':
                        impacts.push('âœ… Tim Fit: Pertahankan intensitas normal');
                        impacts.push('ğŸ¯ Style Direkomendasikan: Control Possession/Balanced');
                        break;
                    case 'Kondisi Standar':
                        impacts.push('âšª Tim Normal: Fleksibilitas taktik');
                        impacts.push('ğŸ¯ Style Direkomendasikan: Flexible/Adaptive');
                        break;
                    case 'Kondisi Buruk':
                        impacts.push('âš ï¸ Tim Lelah: Kurangi pressing, fokus organisasi');
                        impacts.push('ğŸ¯ Style Direkomendasikan: Cautious/Counter-Attack');
                        break;
                    case 'Kondisi Sangat Buruk':
                        impacts.push('ğŸ”´ Tim Sangat Lelah: Low block dan counter attack');
                        impacts.push('ğŸ¯ Style Direkomendasikan: Park the Bus/Catenaccio');
                        break;
                }
            }
            
            // Impact dari kondisi lawan (simplified)
            if (kondisiLawan) {
                switch (kondisiLawan) {
                    case 'Lawan Segar':
                        impacts.push('âš ï¸ Lawan Prima: Waspada pressing tinggi mereka');
                        break;
                    case 'Lawan Lelah':
                        impacts.push('âœ… Lawan Lelah: Tingkatkan pressing untuk exploit');
                        break;
                }
            }
            
            // Impact dari gaya bermain lawan
            if (gayaLawan && gayaLawan !== 'Unknown') {
                switch (gayaLawan) {
                    case 'Possession':
                        impacts.push('ğŸ¯ Vs Possession: Aktivasi pressing tinggi & tutup passing lanes');
                        break;
                    case 'Pressing':
                        impacts.push('ğŸ¯ Vs Pressing: Quick passing & hindari kehilangan bola');
                        break;
                    case 'Counter Attack':
                        impacts.push('ğŸ¯ Vs Counter: Patient build-up & careful possession');
                        break;
                    case 'Long Ball':
                        impacts.push('ğŸ¯ Vs Long Ball: Win aerial duels & higher defensive line');
                        break;
                    case 'Wing Play':
                        impacts.push('ğŸ¯ Vs Wing Play: Kompak di sayap & tutup crossing lanes');
                        break;
                    case 'Defensive':
                        impacts.push('ğŸ¯ Vs Defensive: Patient build-up & creative players');
                        break;
                    default:
                        impacts.push(`ğŸ¯ Vs ${gayaLawan}: Counter-tactics activated`);
                        break;
                }
            }
            
            if (impacts.length > 0) {
                impactText.innerHTML = impacts.join('<br>');
                impactDiv.style.display = 'block';
            } else {
                impactDiv.style.display = 'none';
            }
        }

        function createSmartRecommendation(jenisLawan, situasiGame, formasiLawan, gayaLawan) {
            // Base recommendation berdasarkan situasi game
            let rec = {
                formasi: "4-3-3",
                alternatif: "4-2-3-1", 
                gaya: "Balanced",
                instruksi: "Adaptasi sesuai kondisi permainan",
                tempo: "Standard Tempo - Adaptable rhythm",
                pemain: "Versatile players with good teamwork<br>Well-rounded squad for adaptation",
                outOfPossession: "4-3-3 Mid Block",
                defensiveLine: "Standard Line (50-60%)",
                marking: "ğŸ¯ Mark key threats: Assign specific markers to danger players<br>ğŸ¯ Zone marking: Maintain defensive shape and coverage",
                pressing: "âš¡ Press ball carrier: Nearest player applies immediate pressure<br>âš¡ Press passing lanes: Cut off easy options for opponent",
                setpieces: "ğŸŸï¸ Corners: Mixed delivery approach<br>ğŸŸï¸ Free kicks: Direct shots and crosses<br>ğŸŸï¸ Throw-ins: Quick release to maintain tempo",
                substitutions: "60' - Tactical adjustment<br>70' - Fresh legs injection<br>80' - Game situation response",
                risiko: "Sesuaikan dengan kekuatan tim"
            };

            // Modifikasi berdasarkan situasi game (simplified)
            switch(situasiGame) {
                case "Mengejar Skor":
                    rec.formasi = "4-2-3-1 Attacking";
                    rec.alternatif = "3-4-3";
                    rec.gaya = "High Press & Quick Attack | RECOMMENDED STYLE: Gegenpress/Vertical Tiki-Taka";
                    rec.instruksi = "Pressing tinggi untuk win ball<br>Overlapping fullbacks untuk width<br>Risk taking dalam attacking third";
                    rec.tempo = "Higher Tempo - Quick passing, fast transitions, urgency";
                    rec.pemain = "CAM (Creative Playmaker): Vision and passing ability<br>LW/RW (Pacey Wingers): Speed and crossing for width<br>ST (Clinical Finisher): Composure in front of goal";
                    rec.outOfPossession = "4-2-3-1 High Block - Aggressive pressing";
                    rec.defensiveLine = "Higher Line (65-75%)";
                    rec.marking = "ğŸ¯ CAM + CM man-marking: Assign specific players to mark their key threats<br>ğŸ¯ CAM presses their CDM: Follow their defensive midfielder everywhere<br>ğŸ¯ LW/RW track their FB: Wingers track back to prevent overlaps";
                    rec.pressing = "âš¡ ST + CAM high intensity: 6-second rule to win ball back<br>âš¡ ST + CAM + LW/RW coordinate: Multiple players press simultaneously<br>âš¡ ST + CAM force long balls: Press their CB to force errors";
                    rec.setpieces = "ğŸŸï¸ Corners: Attack near post aggressively<br>ğŸŸï¸ Free kicks: Direct shots on target<br>ğŸŸï¸ Quick restarts: Maintain attacking momentum";
                    rec.substitutions = "60' - Fresh attacking midfielder<br>70' - Pace injection on wings<br>80' - Target man for crosses";
                    rec.risiko = "Rentan counter-attack, butuh stamina tinggi";
                    break;
                case "Mempertahankan Keunggulan":
                    rec.formasi = "4-5-1 Defensive";
                    rec.alternatif = "5-3-2";
                    rec.gaya = "Structured Defense & Counter | RECOMMENDED STYLE: Catenaccio/Disciplined Defending";
                    rec.instruksi = "Compact defensive shape<br>Deep block positioning<br>Disciplined team structure";
                    rec.tempo = "Lower Tempo - Patient build-up, control possession";
                    rec.pemain = "CDM (Defensive Anchor): Interceptions and tackles<br>LW/RW (Pacey Counter): Speed on the break<br>CB (Composed Leader): Leadership and positioning";
                    rec.outOfPossession = "5-4-1 Deep Block - Protective formation";
                    rec.defensiveLine = "Deep Line (35-45%)";
                    rec.marking = "ğŸ›¡ï¸ CB + WB + CDM zonal: Maintain compact defensive shape<br>ğŸ›¡ï¸ CDM + CM cover lanes: Block key passes to their attackers<br>ğŸ›¡ï¸ CDM + CM double team: Two players close down their creative outlet";
                    rec.pressing = "ğŸ›¡ï¸ ST + CDM mid-block: Press when they enter final third<br>ğŸ›¡ï¸ CB + WB force wide: Show them to the flanks, not through center<br>ğŸ›¡ï¸ CDM + CM disciplined: Stay compact, don't chase the ball";
                    rec.setpieces = "ğŸ›¡ï¸ Corners: Man-mark their aerial threats<br>ğŸ›¡ï¸ Free kicks: Wall positioning and keeper preparation<br>ğŸ›¡ï¸ Time wasting: Legal delays to manage clock";
                    rec.substitutions = "70' - Fresh defensive midfielder<br>75' - Defensive fullback<br>85' - Time-wasting experienced player";
                    rec.risiko = "Pressure terus-menerus, perlu disiplin tinggi";
                    break;
                case "Skor Imbang":
                    rec.formasi = "4-3-3 Balanced";
                    rec.alternatif = "4-2-3-1";
                    rec.gaya = "Balanced Approach | RECOMMENDED STYLE: Flexible/Adaptive";
                    rec.instruksi = "Maintain team shape<br>Look for opportunities<br>Stay compact defensively";
                    rec.tempo = "Standard Tempo - Flexible rhythm, adapt to game flow";
                    rec.pemain = "Versatile midfielders: Good all-around abilities<br>Clinical striker: Finishing when chances come<br>Disciplined defenders: Maintain team shape";
                    rec.outOfPossession = "4-3-3 Mid Block - Structured defending";
                    rec.defensiveLine = "Standard Line (50-60%)";
                    rec.marking = "ğŸ¯ ZONAL MARKING: Maintain defensive zones and shape<br>ğŸ¯ Man-mark key playmaker: Assign DM to shadow their creative midfielder<br>ğŸ¯ Communicate zones: Constant communication between defensive lines";
                    rec.pressing = "âš¡ Selective pressing: Choose safe moments to press<br>âš¡ Trigger press: Press when they play backwards or sideways<br>âš¡ Team press: Coordinate pressing with defensive shape";
                    rec.setpieces = "ğŸŸï¸ Corners: Balanced approach - defend and attack<br>ğŸŸï¸ Free kicks: Look for opportunities but stay safe<br>ğŸŸï¸ Quick restarts: Capitalize on disorganization";
                    rec.substitutions = "60' - Impact player if opportunity arises<br>70' - Fresh legs for key positions<br>80' - Tactical switch based on game flow";
                    rec.risiko = "Pertahankan disiplin, tunggu momentum";
                    break;
                default:
                    rec.gaya += " | RECOMMENDED STYLE: Flexible/Balanced";
                    rec.tempo = "Standard Tempo - Adaptable to game situation";
                    rec.pemain = "Well-rounded players with good teamwork<br>Versatile squad players for adaptation";
                    rec.outOfPossession = "4-3-3 Balanced Mid Block";
                    rec.marking = "ğŸ¯ Standard marking: Follow tactical assignments<br>ğŸ¯ Communicate: Constant talk between defenders";
                    rec.pressing = "âš¡ Press when safe: Avoid unnecessary risks<br>âš¡ Press together: Coordinate team pressing movements";
                    rec.setpieces = "ğŸŸï¸ Corners: Standard delivery to dangerous areas<br>ğŸŸï¸ Free kicks: Safe approach with occasional risk<br>ğŸŸï¸ Throw-ins: Quick release to maintain rhythm";
                    rec.substitutions = "60' - Address weak areas<br>70' - Fresh legs for tired players<br>80' - Tactical adjustment based on situation";
                    break;
            }

            // Modifikasi berdasarkan jenis lawan
            switch(jenisLawan) {
                case "Tim Kuat (Possession-based)":
                    rec.instruksi += ". Vs possession team: pressing kompak, interrupt build-up";
                    rec.pemain += ", High work-rate midfield, Pressing specialists";
                    rec.outOfPossession = rec.outOfPossession.replace('Mid Block', 'High Block') + " - Disrupt possession";
                    break;
                case "Tim Pressing Tinggi":
                    rec.instruksi += ". Vs high press: quick passing, long balls, exploit space behind";
                    rec.gaya += " & Quick Transition";
                    rec.pemain += ", Technical passers, Pace in attack";
                    rec.outOfPossession += " - Quick release under pressure";
                    break;
                case "Tim Counter-attack":
                    rec.instruksi += ". Vs counter team: patient build-up, don't lose ball cheaply";
                    rec.defensiveLine = "Standard Line (50-60%)";
                    rec.pemain += ", Patient playmakers, Defensive discipline";
                    rec.outOfPossession += " - Careful possession retention";
                    break;
                case "Tim Fisik/Tinggi":
                    rec.instruksi += ". Vs physical team: technical football, avoid aerial duels";
                    rec.gaya += " & Technical";
                    rec.pemain += ", Technical players, Mobile attackers, Quick passing";
                    rec.outOfPossession += " - Avoid physical battles";
                    break;
                case "Tim Teknis/Pendek":
                    rec.instruksi += ". Vs technical team: physical press, disrupt their rhythm";
                    rec.pemain += ", Physical midfield, Aggressive pressers";
                    rec.outOfPossession = rec.outOfPossession.replace('Mid Block', 'High Block') + " - Physical disruption";
                    break;
                case "Tim Lemah (Defensive)":
                    rec.instruksi += ". Vs defensive team: patient build-up, width, crosses";
                    rec.formasi = "4-2-3-1";
                    rec.gaya += " & Width Attack";
                    rec.pemain += ", Creative wingers, Crossing specialists, Aerial threat";
                    rec.outOfPossession += " - Patient build-up focus";
                    break;
            }

            // Modifikasi berdasarkan formasi lawan
            if (formasiLawan) {
                switch(formasiLawan) {
                    case "4-3-3":
                        rec.instruksi += ". Vs 4-3-3: overload midfield, exploit CAM position";
                        if (rec.formasi === "4-3-3") rec.formasi = "4-2-3-1";
                        break;
                    case "4-2-3-1":
                        rec.instruksi += ". Vs 4-2-3-1: mark CAM tightly, press their DMs";
                        rec.pemain += ", DM to mark CAM";
                        break;
                    case "4-4-2":
                        rec.instruksi += ". Vs 4-4-2: overload midfield, exploit wide areas";
                        if (rec.formasi === "4-4-2") rec.formasi = "4-3-3";
                        break;
                    case "3-5-2":
                        rec.instruksi += ". Vs 3-5-2: exploit wide areas, stretch their wingbacks";
                        rec.alternatif = "4-3-3";
                        break;
                    case "5-3-2":
                        rec.instruksi += ". Vs 5-3-2: patient build-up, crosses, set pieces";
                        rec.gaya += " & Width";
                        break;
                }
            }

            return rec;
        }

        function showDefaultRecommendation(lawan, situasi, kondisiKita, formasiLawan, gayaLawan, kondisiLawan) {
            // Logika default berdasarkan situasi umum
            let formasi = "4-3-3";
            let alternatif = "4-2-3-1";
            let gaya = "Balanced";
            let instruksi = "Adaptasi sesuai kondisi permainan";
            let tempo = "Standard Tempo - Adaptable rhythm";
            let pemain = "Versatile players with good teamwork<br>Well-rounded squad for adaptation";
            let outOfPossession = "4-3-3 Mid Block";
            let defensiveLine = "Standard Line (50-60%)";
            let marking = "ğŸ¯ Mark their key players: Focus on danger positions<br>ğŸ¯ Maintain zonal discipline: Keep defensive shape";
            let pressing = "âš¡ Press collectively: Coordinate team pressing<br>âš¡ Press their playmakers: Disrupt their build-up rhythm";
            let risiko = "Sesuaikan dengan kekuatan tim";

            // Rekomendasi berdasarkan formasi lawan
            if (formasiLawan) {
                switch(formasiLawan) {
                    case "4-3-3":
                        formasi = "4-2-3-1";
                        instruksi = "Overload midfield, exploit CAM position";
                        outOfPossession = "4-1-4-1 Mid Block, Press their wingers";
                        break;
                    case "4-2-3-1":
                        formasi = "4-3-3";
                        instruksi = "Match their width, press their CAM";
                        outOfPossession = "4-3-3 Mid Block, Mark CAM tight";
                        break;
                    case "4-4-2":
                        formasi = "4-3-3";
                        instruksi = "Overload midfield, exploit wide areas";
                        outOfPossession = "4-1-4-1 Mid Block, Control midfield";
                        break;
                    case "3-5-2":
                        formasi = "4-3-3";
                        instruksi = "Exploit wide areas, stretch their formation";
                        outOfPossession = "4-4-2 Wide, Match wingbacks";
                        break;
                    case "5-3-2":
                        formasi = "3-4-3";
                        instruksi = "Width attack, patient build-up, crosses";
                        outOfPossession = "3-6-1 High Block, Force wide";
                        defensiveLine = "Higher Line (65-75%)";
                        break;
                }
            }

            // Modifikasi berdasarkan situasi
            if (situasi.includes("Mengejar Skor")) {
                if (formasi === "4-3-3") formasi = "4-2-3-1 Attacking";
                else if (formasi === "4-2-3-1") formasi = "3-4-3";
                gaya = "Offensive";
                instruksi += ", high press, take risks";
                tempo = "Higher Tempo - Quick passing, fast transitions, urgency";
                outOfPossession = outOfPossession.replace("Mid Block", "High Block");
                defensiveLine = "Higher Line (70-80%)";
                risiko = "Rentan counter-attack";
            } else if (situasi.includes("Mempertahankan")) {
                if (formasi === "4-3-3") formasi = "4-5-1";
                else formasi = "5-4-1";
                gaya = "Defensive";
                instruksi += ", compact defending, counter when possible";
                tempo = "Lower Tempo - Slow down game, control rhythm, waste time";
                outOfPossession = outOfPossession.replace("Mid Block", "Low Block");
                defensiveLine = "Lower Line (40-50%)";
                risiko = "Sulit mencetak gol";
            }

            // **MODIFIKASI BERDASARKAN KONDISI TIM**
            if (kondisi) {
                switch(kondisi) {
                    case "Tim Lelah":
                        formasi = formasi.replace("Attacking", "Conservative");
                        if (formasi.includes("3-4-3")) formasi = "4-4-2";
                        gaya = "Low Intensity & Possession";
                        instruksi = "Kurangi pressing, control tempo, protect stamina";
                        outOfPossession = "4-4-2 Low Block - Conserve energy";
                        defensiveLine = "Lower Line (35-45%) - Save energy";
                        risiko = "Stamina terbatas, avoid high intensity periods";
                        break;
                        
                    case "Tim Segar":
                        if (formasi === "4-3-3") formasi = "4-2-3-1 High Press";
                        gaya = "High Intensity & Aggressive";
                        instruksi += ", maximum pressing, high tempo";
                        outOfPossession = outOfPossession.replace("Mid Block", "High Block");
                        defensiveLine = "Higher Line (70-85%) - Use fresh legs";
                        risiko = "Manfaatkan stamina prima, hati-hati overcommitment";
                        break;
                        
                    case "Banyak Cedera":
                        formasi = "4-4-2 Simple";
                        alternatif = "4-5-1";
                        gaya = "Simple & Safe";
                        instruksi = "Formasi sederhana, hindari kompleksitas, protect players";
                        pemain = "Available fit players only";
                        outOfPossession = "4-4-2 Low Block - Protect players";
                        defensiveLine = "Lower Line (35-45%) - Safety first";
                        risiko = "Prioritas keselamatan, hindari cedera tambahan";
                        break;
                        
                    case "Pemain Muda":
                        gaya += " & High Energy";
                        instruksi += ", manfaatkan pace & energy muda";
                        pemain = "Young players + experienced leaders";
                        outOfPossession += " - Young legs advantage";
                        defensiveLine += " - Use pace to recover";
                        risiko = "Mental pressure tinggi, butuh senior guidance";
                        break;
                        
                    case "Tim Berpengalaman":
                        if (formasi.includes("Simple")) formasi = formasi.replace("Simple", "Tactical");
                        gaya = gaya.replace("Simple", "Intelligent");
                        instruksi += ", leverage experience & game intelligence";
                        pemain = "Experienced leaders, smart positioning";
                        outOfPossession = outOfPossession.replace("Block", "Intelligent Block");
                        defensiveLine += " - Smart positioning";
                        risiko = "Mungkin kurang pace, kompensasi dengan intelligence";
                        break;
                }
            }

            // Tambahkan info formasi lawan
            const formasiText = formasiLawan ? `${formasi} (vs ${formasiLawan})` : formasi;

            document.getElementById('formasiUtama').textContent = formasiText;
            document.getElementById('formasiAlternatif').textContent = alternatif;
            document.getElementById('instruksiKhusus').textContent = instruksi;
            document.getElementById('tempoPermainan').innerHTML = tempo;
            document.getElementById('pemainKunci').innerHTML = pemain;
            document.getElementById('outOfPossession').textContent = outOfPossession;
            document.getElementById('defensiveLine').textContent = defensiveLine;
            document.getElementById('markingStrategy').innerHTML = marking || "ğŸ¯ Standard marking assignments";
            document.getElementById('pressingStrategy').innerHTML = pressing || "âš¡ Press when opportunity arises";
            document.getElementById('setPieces').innerHTML = "ğŸŸï¸ Standard set piece routines";
            document.getElementById('substitutionPlan').innerHTML = "ğŸ”„ Tactical substitutions as needed";
            document.getElementById('risikoHint').textContent = risiko;
            
            // Analisis gaya permainan untuk default recommendation
            const defaultRec = {
                gaya: gaya,
                formasi: formasi,
                instruksi: instruksi,
                tempo: tempo
            };
            analyzePlayingStyle(defaultRec, situasi, lawan);
        }

        function analyzePlayingStyle(recommendation, situasiGame, jenisLawan) {
            console.log('Analyzing playing style:', recommendation); // Debug
            
            let gayaUtama = "Balanced";
            let filosofiOffensive = "Standard approach";
            let filosofiDefensive = "Organized defending";
            let intensitas = "Medium";
            let karakteristik = "Versatile and adaptable";
            let riskReward = "Balanced risk vs reward";
            let tempoRecommendation = "";
            let tacticalApproach = "";

            // Analisis berdasarkan formasi dan gaya
            const formasi = recommendation.formasi ? recommendation.formasi.toLowerCase() : "";
            const gaya = recommendation.gaya ? recommendation.gaya.toLowerCase() : "";
            const instruksi = recommendation.instruksi ? recommendation.instruksi.toLowerCase() : "";
            
            // Extract defensive line & pressing (support both HTML format and plain string)
            let defensiveLine = "";
            let pressing = "";
            
            console.log('ğŸ” DEBUG - Raw data:', {
                rawDefensiveLine: recommendation.defensiveLine,
                rawPressing: recommendation.pressing
            });
            
            if (recommendation.defensiveLine) {
                const dlString = String(recommendation.defensiveLine).toLowerCase();
                
                // Try regex first for HTML format
                const dlMatch = recommendation.defensiveLine.match(/(High Line|Mid Line|Low Line)/i);
                if (dlMatch) {
                    defensiveLine = dlMatch[1].toLowerCase();
                    console.log('ğŸ” Defensive Line Match (regex):', dlMatch[1]);
                }
                // Fallback: direct string match
                else if (dlString.includes('high line') || dlString.includes('high-line')) {
                    defensiveLine = 'high line';
                    console.log('ğŸ” Defensive Line Match (fallback): high line');
                } else if (dlString.includes('mid line') || dlString.includes('mid-line')) {
                    defensiveLine = 'mid line';
                    console.log('ğŸ” Defensive Line Match (fallback): mid line');
                } else if (dlString.includes('low line') || dlString.includes('low-line')) {
                    defensiveLine = 'low line';
                    console.log('ğŸ” Defensive Line Match (fallback): low line');
                }
            }
            
            if (recommendation.pressing) {
                const pressString = String(recommendation.pressing).toLowerCase();
                
                // Try regex first for HTML format
                const pressMatch = recommendation.pressing.match(/(High Press|Mid Press|Low Press)/i);
                if (pressMatch) {
                    pressing = pressMatch[1].toLowerCase();
                    console.log('ğŸ” Pressing Match (regex):', pressMatch[1]);
                }
                // Fallback: direct string match
                else if (pressString.includes('high press') || pressString.includes('high-press')) {
                    pressing = 'high press';
                    console.log('ğŸ” Pressing Match (fallback): high press');
                } else if (pressString.includes('mid press') || pressString.includes('mid-press')) {
                    pressing = 'mid press';
                    console.log('ğŸ” Pressing Match (fallback): mid press');
                } else if (pressString.includes('low press') || pressString.includes('low-press')) {
                    pressing = 'low press';
                    console.log('ğŸ” Pressing Match (fallback): low press');
                }
            }
            
            const outOfPossession = recommendation.outOfPossession ? recommendation.outOfPossession.toLowerCase() : "";
            
            console.log('ğŸ¯ Analysis data:', {
                formasi, 
                gaya, 
                instruksi, 
                defensiveLine, 
                pressing, 
                outOfPossession,
                detected: {
                    isGegenpress: (defensiveLine.includes('high') && pressing.includes('high')),
                    isLowBlock: (defensiveLine.includes('low') && pressing.includes('low')),
                    isCounter: (defensiveLine.includes('low') && !pressing.includes('high')),
                    isHighPress: (pressing.includes('high') && !defensiveLine.includes('high'))
                }
            });
            
            // MATRIX-BASED DETECTION: Defensive Line + Pressing Strategy combination
            let isGegenpress = (defensiveLine.includes('high') && pressing.includes('high'));
            let isLowBlock = (defensiveLine.includes('low') && pressing.includes('low'));
            let isCounter = (defensiveLine.includes('low') && (pressing.includes('mid') || pressing.includes('low'))) && !isLowBlock;
            let isHighPress = (pressing.includes('high') && !isGegenpress);
            let isBalancedPress = (defensiveLine.includes('mid') && pressing.includes('mid'));
            
            // SITUASI GAME CONTEXT
            let isProtectLead = (situasiGame === "Mempertahankan Keunggulan");
            let isChasingGame = (situasiGame === "Mengejar Skor");
            
            // JENIS LAWAN CONTEXT
            let vsTimKuat = jenisLawan && (jenisLawan.includes("Kuat") || jenisLawan.includes("Rival"));
            let vsTimLemah = jenisLawan && jenisLawan.includes("Lemah");
            let vsTimSeimbang = jenisLawan && (jenisLawan.includes("Seimbang") || jenisLawan.includes("Promosi"));
            
            // FORMASI CHARACTERISTICS
            let isAttackingFormation = formasi.includes('4-3-3') || formasi.includes('4-2-4') || formasi.includes('3-4-3');
            let isDefensiveFormation = formasi.includes('5-3-2') || formasi.includes('5-4-1') || formasi.includes('4-5-1');
            let isBalancedFormation = formasi.includes('4-4-2') || formasi.includes('4-2-3-1') || formasi.includes('4-1-4-1');
            
            // GAYA DARI DATABASE
            let isPossessionDB = gaya.includes('tiki-taka') || gaya.includes('possession') || gaya.includes('control');
            let isCounterDB = gaya.includes('counter') || gaya.includes('compact');
            let isDirectDB = gaya.includes('direct') || gaya.includes('physical') || gaya.includes('aggressive');
            let isDefensiveDB = gaya.includes('defensive') || gaya.includes('catenaccio') || gaya.includes('park the bus');

            // === PRIORITIZED ANALYSIS BASED ON MATRIX SYSTEM ===
            
            // PRIORITY 1: GEGENPRESS (High Line + High Press)
            if (isGegenpress) {
                gayaUtama = "Gegenpressing / High Intensity Press";
                filosofiOffensive = "Vertical passing, quick transitions, constant pressure, score quickly after winning ball";
                filosofiDefensive = "High line + Aggressive press, win ball back in 6 seconds, coordinated pressing traps";
                intensitas = "Very High";
                karakteristik = "Relentless energy, quick transitions, collective pressing, physically demanding";
                riskReward = "High risk, high reward - vulnerable to direct balls if press is bypassed";
                tempoRecommendation = "High-Very High Tempo untuk maksimalkan tekanan";
                tacticalApproach = "âš¡ HIGH LINE (70-80%) + HIGH PRESS - Tekan tinggi terus-menerus";
            }
            
            // PRIORITY 2: LOW BLOCK DEFENSE (Low Line + Low Press)
            else if (isLowBlock || isDefensiveDB || (isProtectLead && vsTimKuat)) {
                gayaUtama = "Low Block / Defensive Stability";
                filosofiOffensive = "Minimal attacking, quick counters only, protect lead at all costs";
                filosofiDefensive = "Low block (40-50%), ultra compact shape, everyone behind ball, deny space";
                intensitas = "Low";
                karakteristik = "Ultra disciplined, patient, defensively solid, prioritize clean sheet";
                riskReward = "Very low risk, minimal attack - preserve result";
                tempoRecommendation = "Low Tempo untuk kontrol possession dan buang waktu";
                tacticalApproach = "ğŸ›¡ï¸ LOW LINE (40-50%) + LOW PRESS - Bertahan kompak, counter minimal";
            }
            
            // PRIORITY 3: COUNTER-ATTACK (Low/Mid Line + Selective Press)
            else if (isCounter || isCounterDB || (vsTimKuat && !isChasingGame)) {
                gayaUtama = "Counter-Attack / Compact Defense";
                filosofiOffensive = "Quick transitions, exploit space on break, direct passing, clinical finishing";
                filosofiDefensive = "Compact mid/low block, absorb pressure, win ball and break fast";
                intensitas = "Medium";
                karakteristik = "Disciplined, opportunistic, defensively solid, patient waiting for mistakes";
                riskReward = "Low risk, moderate reward - wait for right moments";
                tempoRecommendation = "Low-Medium Tempo saat build-up, High Tempo saat counter";
                tacticalApproach = "âš–ï¸ MID/LOW LINE (50-60%) + MID/LOW PRESS - Absorb lalu serang cepat";
            }
            
            // PRIORITY 4: POSSESSION PLAY (Detected from database or vs weak teams)
            else if (isPossessionDB || (vsTimLemah && !isChasingGame)) {
                gayaUtama = "Possession Play / Control Game";
                filosofiOffensive = "Patient build-up, short passing, technical superiority, tire opponents, control tempo";
                filosofiDefensive = "Mid/High line, possession-based defending, press when losing ball";
                intensitas = "Medium-High";
                karakteristik = "Technical excellence, patience, ball retention, dictate game rhythm";
                riskReward = "Low risk, controlled reward - dominate possession and territory";
                tempoRecommendation = "Low-Medium Tempo untuk kontrol, bisa dinaikkan jika perlu goal";
                tacticalApproach = "âš¡ MID LINE (55-65%) + MID PRESS - Dominasi bola, tekan saat kehilangan";
            }
            
            // PRIORITY 5: HIGH PRESS without High Line
            else if (isHighPress && !isGegenpress) {
                gayaUtama = "High Press / Aggressive Pressing";
                filosofiOffensive = "Win ball high, quick attack after winning possession, direct to goal";
                filosofiDefensive = "Aggressive pressing all areas, win ball early, force errors";
                intensitas = "High";
                karakteristik = "Aggressive, proactive, high energy, force opponent mistakes";
                riskReward = "Medium-High risk - can be exposed if press beaten";
                tempoRecommendation = "High Tempo untuk maksimalkan tekanan tanpa risiko tinggi seperti Gegenpress";
                tacticalApproach = "âš¡ MID LINE (55-65%) + HIGH PRESS - Press agresif tapi line tidak terlalu tinggi";
            }
            
            // PRIORITY 6: DIRECT/AGGRESSIVE PLAY
            else if (isDirectDB || instruksi.includes('direct') || instruksi.includes('long ball')) {
                gayaUtama = "Direct Play / Physical Approach";
                filosofiOffensive = "Direct passing, long balls, set pieces, physical duels, get ball forward quickly";
                filosofiDefensive = "Win duels, aggressive challenges, show strength, confront opposition";
                intensitas = "High";
                karakteristik = "Physical, direct, confrontational, high-tempo transitions";
                riskReward = "Medium-High risk - can be effective but less control";
                tempoRecommendation = "High Tempo untuk serangan langsung dan fisik";
                tacticalApproach = "âš¡ MID LINE (55-65%) + MID/HIGH PRESS - Fisik, langsung, confront";
            }
            
            // PRIORITY 7: CHASING GAME (Situasi mengejar skor)
            else if (isChasingGame) {
                gayaUtama = "Desperate Attack / All-Out Offensive";
                filosofiOffensive = "Maximum commitment forward, take risks, quick shots, urgency";
                filosofiDefensive = "Minimal - all focus on scoring, accept counter-attack risk";
                intensitas = "Very High";
                karakteristik = "Urgent, risky, all-out attack, desperate for goal";
                riskReward = "Very high risk - must score, vulnerable to counters";
                tempoRecommendation = "High-Very High Tempo - maksimalkan waktu untuk cetak gol";
                tacticalApproach = "âš¡ HIGH LINE + HIGH PRESS - Tekan total untuk cetak gol";
            }

            // Analisis berdasarkan formasi spesifik jika gaya belum terdeteksi
            if (gayaUtama === "Balanced") {
                if (formasi.includes('attacking') || formasi.includes('3-4-3') || formasi.includes('4-2-4')) {
                    gayaUtama = "Attacking/Offensive Play";
                    filosofiOffensive = "Forward-thinking, multiple attacking threats";
                    intensitas = "High";
                    karakteristik = "Offensive-minded, creative, goal-focused";
                    riskReward = "Higher risk for goal rewards";
                } else if (formasi.includes('defensive') || formasi.includes('5-') || formasi.includes('park')) {
                    gayaUtama = "Defensive/Cautious Play";
                    filosofiDefensive = "Prioritize defensive stability, organized structure";
                    intensitas = "Low-Medium";
                    karakteristik = "Defensively disciplined, cautious approach";
                    riskReward = "Lower risk, defensive priority";
                }
            }
            
            // Fallback: Analisis berdasarkan situasi dan lawan jika masih balanced
            if (gayaUtama === "Balanced") {
                if (jenisLawan && jenisLawan.includes("Kuat")) {
                    gayaUtama = "Pragmatic/Counter Style";
                    filosofiOffensive = "Cautious attack, exploit opportunities";
                    filosofiDefensive = "Compact defense, absorb pressure";
                    karakteristik = "Pragmatic, disciplined, opportunistic";
                    riskReward = "Lower risk vs strong opposition";
                } else if (jenisLawan && jenisLawan.includes("Lemah")) {
                    gayaUtama = "Dominant/Possession Style";
                    filosofiOffensive = "Control possession, dominate territory";
                    filosofiDefensive = "High line, aggressive pressing";
                    karakteristik = "Dominant, technical, controlling";
                    riskReward = "Should dominate, expect results";
                } else if (jenisLawan && jenisLawan.includes("Rival")) {
                    gayaUtama = "High Intensity/Derby Style";
                    filosofiOffensive = "Maximum commitment, all-out approach";
                    filosofiDefensive = "Aggressive, confrontational defending";
                    intensitas = "Maximum";
                    karakteristik = "Emotional, intense, win-at-all-costs";
                    riskReward = "High emotion, high stakes";
                }
            }
            
            // FINAL FALLBACK: Balanced/Standard Play (jika tidak ada yang terdeteksi sama sekali)
            if (gayaUtama === "Balanced") {
                gayaUtama = "Balanced / Standard Play";
                filosofiOffensive = "Flexible approach, adapt to game situation, create chances when available";
                filosofiDefensive = "Organized defending, maintain shape, selective pressing";
                intensitas = "Medium";
                karakteristik = "Versatile, adaptable, balanced in all phases";
                riskReward = "Balanced approach - neither too cautious nor too aggressive";
                tempoRecommendation = "Medium Tempo - fleksibel sesuai situasi";
                tacticalApproach = "âš–ï¸ MID LINE (55-65%) + MID PRESS - Seimbang di semua aspek";
            }

            // === CONTEXT MODIFIERS ===
            let contextNotes = [];
            
            // Add situasi game context
            if (situasiGame === "Mengejar Skor") {
                contextNotes.push("â° <strong>Mengejar Skor:</strong> Intensitas & risiko ditingkatkan untuk cetak gol");
            } else if (situasiGame === "Mempertahankan Keunggulan") {
                contextNotes.push("ğŸ›¡ï¸ <strong>Pertahankan Keunggulan:</strong> Prioritas defensive, kontrol permainan");
            }
            
            // Add jenis lawan context
            if (vsTimKuat) {
                contextNotes.push("ğŸ’ª <strong>Vs Tim Kuat:</strong> Pendekatan lebih hati-hati, exploitasi mistake mereka");
            } else if (vsTimLemah) {
                contextNotes.push("ğŸ¯ <strong>Vs Tim Lemah:</strong> Dominasi possession & territory, tekan terus");
            } else if (vsTimSeimbang) {
                contextNotes.push("âš–ï¸ <strong>Vs Tim Seimbang:</strong> Head-to-head battle, siapa yang execute lebih baik");
            }
            
            // Add formasi context
            if (isAttackingFormation) {
                contextNotes.push("âš¡ <strong>Formasi Menyerang:</strong> Setup mendukung serangan, banyak pemain maju");
            } else if (isDefensiveFormation) {
                contextNotes.push("ğŸ›¡ï¸ <strong>Formasi Bertahan:</strong> Setup prioritas stabilitas defensive");
            }
            
            // Compile context
            let contextHTML = contextNotes.length > 0 ? 
                "<br><div style='padding: 8px; background: rgba(130, 170, 255, 0.1); border-left: 3px solid #82aaff; border-radius: 3px; margin-top: 8px;'>" +
                "<strong style='color: #82aaff;'>ğŸ“‹ Konteks Pertandingan:</strong><br>" +
                contextNotes.join("<br>") +
                "</div>" : "";

            // === DETEKSI BLOK LAWAN & STRATEGI PASSING ===
            let blokLawanHTML = "";
            
            // Ekstrak Line of Defence, Line of Engagement, Pressing dari LAWAN (dari Gaya Lawan atau inferensi)
            const gayaLawan = document.getElementById('gayaLawan').value;
            let jenisBlok = "";
            let tujuanBlok = "";
            let strategiPassing = [];
            
            // Deteksi berdasarkan Gaya Lawan dengan mapping yang komprehensif
            let lineOfDefence = "";
            let lineOfEngagement = "";
            let pressingIntensity = "";
            
            if (gayaLawan === "Pressing" || gayaLawan.includes("High Press") || gayaLawan.includes("Gegenpress")) {
                // PRESSING: High Block / Gegenpress
                jenisBlok = "ğŸ”¥ High Block / Gegenpress";
                lineOfDefence = "High (70-80%)";
                lineOfEngagement = "High (aggressive from build-up)";
                pressingIntensity = "Heavy (seluruh tim menekan)";
                tujuanBlok = "Menekan tinggi untuk memaksa kehilangan bola di area berbahaya";
                strategiPassing = [
                    "â¤ <strong>Direct passing</strong> ke ruang belakang (exploit space in behind)",
                    "â¤ <strong>Quick counters</strong> setelah win ball - transition cepat",
                    "â¤ <strong>Long balls</strong> atau through balls melewati pressing trap",
                    "ğŸ’¡ <em>Hindari build-up lambat - lawan akan menekan habis-habisan</em>"
                ];
            } else if (gayaLawan === "Possession" || gayaLawan.includes("Tiki-Taka")) {
                // POSSESSION: High Line â€“ Delayed Press
                jenisBlok = "âš”ï¸ High Line â€“ Delayed Press";
                lineOfDefence = "High (65-75%)";
                lineOfEngagement = "Medium (mulai press di tengah)";
                pressingIntensity = "Medium (pressing terstruktur)";
                tujuanBlok = "Menahan di tengah dan memancing lawan meninggalkan ruang di belakang";
                strategiPassing = [
                    "â¤ <strong>Mix passing</strong> untuk memancing blok keluar dari posisi",
                    "â¤ <strong>Third-man runs</strong>, underlap, atau play between lines",
                    "â¤ <strong>Quick tempo</strong> untuk exploit space before they recover shape",
                    "ğŸ’¡ <em>Manfaatkan ruang antar lini (between midfield & defense)</em>"
                ];
            } else if (gayaLawan === "Counter Attack" || gayaLawan.includes("Counter")) {
                // COUNTER ATTACK: Mid-Low Block (Compact)
                jenisBlok = "ğŸ§© Mid-Low Block (Compact Defense)";
                lineOfDefence = "Low (45-55%)";
                lineOfEngagement = "Medium (press di tengah lapangan)";
                pressingIntensity = "Medium (selektif, jaga formasi)";
                tujuanBlok = "Bertahan kompak, menutup area berbahaya, lalu counter cepat";
                strategiPassing = [
                    "â¤ <strong>Switch play</strong> cepat (Mix Passing) untuk geser blok pertahanan",
                    "â¤ <strong>Deep crosses</strong> atau cutback dari byline (low cross lebih efektif)",
                    "â¤ <strong>Combine play</strong> di wide areas lalu cut inside ke box",
                    "ğŸ’¡ <em>Tembakan jarak jauh kadang jadi solusi untuk paksa mereka keluar</em>"
                ];
            } else if (gayaLawan === "Long Ball" || gayaLawan.includes("Direct")) {
                // LONG BALL: Mid-Low Block dengan fokus physical
                jenisBlok = "ğŸ§© Mid-Low Block (Physical/Direct)";
                lineOfDefence = "Low (40-50%)";
                lineOfEngagement = "Medium (press di second balls)";
                pressingIntensity = "Medium (physical challenges)";
                tujuanBlok = "Bertahan kompak dengan fokus duel fisik dan transisi cepat";
                strategiPassing = [
                    "â¤ <strong>Patient build-up</strong> - jangan terburu main panjang juga",
                    "â¤ <strong>Quick combination play</strong> untuk bypass physical duels",
                    "â¤ <strong>Exploit flanks</strong> dengan speed & skill, hindari physical battles di tengah",
                    "ğŸ’¡ <em>Switch play untuk avoid aerial duels - gunakan teknik bukan fisik</em>"
                ];
            } else if (gayaLawan === "Wing Play" || gayaLawan.includes("Flank")) {
                // WING PLAY: Mid Block dengan fokus defend wide
                jenisBlok = "âš–ï¸ Mid Block (Wide Focus)";
                lineOfDefence = "Medium (50-60%)";
                lineOfEngagement = "Medium (press di sayap & tengah)";
                pressingIntensity = "Medium (fokus wide areas)";
                tujuanBlok = "Kontrol tengah sambil defend wide areas dengan fullback aktif";
                strategiPassing = [
                    "â¤ <strong>Play through the middle</strong> - exploit central areas yang kurang dijaga",
                    "â¤ <strong>Quick central combinations</strong> dengan CAM/striker",
                    "â¤ <strong>Overload center</strong> untuk tarik perhatian dari sayap",
                    "ğŸ’¡ <em>Gunakan inverted wingers untuk cut inside ke ruang yang terbuka</em>"
                ];
            } else if (gayaLawan === "Defensive" || gayaLawan.includes("Park the Bus") || gayaLawan.includes("Low Block")) {
                // DEFENSIVE: Low Block / Park the Bus
                jenisBlok = "ğŸ§± Low Block / Park the Bus";
                lineOfDefence = "Low (30-40%)";
                lineOfEngagement = "Low (press minimal, jaga shape)";
                pressingIntensity = "Low (bertahan sangat dalam)";
                tujuanBlok = "Meminimalkan ruang di kotak penalti dan paksa lawan serang dari luar";
                strategiPassing = [
                    "â¤ <strong>Sabar & lebar</strong> (Short passing) - jangan terburu-buru",
                    "â¤ <strong>Exploit flanks</strong> dengan overload, lalu cutback atau underlap",
                    "â¤ <strong>Work ball into box</strong> - hindari crossing dini yang mudah di-clear",
                    "ğŸ’¡ <em>Jaga tempo agar lawan dipaksa keluar - patience is key</em>"
                ];
            } else {
                // DEFAULT / BALANCED: Mid Block
                jenisBlok = "âš–ï¸ Mid Block (Balanced)";
                lineOfDefence = "Medium (50-60%)";
                lineOfEngagement = "Medium (press di tengah)";
                pressingIntensity = "Medium (balanced pressing)";
                tujuanBlok = "Mengontrol ruang tengah sambil menjaga keseimbangan serangan-pertahanan";
                strategiPassing = [
                    "â¤ <strong>Short passing</strong> & tempo cepat untuk break structure",
                    "â¤ <strong>Playmaker di half-space</strong> untuk create chances",
                    "â¤ <strong>Overload satu sisi</strong> untuk pecah struktur blok",
                    "ğŸ’¡ <em>Switch play cepat untuk move defense side-to-side</em>"
                ];
            }
            
            // Jika ada deteksi blok, buat HTML box
            if (jenisBlok !== "") {
                blokLawanHTML = 
                    "<div style='padding: 8px; background: linear-gradient(135deg, rgba(255, 107, 107, 0.12), rgba(255, 159, 64, 0.12)); border-left: 4px solid #ff6b6b; border-radius: 3px;'>" +
                    "<strong style='color: #ff6b6b; font-size: 14px;'>âš½ STRATEGI PASSING VS BLOK LAWAN</strong>" +
                    
                    "<div style='margin: 5px 0;'><strong style='color: #ffa94d;'>ğŸ›¡ï¸ Jenis Blok:</strong> " + jenisBlok + "</div>" +
                    
                    "<div style='margin: 6px 0; padding: 6px; background: rgba(0,0,0,0.2); border-radius: 3px; line-height: 1.5;'>" +
                    "<div style='margin-bottom: 3px;'><strong style='color: #82aaff;'>ğŸ“ Line of Defence:</strong> <span style='color: #c3e88d;'>" + lineOfDefence + "</span></div>" +
                    "<div style='margin-bottom: 3px;'><strong style='color: #82aaff;'>âš”ï¸ Line of Engagement:</strong> <span style='color: #c3e88d;'>" + lineOfEngagement + "</span></div>" +
                    "<div><strong style='color: #82aaff;'>ğŸ’ª Pressing Intensity:</strong> <span style='color: #c3e88d;'>" + pressingIntensity + "</span></div>" +
                    "</div>" +
                    
                    "<div style='margin: 5px 0; font-size: 12px; color: #aaa; font-style: italic;'>ğŸ¯ " + tujuanBlok + "</div>" +
                    
                    "<div style='margin-top: 6px; padding-top: 6px; border-top: 1px solid rgba(255, 107, 107, 0.3);'>" +
                    "<strong style='color: #51cf66; font-size: 13px;'>ğŸ§  Cara Mengatasinya:</strong>" +
                    "<div style='margin-top: 4px; line-height: 1.6;'>" + strategiPassing.join("<br>") + "</div>" +
                    "</div>" +
                    "</div>";
            }

            // Update UI dengan HTML formatting
            document.getElementById('gayaUtama').innerHTML = gayaUtama;
            document.getElementById('filosofiOffensive').innerHTML = filosofiOffensive;
            document.getElementById('filosofiDefensive').innerHTML = filosofiDefensive + 
                "<br><strong style='color: #ffa94d;'>ğŸ¯ Pendekatan Taktik:</strong><br>" + tacticalApproach +
                "<br><strong style='color: #51cf66;'>â±ï¸ Rekomendasi Tempo:</strong><br>" + tempoRecommendation +
                contextHTML;
            document.getElementById('intensitasLevel').innerHTML = intensitas;
            document.getElementById('karakteristikUtama').innerHTML = karakteristik;
            document.getElementById('riskReward').innerHTML = riskReward;
            
            // Output Strategi Passing ke kolom terpisah
            if (blokLawanHTML !== "") {
                document.getElementById('strategiPassing').innerHTML = blokLawanHTML;
            } else {
                document.getElementById('strategiPassing').innerHTML = "-";
            }
        }

        function clearRecommendations() {
            const defaultText = "Pilih kondisi pertandingan untuk melihat rekomendasi";
            document.getElementById('formasiUtama').textContent = defaultText;
            document.getElementById('formasiAlternatif').textContent = "-";
            document.getElementById('instruksiKhusus').textContent = "-";
            document.getElementById('tempoPermainan').textContent = "-";
            document.getElementById('pemainKunci').textContent = "-";
            document.getElementById('outOfPossession').textContent = "-";
            document.getElementById('defensiveLine').textContent = "-";
            document.getElementById('markingStrategy').textContent = "-";
            document.getElementById('pressingStrategy').textContent = "-";
            document.getElementById('setPieces').textContent = "-";
            document.getElementById('substitutionPlan').textContent = "-";
            document.getElementById('risikoHint').textContent = "-";
            
            // Clear section gaya permainan
            document.getElementById('gayaUtama').textContent = "Pilih taktik untuk melihat analisis gaya permainan";
            document.getElementById('filosofiOffensive').textContent = "-";
            document.getElementById('filosofiDefensive').textContent = "-";
            document.getElementById('intensitasLevel').textContent = "-";
            document.getElementById('karakteristikUtama').textContent = "-";
            document.getElementById('riskReward').textContent = "-";
            document.getElementById('strategiPassing').textContent = "-";
            
            // Clear section analisis kesesuaian tim
            document.getElementById('teamStrength').textContent = "-";
            document.getElementById('teamWeakness').textContent = "-";
            document.getElementById('formationSuitability').textContent = "-";
            
            // Sembunyikan area kondisi tim dan kesesuaian
            document.getElementById('kondisiTimInfo').style.display = 'none';
            document.getElementById('teamSuitabilitySection').style.display = 'none';
        }

        function refreshAll() {
            // Reset semua dropdown ke default
            document.getElementById('jenisLawan').value = "";
            document.getElementById('formasiLawan').value = "";
            document.getElementById('gayaLawan').value = "";
            document.getElementById('kondisiLawan').value = "";
            document.getElementById('situasiGame').value = "";
            document.getElementById('kondisiKita').value = "";
            document.getElementById('waktuPertandingan').value = "";
            document.getElementById('karakteristikTim').value = "";
            
            // Clear rekomendasi
            clearRecommendations();
            
            // Remove highlight dari table
            const rows = document.querySelectorAll('#tableBody tr');
            rows.forEach(row => {
                row.classList.remove('highlight');
            });
            
            // Log untuk debug
            console.log('ğŸ”„ All dropdowns and recommendations have been reset');
            
            // Optional: Show notification
            showRefreshNotification();
        }

        function showRefreshNotification() {
            // Create temporary notification
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(45deg, #0f5132, #0a3622);
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                font-weight: bold;
                z-index: 1000;
                box-shadow: 0 4px 15px rgba(15, 81, 50, 0.3);
                transition: all 0.3s ease;
            `;
            notification.textContent = 'âœ… Successfully Reset!';
            
            document.body.appendChild(notification);
            
            // Remove notification after 2 seconds
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 2000);
        }

        // Keyboard shortcut untuk refresh (Ctrl+R)
        document.addEventListener('keydown', function(event) {
            if (event.ctrlKey && event.key === 'r') {
                event.preventDefault(); // Prevent browser refresh
                refreshAll();
            }
        });

        function highlightTableRow(lawan, situasi) {
            const rows = document.querySelectorAll('#tableBody tr');
            rows.forEach(row => {
                row.classList.remove('highlight');
                const cells = row.children;
                if (cells[0].textContent === lawan && cells[1].textContent.includes(situasi.split(' ')[0])) {
                    row.classList.add('highlight');
                }
            });
        }

        // Error handler for debugging on mobile
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            var errorMsg = 'Error: ' + msg + '\nLine: ' + lineNo + '\nColumn: ' + columnNo;
            alert(errorMsg);
            return false;
        };

        // Wrap main initialization in try-catch
        try {
            // Auto-update on page load (if all fields have default values)
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', function() {
                    updateRecommendations();
                });
            } else {
                updateRecommendations();
            }
        } catch (e) {
            alert('Initialization error: ' + e.message);
        }
    </script>
</body>
</html>